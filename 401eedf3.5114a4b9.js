(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{147:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return p}));var a=t(3),o=t(7),r=(t(0),t(331)),l=["components"],i={},c={unversionedId:"Apple/\u5f00\u53d1\u5de5\u5177/macOS\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177",id:"Apple/\u5f00\u53d1\u5de5\u5177/macOS\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177",isDocsHomePage:!1,title:"macOS\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177",description:"macOS \u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177",source:"@site/docs/Apple/\u5f00\u53d1\u5de5\u5177/macOS\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177.md",slug:"/Apple/\u5f00\u53d1\u5de5\u5177/macOS\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177",permalink:"/docs/Apple/\u5f00\u53d1\u5de5\u5177/macOS\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177",editUrl:"dys-typora-open://mine/survival/docs/Apple/\u5f00\u53d1\u5de5\u5177/macOS\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177.md",version:"current"},s=[{value:"xcrun",id:"xcrun",children:[{value:"dyldinfo",id:"dyldinfo",children:[]}]},{value:"dwarfdump",id:"dwarfdump",children:[]},{value:"nm",id:"nm",children:[]},{value:"mfind",id:"mfind",children:[]},{value:"atos",id:"atos",children:[]},{value:"otool",id:"otool",children:[]},{value:"jtool2",id:"jtool2",children:[{value:"\u67e5\u770bheader: <code>-h</code>",id:"\u67e5\u770bheader--h",children:[]},{value:"\u67e5\u770bload command: <code>-l</code>",id:"\u67e5\u770bload-command--l",children:[]},{value:"\u67e5\u770bpage\u5206\u5e03",id:"\u67e5\u770bpage\u5206\u5e03",children:[]}]},{value:"HTool",id:"htool",children:[]},{value:"Macho-O Helper Toolset",id:"macho-o-helper-toolset",children:[]},{value:"libhelper",id:"libhelper",children:[]},{value:"Img4Helper",id:"img4helper",children:[]},{value:"lipo",id:"lipo",children:[]},{value:"pagestuff",id:"pagestuff",children:[]},{value:"arch",id:"arch",children:[]},{value:"file",id:"file",children:[]},{value:"lipo",id:"lipo-1",children:[]},{value:"binutils",id:"binutils",children:[]},{value:"strip",id:"strip",children:[]},{value:"altool",id:"altool",children:[]},{value:"class-dump",id:"class-dump",children:[]},{value:"Libtool",id:"libtool",children:[]}],b={toc:s};function p(e){var n=e.components,i=Object(o.a)(e,l);return Object(r.b)("wrapper",Object(a.a)({},b,i,{components:n,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"macos-\u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177"},"macOS \u4e8c\u8fdb\u5236\u547d\u4ee4\u884c\u5de5\u5177"),Object(r.b)("h2",{id:"xcrun"},"xcrun"),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://jamesdouble.github.io/blog/2019/12/23/xcCmdLine-2/"},"https://jamesdouble.github.io/blog/2019/12/23/xcCmdLine-2/")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o xcrun --find clang\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang\n\u279c  mach-o xcrun --find dyldinfo\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/dyldinfo\n\u279c  mach-o open /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\n\u279c  mach-o which ld\n/usr/bin/ld\n")),Object(r.b)("h3",{id:"dyldinfo"},"dyldinfo"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o xcrun dyldinfo -lazy_bind a \nlazy binding information (from lazy_bind part of dyld info):\nsegment section          address    index  dylib            symbol\n__DATA  __la_symbol_ptr  0x100008000 0x0000 libSystem        _exit\n__DATA  __la_symbol_ptr  0x100008008 0x000C libSystem        _printf\n")),Object(r.b)("h2",{id:"dwarfdump"},"dwarfdump"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"dwarfdump --uuid dSYM\u6587\u4ef6\ndwarfdump --lookup [address] -arch arm64 dSYM\u6587\u4ef6\n")),Object(r.b)("h2",{id:"nm"},"nm"),Object(r.b)("p",null,"nm\u547d\u4ee4\u7528\u4e8e\u663e\u793a\u4e8c\u8fdb\u5236\u7684\u7b26\u53f7\u8868\u3002\u8be5\u547d\u4ee4\u6709\u4e24\u4e2a\u7248\u672c\uff0c\u6211\u4eec\u5e38\u7528\u7684nm\u5b9e\u9645\u4e0a\u662f ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"llvm-nm"))," \u3002"),Object(r.b)("p",null,"nm\u663e\u793a\u7684\u7b26\u53f7\u8868\uff0c\u5373\u6bcf\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684 ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"nlist"))," \u7ed3\u6784\u4e2d\u7684\u7b26\u53f7\u8868\u3002"),Object(r.b)("p",null,"\u6ce8\u610f\uff1a\u5982\u679c\u5b89\u88c5\u4e86gnu\u7684binutils nm\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6\u3002\u53ef\u4ee5\u5c06gnu\u7684nm\u91cd\u65b0\u547d\u540d\u4e3agnm\u3002\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51b2\u7a81\u4e86\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  dys_ios_framework.framework nm -m dys_ios_framework  \n0000000000007e1c (__TEXT,__text) non-external +[DYSFrameWorkClass dys_test]\n0000000000007e38 (__TEXT,__text) non-external -[DYSFrameWorkClass dys_test1]\n0000000000007e54 (__TEXT,__text) non-external -[DYSFrameWorkClass dys_test2]\n                 (undefined) external _NSLog (from Foundation)\n000000000000c120 (__DATA,__objc_data) non-external (was a private external) _OBJC_CLASS_$_DYSFrameWorkClass\n                 (undefined) external _OBJC_CLASS_$_NSObject (from libobjc)\n000000000000c0f8 (__DATA,__objc_data) non-external (was a private external) _OBJC_METACLASS_$_DYSFrameWorkClass\n                 (undefined) external _OBJC_METACLASS_$_NSObject (from libobjc)\n000000000000c010 (__DATA,__objc_const) non-external __OBJC_$_CLASS_METHODS_DYSFrameWorkClass\n000000000000c078 (__DATA,__objc_const) non-external __OBJC_$_INSTANCE_METHODS_DYSFrameWorkClass\n000000000000c0b0 (__DATA,__objc_const) non-external __OBJC_CLASS_RO_$_DYSFrameWorkClass\n000000000000c030 (__DATA,__objc_const) non-external __OBJC_METACLASS_RO_$_DYSFrameWorkClass\n                 (undefined) external ___CFConstantStringClassReference (from CoreFoundation)\n000000000000c148 (__DATA,__data) non-external __dyld_private\n                 (undefined) external __objc_empty_cache (from libobjc)\n0000000000007ef8 (__TEXT,__const) non-external (was a private external) _dys_ios_frameworkVersionNumber\n0000000000007eb8 (__TEXT,__const) non-external (was a private external) _dys_ios_frameworkVersionString\n0000000000007e04 (__TEXT,__text) non-external (was a private external) _my_c_print\n0000000000007e10 (__TEXT,__text) non-external (was a private external) _my_c_print_in\n                 (undefined) external _printf (from libSystem)\n                 (undefined) external dyld_stub_binder (from libSystem)\n\u279c  dys_ios_framework.framework \n")),Object(r.b)("p",null,"\u67e5\u770b\u5e2e\u52a9"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"man nm")),Object(r.b)("h2",{id:"mfind"},"mfind"),Object(r.b)("p",null,"\u4f7f\u7528mfind\u7528\u4e8e\u5728Mac\u7cfb\u7edf\u4e2d\u5b9a\u4f4ddSYM\u6587\u4ef6\uff0c\u5982\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'mdfind "com_apple_xcode_dsym_uuids == E30FC309-DF7B-3C9F-8AC5-7F0F6047D65F"\u590d\u5236\u4ee3\u7801\n')),Object(r.b)("h2",{id:"atos"},"atos"),Object(r.b)("p",null,"\u4f7f\u7528atos\u547d\u4ee4\uff0c\u53ef\u4ee5\u5bf9\u5355\u4e2a\u5730\u5740\u8fdb\u884c\u7b26\u53f7\u5316\u3002\u8fd0\u884cshell\u547d\u4ee4 ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"xcrun atos -o ","[dwarf\u6587\u4ef6\u5730\u5740]"," -arch arm64 -l ","[loadAddress][instructionAddress]"))," \u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"xcrun atos -o app.dSYM/Contents/Resources/DWARF/MyApp -arch arm64 -l -l 0x1006b4000 0x0000000100d382a8\u590d\u5236\u4ee3\u7801\n")),Object(r.b)("p",null,"\u5b9e\u9645\u4e0a\u4ec5\u901a\u8fc7\u7b26\u53f7\u5728\u5bf9\u5e94mach-o\u4e2d\u7684 ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"offset"))," \u5373\u53ef\u7b26\u53f7\u5316\uff0c\u53ef\u5047\u8bbe ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"loadAddress"))," \u4e3a1\uff0c\u8ba1\u7b97 ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"instructionAddress = offset + loadAddress"))," \u3002atos\u547d\u4ee4\u4e0d\u63a5\u53d7\u76f4\u63a5\u4f20\u9012offset\u5730\u5740\uff0c\u5f88\u5947\u602a\u3002\u4e14loadAddress\u4e0d\u80fd\u4e3a0\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"xcrun atos -o app.dSYM/Contents/Resources/DWARF/MyApp -arch arm64 -l 0x1 0xF781\u590d\u5236\u4ee3\u7801\n")),Object(r.b)("p",null,"\u5176\u4e2d\uff0c0xF781\u5373\u4e3aloadAddress\u4e3a0x1\u7684\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7offet\u8ba1\u7b97\u5f97\u5230\u7684instructionAddress\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  crashes '/Users/dingyusong/Desktop/duobei/crashes/20211022150639'\n\u279c  20211022150639 symbolicatecrash 2021-10-22-16-32-04.log > 33\n\u279c  20211022150639 atos -arch x86_64  -o RZPaas_macOS -l 0x109eed000 0x000000010b503f73\nsol2::Sol2ClientProtocol::onStart() (in RZPaas_macOS) + 19\n\u279c  20211022150639 atos -arch x86_64  -o RZPaas_macOS -l 0x109eed000 0x000000010b5058f8\nsol2::Sol2Protocol::start() (in RZPaas_macOS) + 344\n\u279c  20211022150639 symbolicatecrash  2021-10-22-16-32-04.log > 33\n\u279c  20211022150639 atos -arch x86_64  -o RZPaas_macOS -l 0x109eed000 0x000000010b5058f8\nsol2::Sol2Protocol::start() (in RZPaas_macOS) + 344\n\u279c  20211022150639 ..\n\u279c  crashes atos -arch x86_64  -o RZPaas_macOS -l 0x109eed000 0x000000010b5058f8\natos cannot load symbols for the file RZPaas_macOS for architecture x86_64.\n\u279c  crashes cd -\n~/Desktop/duobei/crashes/20211022150639\n\u279c  20211022150639 atos -arch x86_64  -o RZPaas_macOS -l 0x109eed000 0x000000010b5058f8\nsol2::Sol2Protocol::start() (in RZPaas_macOS) + 344\n\u279c  20211022150639 \n")),Object(r.b)("h2",{id:"otool"},"otool"),Object(r.b)("p",null,"the otool-compatible command line parser for ",Object(r.b)("strong",{parentName:"p"},"llvm-objdump"),"\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o otool -f /usr/bin/perl\nFat headers\nfat_magic 0xcafebabe\nnfat_arch 2\narchitecture 0\n    cputype 16777223\n    cpusubtype 3\n    capabilities 0x0\n    offset 16384\n    size 58752\n    align 2^14 (16384)\narchitecture 1\n    cputype 16777228\n    cpusubtype 2\n    capabilities 0x80\n    offset 81920\n    size 58256\n    align 2^14 (16384)\n")),Object(r.b)("p",null,"\u66ff\u4ee3linux\u7684readelf\u548cldd\u3002"),Object(r.b)("p",null,"otool \u4ece main\u5f00\u59cb\u53cd\u6c47\u7f16"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'#include<stdio.h>\n#include<stdlib.h>\nint main(int argc, char* argv[]) {\n    printf("Salvem Munde!\\n");\n    printf("Vale!\\n");\n    exit(0);\n}\n')),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'\u279c  mach-o otool -p _main -tV a\na:\n(__TEXT,__text) section\n_main:\n0000000100003f20        pushq   %rbp\n0000000100003f21        movq    %rsp, %rbp\n0000000100003f24        subq    $0x20, %rsp\n0000000100003f28        movl    $0x0, -0x4(%rbp)\n0000000100003f2f        movl    %edi, -0x8(%rbp)\n0000000100003f32        movq    %rsi, -0x10(%rbp)\n0000000100003f36        leaq    0x63(%rip), %rdi                ## literal pool for: "Salvem Munde!\\n"\n0000000100003f3d        xorl    %eax, %eax\n0000000100003f3f        movb    %al, %cl\n0000000100003f41        movl    %eax, -0x14(%rbp)\n0000000100003f44        movb    %cl, %al\n0000000100003f46        movb    %cl, -0x15(%rbp)\n0000000100003f49        callq   0x100003f74                     ## symbol stub for: _printf\n0000000100003f4e        leaq    0x5a(%rip), %rdi                ## literal pool for: "Vale!\\n"\n0000000100003f55        movb    -0x15(%rbp), %cl\n0000000100003f58        movl    %eax, -0x1c(%rbp)\n0000000100003f5b        movb    %cl, %al\n0000000100003f5d        callq   0x100003f74                     ## symbol stub for: _printf\n0000000100003f62        movl    -0x14(%rbp), %edi\n0000000100003f65        movl    %eax, -0x20(%rbp)\n0000000100003f68        callq   0x100003f6e                     ## symbol stub for: _exit\n')),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'\u279c  mach-o nm a | grep "U " \n                 U _exit\n                 U _printf\n                 U dyld_stub_binder\n\u279c  mach-o nm a | wc -l\n       6\n\u279c  mach-o nm a        \n0000000100008010 d __dyld_private\n0000000100000000 T __mh_execute_header\n                 U _exit\n0000000100003f20 T _main\n                 U _printf\n                 U dyld_stub_binder\n')),Object(r.b)("h2",{id:"jtool2"},Object(r.b)("a",{parentName:"h2",href:"http://www.newosxbook.com/tools/jtool.html"},"jtool2")),Object(r.b)("h3",{id:"\u67e5\u770bheader--h"},"\u67e5\u770bheader: ",Object(r.b)("inlineCode",{parentName:"h3"},"-h")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},"Zephyr:~ morpheus$ otool -h /bin/ls\n/bin/ls:\nMach header\n      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\n 0xfeedfacf 16777223          3  0x80           2    19       1816 0x00200085\n\nZephyr:~ morpheus$ jtool -h  /bin/ls\nMagic:  64-bit Mach-O\nType:   executable\nCPU:    x86_64\nCmds:   19\nsize:   1816 bytes\nFlags:  0x200085\n")),Object(r.b)("h3",{id:"\u67e5\u770bload-command--l"},"\u67e5\u770bload command: ",Object(r.b)("inlineCode",{parentName:"h3"},"-l")),Object(r.b)("h3",{id:"\u67e5\u770bpage\u5206\u5e03"},"\u67e5\u770bpage\u5206\u5e03"),Object(r.b)("p",null,"\u4f18\u5316 pagestuff"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o jtool2   --pages dys_ios_framework_demo \n0x0-0x8000 __TEXT       (32768 bytes)\n        0x5fb0-0x653c __TEXT.__text     (1420 bytes)\n        0x653c-0x65d8 __TEXT.__stubs    (156 bytes)\n        0x65d8-0x668c __TEXT.__stub_helper      (180 bytes)\n        0x668c-0x7416 __TEXT.__objc_methname    (3466 bytes)\n        0x7416-0x7486 __TEXT.__objc_classname   (112 bytes)\n        0x7486-0x7f95 __TEXT.__objc_methtype    (2831 bytes)\n        0x7f95-0x7fab __TEXT.__cstring  (22 bytes)\n        0x7fac-0x8000 __TEXT.__unwind_info      (84 bytes)\n0x8000-0xc000 __DATA_CONST      (16384 bytes)\n        0x8000-0x8008 __DATA_CONST.__got        (8 bytes)\n        0x8008-0x8028 __DATA_CONST.__cfstring   (32 bytes)\n        0x8028-0x8040 __DATA_CONST.__objc_classlist     (24 bytes)\n        0x8040-0x8060 __DATA_CONST.__objc_protolist     (32 bytes)\n        0x8060-0x8068 __DATA_CONST.__objc_imageinfo     (8 bytes)\n0xc000-0x10000 __DATA   (16384 bytes)\n        0xc000-0xc068 __DATA.__la_symbol_ptr    (104 bytes)\n        0xc068-0xd390 __DATA.__objc_const       (4904 bytes)\n        0xd390-0xd3a8 __DATA.__objc_selrefs     (24 bytes)\n        0xd3a8-0xd3b8 __DATA.__objc_classrefs   (16 bytes)\n        0xd3b8-0xd3c0 __DATA.__objc_superrefs   (8 bytes)\n        0xd3c0-0xd3c4 __DATA.__objc_ivar        (4 bytes)\n        0xd3c8-0xd4b8 __DATA.__objc_data        (240 bytes)\n        0xd4b8-0xd640 __DATA.__data     (392 bytes)\n0x10000-0x17950 __LINKEDIT      (31056 bytes)\n        0x10000-0x10150 Rebase info       (opcodes)     (336 bytes)\n        0x10150-0x102a0 Binding info      (opcodes)     (336 bytes)\n        0x102a0-0x103f8 Lazy Binding info (opcodes)     (344 bytes)\n        0x103f8-0x104d0 Exports (216 bytes)\n        0x104d0-0x104e8 Function Starts (24 bytes)\n        0x104e8-0x111c8 Symbol Table    (3296 bytes)\n        0x11238-0x12b40 String Table    (6408 bytes)\n        0x12b40-0x17950 Code Signature  (19984 bytes)\n\u279c  mach-o size dys_ios_framework_demo\n__TEXT  __DATA  __OBJC  others  dec     hex\n32768   16384   0       4295016448      4295065600      100018000\n")),Object(r.b)("p",null,"\u4ee3\u7801\u6bb5\uff0c\u6570\u636e\u6bb5"),Object(r.b)("h2",{id:"htool"},Object(r.b)("a",{parentName:"h2",href:"https://h3adsh0tzz.com/projects/htool/"},"HTool")),Object(r.b)("h2",{id:"macho-o-helper-toolset"},Object(r.b)("a",{parentName:"h2",href:"https://h3adsh0tzz.com/2020/01/macho-helper-toolset/"},"Macho-O Helper Toolset")),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://h3adsh0tzz.com/projects/macho-toolset/"},"https://h3adsh0tzz.com/projects/macho-toolset/")),Object(r.b)("h2",{id:"libhelper"},Object(r.b)("a",{parentName:"h2",href:"https://github.com/h3adshotzz/libhelper"},"libhelper")),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://h3adsh0tzz.com/projects/libhelper/"},"https://h3adsh0tzz.com/projects/libhelper/")),Object(r.b)("h2",{id:"img4helper"},Object(r.b)("a",{parentName:"h2",href:"https://h3adsh0tzz.com/projects/img4helper/"},"Img4Helper")),Object(r.b)("h2",{id:"lipo"},"lipo"),Object(r.b)("p",null,"\u663e\u793aarch\u4fe1\u606f"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o lipo -detailed_info /usr/bin/perl\nFat header in: /usr/bin/perl\nfat_magic 0xcafebabe\nnfat_arch 2\narchitecture x86_64\n    cputype CPU_TYPE_X86_64\n    cpusubtype CPU_SUBTYPE_X86_64_ALL\n    capabilities 0x0\n    offset 16384\n    size 58752\n    align 2^14 (16384)\narchitecture arm64e\n    cputype CPU_TYPE_ARM64\n    cpusubtype CPU_SUBTYPE_ARM64E\n    capabilities PTR_AUTH_VERSION USERSPACE 0\n    offset 81920\n    size 58256\n    align 2^14 (16384)\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o tldr lipo\n\n  lipo\n\n  Tool for handling Mach-O Universal Binaries.\n  More information: https://ss64.com/osx/lipo.html.\n\n  - Create a universal file from two single-architecture files:\n    lipo path/to/binary.x86_64 path/to/binary.arm64e -create -output path/to/binary\n\n  - List all architectures contained in a universal file:\n    lipo path/to/binary -archs\n\n  - Display detailed information about a universal file:\n    lipo path/to/binary -detailed_info\n\n  - Extract a single-architecture file from a universal file:\n    lipo path/to/binary -thin arm64e -output path/to/binary.arm64e\n")),Object(r.b)("h2",{id:"pagestuff"},"pagestuff"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o pagestuff dys_ios_framework-11 -a\nFile Page 0 contains Mach-O headers\nFile Page 1 contains empty space in the Mach-O file for arm64 between:\n    Mach-O headers and\n    contents of section (__TEXT,__text)\nFile Page 2 contains empty space in the Mach-O file for arm64 between:\n    Mach-O headers and\n    contents of section (__TEXT,__text)\n...\n")),Object(r.b)("h2",{id:"arch"},"arch"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  mach-o tldr arch\n\n  arch\n\n  Display the name of the system architecture, or run a command under a different architecture.\n  See also uname.\n\n  - Display the system's architecture:\n    arch\n\n  - Run a command using x86_64:\n    arch -x86_64 command\n\n\nSee also: uname\n\n\n\u279c  mach-o arch \ni386\n")),Object(r.b)("h2",{id:"file"},"file"),Object(r.b)("p",null,"macOS\u4e0b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  link-test uname -a\nDarwin bogon 20.6.0 Darwin Kernel Version 20.6.0: Wed Jun 23 00:26:31 PDT 2021; root:xnu-7195.141.2~5/RELEASE_X86_64 x86_64\n\u279c  link-test file a.c \na.c: ASCII text\n\u279c  link-test file a.o\na.o: Mach-O 64-bit object x86_64\n\u279c  link-test file a.out \na.out: Mach-O 64-bit executable x86_64\n")),Object(r.b)("p",null,"Ubuntu\u4e0b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  link-test git:(master) \u2717 uname -a\nLinux dys-ubuntu-desktop 5.11.0-25-generic #27~20.04.1-Ubuntu SMP Tue Jul 13 17:41:23 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\n\u279c  link-test git:(master) \u2717 file a.c\na.c: ASCII text\n\u279c  link-test git:(master) \u2717 file a.o\na.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped\n\u279c  link-test git:(master) \u2717 file a.out\na.out: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=824c177b1a8f2ca5c249ce66ec8a671bf92a14ee, for GNU/Linux 3.2.0, not stripped\n")),Object(r.b)("h2",{id:"lipo-1"},"lipo"),Object(r.b)("p",null,"\u53c2\u8003\uff1alipo"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://www.cnblogs.com/dabaopku/p/5698186.html"},"Mac\u7cfb\u7edf\u4e0blipo, ar, nm\u7b49\u5de5\u5177\u7684\u4f7f\u7528\u7b80\u4ecb"))),Object(r.b)("p",null,"\u800c\u5bf9\u4e8e\u82f9\u679c\u7cfb\u7edf\u6765\u8bf4, \u4e30\u5bcc\u7684\u8bbe\u5907\u5305\u542b\u4e86\u591a\u79cd\u67b6\u6784\u5e73\u53f0, armv7, arm64, i386, x86_64\u662f\u6700\u5e38\u89c1\u7684\u6307\u4ee4\u96c6, \u4e00\u4e2a\u7a0b\u5e8f\u5e93\u4e3a\u4e86\u517c\u5bb9\u5404\u4e2a\u5e73\u53f0, \u5e38\u5e38\u8981\u628a\u4e0d\u540c\u5e73\u53f0\u7f16\u8bd1\u7684\u7a0b\u5e8f\u5408\u5e76\u8d77\u6765, \u751f\u6210\u6240\u8c13\u7684\u80d6\u6587\u4ef6(Fat File)\u3002"),Object(r.b)("p",null,"\u56e0\u6b64\u5bf9\u4e8e\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6, \u5176\u5b9e\u5305\u542b\u4e863\u5c42\u7ed3\u6784: Universal Fat File -> Single Architecture Binary File -> Mach-O Object."),Object(r.b)("p",null,"objdump \u4e8c\u8fdb\u5236\u6587\u4ef6\u5206\u6790 ",Object(r.b)("a",{parentName:"p",href:"https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/objdump.html"},"https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/objdump.html")),Object(r.b)("h2",{id:"binutils"},"binutils"),Object(r.b)("p",null,"mac\u6709\u90e8\u5206\u81ea\u5e26\u7684\u5de5\u5177\u548cbinutils\u76f8\u540c\uff0cmac\u4e0b\u7684\u5de5\u5177\u4e3b\u8981\u662f\u89e3\u6790Mach-O\u7684\uff0cgnu\u7684binutil\u4e3b\u8981\u662felf\u7684\uff0c\u6240\u4ee5gnu\u7684\u90a3\u4e00\u5957util\u5b89\u88c5\u540e\u6700\u597d\u52a0\u4e0a\u524d\u7f00g\u3002\u4ee5\u533a\u5206\u3002\u9632\u6b62\u5bf9mac\u7cfb\u7edf\u7684\u4e8c\u8fdb\u5236\u5de5\u5177\u8fdb\u884c\u8986\u76d6\u3002"),Object(r.b)("p",null,"mac\u4e0b\u4e5f\u53ef\u4ee5\u7528binutils\u3002\u4f46\u662f\u56e0\u4e3amac\u4e0b\u662fMach-O\u683c\u5f0f\uff0c\u6240\u4ee5\u4e0d\u80fd\u7528readelf\u3002"),Object(r.b)("p",null,"Mac : brew install binutils\uff0c\u7136\u540e\u7528greadelf\u548cgobjdump(readelf\u548cobjdump)\u3002"),Object(r.b)("p",null,"MachOView \u67e5\u770b mach-o\u6587\u4ef6"),Object(r.b)("p",null,"objdump Mac \u53ef\u7528"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  /Users/dingyusong/mine/gitee/clab/SimpleSection git:(master) readelf -S SimpleSection.o\nreadelf: Error: Not an ELF file - it has the wrong magic bytes at the start\n\u279c  /Users/dingyusong/mine/gitee/clab/SimpleSection git:(master) file SimpleSection.o \nSimpleSection.o: Mach-O 64-bit object x86_64\n")),Object(r.b)("h2",{id:"strip"},"strip"),Object(r.b)("p",null,"strip\u7528\u6765\u5220\u9664\u7a0b\u5e8f\u91cc\u7684\u7b26\u53f7\u8868. -R \u7528\u6765\u6307\u5b9a\u4e00\u4e2a\u8981\u5220\u9664\u7684\u7b26\u53f7\u5217\u8868, \u4f7f\u7528\u4e0a\u8ff0\u751f\u6210\u7684symbols\u6587\u4ef6. \u6dfb\u52a0 -S \u9009\u9879\u6765\u4fdd\u7559\u5176\u4ed6\u7b26\u53f7."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"strip -S -R symbols MAMapKit.armv7 -o MAMapKit.armv7.strip")),Object(r.b)("p",null,"\u53ef\u4ee5\u9a8c\u8bc1\u751f\u6210\u7684\u65b0\u6587\u4ef6\u5df2\u7ecf\u6ca1\u6709\u4e86png\u7b26\u53f7."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  ~ cat symbols\n_OBJC_CLASS_$_FW1Obj1\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  ~ nm -gU /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Products/Debug-iphonesimulator/fw2.framework/fw2\n0000000000008158 S _OBJC_CLASS_$_FW1Obj1\n00000000000081a8 S _OBJC_CLASS_$_FW2Obj1\n0000000000008130 S _OBJC_METACLASS_$_FW1Obj1\n0000000000008180 S _OBJC_METACLASS_$_FW2Obj1\n0000000000003f80 S _fw2VersionNumber\n0000000000003f50 S _fw2VersionString\n")),Object(r.b)("p",null,"\u5220\u9664\u67d0\u4e2a\u7b26\u53f7"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  ~ strip -S -R symbols /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Products/Debug-iphonesimulator/fw2.framework/fw2\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/strip: warning: changes being made to the file will invalidate the code signature in: /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Products/Debug-iphonesimulator/fw2.framework/fw2\n\n\u279c  ~ nm -gU /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Products/Debug-iphonesimulator/fw2.framework/fw2\n00000000000081a8 S _OBJC_CLASS_$_FW2Obj1\n0000000000008130 S _OBJC_METACLASS_$_FW1Obj1\n0000000000008180 S _OBJC_METACLASS_$_FW2Obj1\n0000000000003f80 S _fw2VersionNumber\n0000000000003f50 S _fw2VersionString\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"_OBJC_CLASS_$_FW1Obj1"),"\u8fd9\u4e2a\u7b26\u53f7\u786e\u5b9e\u6ca1\u6709\u4e86\u3002"),Object(r.b)("p",null,"\u79fb\u9664\u67d0\u4e2a\u7b26\u53f7"),Object(r.b)("p",null,"\u7528nm\u83b7\u5f97\u5f85\u79fb\u9664\u7684\u7b26\u53f7\u8868\u7684\u5217\u8868"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20210906170406035",src:t(502).default})),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  ~ nm -j /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Products/Debug-iphonesimulator/fw2.framework/fw2  | grep FW1Obj1  > third.symbol\n\u279c  ~ cat third.symbol\n_OBJC_CLASS_$_FW1Obj1\n_OBJC_METACLASS_$_FW1Obj1\n__OBJC_CLASS_RO_$_FW1Obj1\n__OBJC_METACLASS_RO_$_FW1Obj1\n")),Object(r.b)("p",null,"\u628a\u5bf9\u5916\u66b4\u9732\u7684\u7b26\u53f7\u88ab\u5254\u9664\u4e86"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  ~ nm -gU /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Products/Debug-iphonesimulator/fw2.framework/fw2\n00000000000081c0 S _OBJC_CLASS_$_FW2Obj1\n0000000000008198 S _OBJC_METACLASS_$_FW2Obj1\n0000000000003f70 S _fw2VersionNumber\n0000000000003f40 S _fw2VersionString\n\u279c  ~ nm -a /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Products/Debug-iphonesimulator/fw2.framework/fw2 | grep FW1\n0000000000003e50 t -[FW1Obj1 hello]\n0000000000003e50 - 01 0000   FUN -[FW1Obj1 hello]\n000000006135da52 - 03 0001   OSO /Users/dingyusong/Library/Developer/Xcode/DerivedData/framework-demo-gpomogmayijsfpclllhlbeetrizz/Build/Intermediates.noindex/framework-demo.build/Debug-iphonesimulator/fw2.build/Objects-normal/x86_64/FW1Obj1.o\n0000000000003e50 - 01 0000    SO FW1Obj1.m\n0000000000000000 - 00 0000  GSYM _OBJC_CLASS_$_FW1Obj1\n0000000000008170 s _OBJC_CLASS_$_FW1Obj1\n0000000000000000 - 00 0000  GSYM _OBJC_METACLASS_$_FW1Obj1\n0000000000008148 s _OBJC_METACLASS_$_FW1Obj1\n0000000000003f10 s __OBJC_$_INSTANCE_METHODS_FW1Obj1\n0000000000008058 - 0f 0000 STSYM __OBJC_CLASS_RO_$_FW1Obj1\n0000000000008058 s __OBJC_CLASS_RO_$_FW1Obj1\n0000000000008010 - 0f 0000 STSYM __OBJC_METACLASS_RO_$_FW1Obj1\n0000000000008010 s __OBJC_METACLASS_RO_$_FW1Obj1\n")),Object(r.b)("p",null,"\u5bfc\u51fa\u9700\u8981\u5254\u9664\u7684\u7b26\u53f7"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"\u279c  Example git:(develop) \u2717 nm -jgU /Users/dingyusong/Library/Developer/Xcode/DerivedData/tosee-bnxlmdxecdrxoyhkhhqgpchfrcew/Build/Products/Debug-iphoneos/tosee.app/Frameworks/RZGMS.framework/RZGMS | grep RZDataCollectManager >> symbol.strip\n\u279c  Example git:(develop) \u2717 nm -jgU /Users/dingyusong/Library/Developer/Xcode/DerivedData/tosee-bnxlmdxecdrxoyhkhhqgpchfrcew/Build/Products/Debug-iphoneos/tosee.app/Frameworks/RZGMS.framework/RZGMS | grep RZUUIDHelper >> symbol.strip        \n")),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20210906181630219",src:t(503).default})),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"-j     Just display the symbol names (no value or type).\n-g     Display only global (external) symbols.\n-U     Don't display undefined symbols.\n")),Object(r.b)("h2",{id:"altool"},"altool"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"-----------apple-build-system: run upload ipa to appstore start-----------\nupload_to_appstore 436LQ6QXGA 6cdf900a-8cec-456f-84d7-883e3b45d891 /Users/dingyusong/Desktop/duobei/tosee-ios/build/tosee/20210907111935/tosee.ipa\n apiKey is: 436LQ6QXGA -- apiIssuer is: 6cdf900a-8cec-456f-84d7-883e3b45d891 \nrunning validate cmd xcrun altool --validate-app -f /Users/dingyusong/Desktop/duobei/tosee-ios/build/tosee/20210907111935/tosee.ipa -t iOS --apiKey 436LQ6QXGA --apiIssuer 6cdf900a-8cec-456f-84d7-883e3b45d891 --verbose\nVerbose logging enabled.\nNon-localized server string received: 'Could not find private key file: AuthKey_436LQ6QXGA.p8, in any of the following locations.\n ./private_keys or <user home>/private_keys or <user home>/.private_keys or <user home>/.appstoreconnect/private_keys.'.\n*** Could not find private key file: AuthKey_436LQ6QXGA.p8, in any of the following locations.\n ./private_keys or <user home>/private_keys or <user home>/.private_keys or <user home>/.appstoreconnect/private_keys.\n*** Error: Unable to validate archive '/Users/dingyusong/Desktop/duobei/tosee-ios/build/tosee/20210907111935/tosee.ipa'.\n*** Error: Authentication failed. Failed to authenticate with errors: (\n    \"Error Domain=ITunesConnectionAuthenticationErrorDomain Code=-26000 \\\"Could not find private key file: AuthKey_436LQ6QXGA.p8, in any of the following locations.\\n ./private_keys or <user home>/private_keys or <user home>/.private_keys or <user home>/.appstoreconnect/private_keys.\\\" UserInfo={NSLocalizedRecoverySuggestion=Could not find private key file: AuthKey_436LQ6QXGA.p8, in any of the following locations.\\n ./private_keys or <user home>/private_keys or <user home>/.private_keys or <user home>/.appstoreconnect/private_keys., NSLocalizedDescription=Could not find private key file: AuthKey_436LQ6QXGA.p8, in any of the following locations.\\n ./private_keys or <user home>/private_keys or <user home>/.private_keys or <user home>/.appstoreconnect/private_keys., NSLocalizedFailureReason=App Store operation failed.}\"\n) (-1011)\n\n033[31m validate failed \n-----------apple-build-system: run upload ipa to appstore done-----------\n")),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20210907112922000",src:t(504).default})),Object(r.b)("p",null,"\u79c1\u94a5\u4e0b\u8f7d\u4e0b\u6765\u653e\u8fd9\u91cc"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20210922110638660",src:t(505).default})),Object(r.b)("h2",{id:"class-dump"},"class-dump"),Object(r.b)("p",null,"class-dump is a command-line utility for examining the Objective-C segment of Mach-O files. It generates declarations for the classes, categories and protocols. This is the same information provided by using 'otool -ov', but presented as normal Objective-C declarations."),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://github.com/nygard/class-dump"},"https://github.com/nygard/class-dump")),Object(r.b)("h2",{id:"libtool"},"Libtool"))}p.isMDXComponent=!0},331:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return m}));var a=t(0),o=t.n(a);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=o.a.createContext({}),b=function(e){var n=o.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=b(e.components);return o.a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},_=o.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=b(t),_=a,m=p["".concat(l,".").concat(_)]||p[_]||d[_]||r;return t?o.a.createElement(m,i(i({ref:n},s),{},{components:t})):o.a.createElement(m,i({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,l=new Array(r);l[0]=_;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var s=2;s<r;s++)l[s]=t[s];return o.a.createElement.apply(null,l)}return o.a.createElement.apply(null,t)}_.displayName="MDXCreateElement"},502:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/image-20210906170406035-0d91fe20e91997b52434899b43698102.png"},503:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/image-20210906181630219-c276d12582d15487ff6fd15c0dedc514.png"},504:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/image-20210907112922000-01f022588fb4cf36146cd1192d2725a9.png"},505:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/image-20210922110638660-3c1c1f9231b08ca83878704e10d47730.png"}}]);