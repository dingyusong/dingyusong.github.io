(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{240:function(e,o,n){"use strict";n.r(o),n.d(o,"frontMatter",(function(){return u})),n.d(o,"metadata",(function(){return c})),n.d(o,"toc",(function(){return p})),n.d(o,"default",(function(){return b}));var t=n(3),a=n(7),r=(n(0),n(356)),l=["components"],u={},c={unversionedId:"Apple/iOS\u5f00\u53d1/Runloop/Runloop",id:"Apple/iOS\u5f00\u53d1/Runloop/Runloop",isDocsHomePage:!1,title:"Runloop",description:"Runloop",source:"@site/docs/Apple/iOS\u5f00\u53d1/Runloop/Runloop.md",slug:"/Apple/iOS\u5f00\u53d1/Runloop/Runloop",permalink:"/docs/Apple/iOS\u5f00\u53d1/Runloop/Runloop",editUrl:"dys-typora-open://mine/survival/docs/Apple/iOS\u5f00\u53d1/Runloop/Runloop.md",version:"current"},p=[{value:"\u5e94\u7528\u8303\u7574",id:"\u5e94\u7528\u8303\u7574",children:[]},{value:"RunLoop\u7684\u57fa\u672c\u4f5c\u7528",id:"runloop\u7684\u57fa\u672c\u4f5c\u7528",children:[]},{value:"NSRunLoop\u5bf9\u8c61",id:"nsrunloop\u5bf9\u8c61",children:[]},{value:"Runloop\u4e0e\u7ebf\u7a0b",id:"runloop\u4e0e\u7ebf\u7a0b",children:[]},{value:"\u83b7\u53d6Runloop\u5bf9\u8c61",id:"\u83b7\u53d6runloop\u5bf9\u8c61",children:[]},{value:"RunLoop\u76f8\u5173\u7684\u7c7b",id:"runloop\u76f8\u5173\u7684\u7c7b",children:[]},{value:"CFRunLoopModeRef",id:"cfrunloopmoderef",children:[{value:"\u5e38\u89c1\u76842\u79cdMode",id:"\u5e38\u89c1\u76842\u79cdmode",children:[]}]},{value:"CFRunLoopObserverRef",id:"cfrunloopobserverref",children:[]},{value:"RunLoop\u7684\u8fd0\u884c\u903b\u8f91",id:"runloop\u7684\u8fd0\u884c\u903b\u8f91",children:[]},{value:"RunLoop\u4f11\u7720\u7684\u5b9e\u73b0\u539f\u7406",id:"runloop\u4f11\u7720\u7684\u5b9e\u73b0\u539f\u7406",children:[]},{value:"RunLoop\u5728\u5b9e\u9645\u5f00\u4e2d\u7684\u5e94\u7528",id:"runloop\u5728\u5b9e\u9645\u5f00\u4e2d\u7684\u5e94\u7528",children:[]},{value:"Runloop\u6848\u4f8b\u5206\u6790",id:"runloop\u6848\u4f8b\u5206\u6790",children:[{value:"\u6848\u4f8b\u5206\u67901\uff1aNSTimer",id:"\u6848\u4f8b\u5206\u67901\uff1anstimer",children:[]},{value:"\u6848\u4f8b\u5206\u67902\uff1aSocket\u901a\u4fe1",id:"\u6848\u4f8b\u5206\u67902\uff1asocket\u901a\u4fe1",children:[]},{value:"\u6848\u4f8b\u5206\u67903\uff1a\u5b50\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1",id:"\u6848\u4f8b\u5206\u67903\uff1a\u5b50\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1",children:[]},{value:"\u6848\u4f8b\u5206\u67904\uff1a\u76d1\u542cObserver",id:"\u6848\u4f8b\u5206\u67904\uff1a\u76d1\u542cobserver",children:[]},{value:"Runloop\u8c03\u7528\u6808",id:"runloop\u8c03\u7528\u6808",children:[]},{value:"Source1",id:"source1",children:[]},{value:"objc_autoreleasePoolPush \u65b9\u6cd5",id:"objc_autoreleasepoolpush-\u65b9\u6cd5",children:[]}]}],i={toc:p};function b(e){var o=e.components,u=Object(a.a)(e,l);return Object(r.b)("wrapper",Object(t.a)({},i,u,{components:o,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"runloop"},"Runloop"),Object(r.b)("p",null,"[toc]"),Object(r.b)("p",null,"\u987e\u540d\u601d\u4e49\n\u8fd0\u884c\u5faa\u73af\n\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5faa\u73af\u505a\u4e00\u4e9b\u4e8b\u60c5"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012215632058",src:n(856).default})),Object(r.b)("h2",{id:"\u5e94\u7528\u8303\u7574"},"\u5e94\u7528\u8303\u7574"),Object(r.b)("p",null,"\u5b9a\u65f6\u5668\uff08Timer\uff09\u3001PerformSelector\nGCD Async Main Queue\n\u4e8b\u4ef6\u54cd\u5e94\u3001\u624b\u52bf\u8bc6\u522b\u3001\u754c\u9762\u5237\u65b0\n\u7f51\u7edc\u8bf7\u6c42\nAutoreleasePool"),Object(r.b)("p",null,"\u6ca1\u6709Runloop\u6267\u884c\u5b8c13\u884c\u4ee3\u7801\u5c31\u9000\u51fa\u4e86"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012215614478",src:n(857).default})),Object(r.b)("h2",{id:"runloop\u7684\u57fa\u672c\u4f5c\u7528"},"RunLoop\u7684\u57fa\u672c\u4f5c\u7528"),Object(r.b)("p",null,"\u4fdd\u6301\u7a0b\u5e8f\u7684\u6301\u7eed\u8fd0\u884c\n\u5904\u7406App\u4e2d\u7684\u5404\u79cd\u4e8b\u4ef6\uff08\u6bd4\u5982\u89e6\u6478\u4e8b\u4ef6\u3001\u5b9a\u65f6\u5668\u4e8b\u4ef6\u7b49\uff09\n\u8282\u7701CPU\u8d44\u6e90\uff0c\u63d0\u9ad8\u7a0b\u5e8f\u6027\u80fd\uff1a\u8be5\u505a\u4e8b\u65f6\u505a\u4e8b\uff0c\u8be5\u4f11\u606f\u65f6\u4f11\u606f\n......"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012215825840",src:n(858).default})),Object(r.b)("h2",{id:"nsrunloop\u5bf9\u8c61"},"NSRunLoop\u5bf9\u8c61"),Object(r.b)("p",null,"iOS\u4e2d\u67092\u5957API\u6765\u8bbf\u95ee\u548c\u4f7f\u7528RunLoop\nFoundation\uff1aNSRunLoop"),Object(r.b)("p",null,"Core Foundation\uff1aCFRunLoopRef"),Object(r.b)("p",null,"NSRunLoop\u548cCFRunLoopRef\u90fd\u4ee3\u8868\u7740RunLoop\u5bf9\u8c61\nNSRunLoop\u662f\u57fa\u4e8eCFRunLoopRef\u7684\u4e00\u5c42OC\u5305\u88c5\nCFRunLoopRef\u662f\u5f00\u6e90\u7684\n",Object(r.b)("a",{parentName:"p",href:"https://opensource.apple.com/tarballs/CF/"},"https://opensource.apple.com/tarballs/CF/")),Object(r.b)("h2",{id:"runloop\u4e0e\u7ebf\u7a0b"},"Runloop\u4e0e\u7ebf\u7a0b"),Object(r.b)("p",null,"\u6bcf\u6761\u7ebf\u7a0b\u90fd\u6709\u552f\u4e00\u7684\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684RunLoop\u5bf9\u8c61"),Object(r.b)("p",null,"RunLoop\u4fdd\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u7684Dictionary\u91cc\uff0c\u7ebf\u7a0b\u4f5c\u4e3akey\uff0cRunLoop\u4f5c\u4e3avalue"),Object(r.b)("p",null,"\u7ebf\u7a0b\u521a\u521b\u5efa\u65f6\u5e76\u6ca1\u6709RunLoop\u5bf9\u8c61\uff0cRunLoop\u4f1a\u5728\u7b2c\u4e00\u6b21\u83b7\u53d6\u5b83\u65f6\u521b\u5efa"),Object(r.b)("p",null,"RunLoop\u4f1a\u5728\u7ebf\u7a0b\u7ed3\u675f\u65f6\u9500\u6bc1"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u4e3b\u7ebf\u7a0b\u7684RunLoop\u5df2\u7ecf\u81ea\u52a8\u83b7\u53d6\uff08\u521b\u5efa\uff09\uff0c\u5b50\u7ebf\u7a0b\u9ed8\u8ba4\u6ca1\u6709\u5f00\u542fRunLoop\u3002",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"\u56e0\u4e3a\u5b50\u7ebf\u7a0b\u6ca1\u6709\u5fc5\u8981\u5f00\u542fRunloop\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u662f\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u5c31\u9000\u51fa\u4e86\u3002\u9700\u8981\u4fdd\u6d3b\u7684\uff0c\u53ef\u4ee5\u5f00\u542fRunloop\u3002")))),Object(r.b)("p",null,"\u200b\t"),Object(r.b)("h2",{id:"\u83b7\u53d6runloop\u5bf9\u8c61"},"\u83b7\u53d6Runloop\u5bf9\u8c61"),Object(r.b)("p",null,"Foundation\n","[NSRunLoop currentRunLoop]","; // \u83b7\u5f97\u5f53\u524d\u7ebf\u7a0b\u7684RunLoop\u5bf9\u8c61\n","[NSRunLoop mainRunLoop]","; // \u83b7\u5f97\u4e3b\u7ebf\u7a0b\u7684RunLoop\u5bf9\u8c61"),Object(r.b)("p",null,"Core Foundation\nCFRunLoopGetCurrent(); // \u83b7\u5f97\u5f53\u524d\u7ebf\u7a0b\u7684RunLoop\u5bf9\u8c61\nCFRunLoopGetMain(); // \u83b7\u5f97\u4e3b\u7ebf\u7a0b\u7684RunLoop\u5bf9\u8c61"),Object(r.b)("h2",{id:"runloop\u76f8\u5173\u7684\u7c7b"},"RunLoop\u76f8\u5173\u7684\u7c7b"),Object(r.b)("p",null,"Core Foundation\u4e2d\u5173\u4e8eRunLoop\u76845\u4e2a\u7c7b\nCFRunLoopRef\nCFRunLoopModeRef\nCFRunLoopSourceRef\nCFRunLoopTimerRef\nCFRunLoopObserverRef"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012220131581",src:n(859).default})),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012220141130",src:n(860).default})),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012220156017",src:n(861).default})),Object(r.b)("h2",{id:"cfrunloopmoderef"},"CFRunLoopModeRef"),Object(r.b)("p",null,"CFRunLoopModeRef\u4ee3\u8868RunLoop\u7684\u8fd0\u884c\u6a21\u5f0f"),Object(r.b)("p",null,"\u4e00\u4e2aRunLoop\u5305\u542b\u82e5\u5e72\u4e2aMode\uff0c\u6bcf\u4e2aMode\u53c8\u5305\u542b\u82e5\u5e72\u4e2aSource0/Source1/Timer/Observer"),Object(r.b)("p",null,"RunLoop\u542f\u52a8\u65f6\u53ea\u80fd\u9009\u62e9\u5176\u4e2d\u4e00\u4e2aMode\uff0c\u4f5c\u4e3acurrentMode"),Object(r.b)("p",null,"\u5982\u679c\u9700\u8981\u5207\u6362Mode\uff0c\u53ea\u80fd\u9000\u51fa\u5f53\u524dLoop\uff0c\u518d\u91cd\u65b0\u9009\u62e9\u4e00\u4e2aMode\u8fdb\u5165\n\u4e0d\u540c\u7ec4\u7684Source0/Source1/Timer/Observer\u80fd\u5206\u9694\u5f00\u6765\uff0c\u4e92\u4e0d\u5f71\u54cd"),Object(r.b)("p",null,"\u5982\u679cMode\u91cc\u6ca1\u6709\u4efb\u4f55Source0/Source1/Timer/Observer\uff0cRunLoop\u4f1a\u7acb\u9a6c\u9000\u51fa"),Object(r.b)("h3",{id:"\u5e38\u89c1\u76842\u79cdmode"},"\u5e38\u89c1\u76842\u79cdMode"),Object(r.b)("p",null,"kCFRunLoopDefaultMode\uff08NSDefaultRunLoopMode\uff09\uff1aApp\u7684\u9ed8\u8ba4Mode\uff0c\u901a\u5e38\u4e3b\u7ebf\u7a0b\u662f\u5728\u8fd9\u4e2aMode\u4e0b\u8fd0\u884c"),Object(r.b)("p",null,"UITrackingRunLoopMode\uff1a\u754c\u9762\u8ddf\u8e2a Mode\uff0c\u7528\u4e8e ScrollView \u8ffd\u8e2a\u89e6\u6478\u6ed1\u52a8\uff0c\u4fdd\u8bc1\u754c\u9762\u6ed1\u52a8\u65f6\u4e0d\u53d7\u5176\u4ed6 Mode \u5f71\u54cd"),Object(r.b)("h2",{id:"cfrunloopobserverref"},"CFRunLoopObserverRef"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012220329834",src:n(862).default})),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012220404532",src:n(863).default})),Object(r.b)("h2",{id:"runloop\u7684\u8fd0\u884c\u903b\u8f91"},"RunLoop\u7684\u8fd0\u884c\u903b\u8f91"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Source0\n\u89e6\u6478\u4e8b\u4ef6\u5904\u7406\nperformSelector:onThread:")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Source1\n\u57fa\u4e8ePort\u7684\u7ebf\u7a0b\u95f4\u901a\u4fe1\n\u7cfb\u7edf\u4e8b\u4ef6\u6355\u6349")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Timers\nNSTimer\nperformSelector:withObject:afterDelay:")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Observers\n\u7528\u4e8e\u76d1\u542cRunLoop\u7684\u72b6\u6001\nUI\u5237\u65b0\uff08BeforeWaiting\uff09\nAutorelease pool\uff08BeforeWaiting\uff09"))),Object(r.b)("p",null,"01\u3001\u901a\u77e5Observers\uff1a\u8fdb\u5165Loop\n02\u3001\u901a\u77e5Observers\uff1a\u5373\u5c06\u5904\u7406Timers\n03\u3001\u901a\u77e5Observers\uff1a\u5373\u5c06\u5904\u7406Sources\n04\u3001\u5904\u7406Blocks\n05\u3001\u5904\u7406Source0\uff08\u53ef\u80fd\u4f1a\u518d\u6b21\u5904\u7406Blocks\uff09\n06\u3001\u5982\u679c\u5b58\u5728Source1\uff0c\u5c31\u8df3\u8f6c\u5230\u7b2c8\u6b65\n07\u3001\u901a\u77e5Observers\uff1a\u5f00\u59cb\u4f11\u7720\uff08\u7b49\u5f85\u6d88\u606f\u5524\u9192\uff09\n08\u3001\u901a\u77e5Observers\uff1a\u7ed3\u675f\u4f11\u7720\uff08\u88ab\u67d0\u4e2a\u6d88\u606f\u5524\u9192\uff09\n01> \u5904\u7406Timer\n02> \u5904\u7406GCD Async To Main Queue\n03> \u5904\u7406Source1\n09\u3001\u5904\u7406Blocks\n10\u3001\u6839\u636e\u524d\u9762\u7684\u6267\u884c\u7ed3\u679c\uff0c\u51b3\u5b9a\u5982\u4f55\u64cd\u4f5c\n01> \u56de\u5230\u7b2c02\u6b65\n02> \u9000\u51faLoop\n11\u3001\u901a\u77e5Observers\uff1a\u9000\u51faLoop"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012220604739",src:n(864).default})),Object(r.b)("h2",{id:"runloop\u4f11\u7720\u7684\u5b9e\u73b0\u539f\u7406"},"RunLoop\u4f11\u7720\u7684\u5b9e\u73b0\u539f\u7406"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211012220631434",src:n(865).default})),Object(r.b)("h2",{id:"runloop\u5728\u5b9e\u9645\u5f00\u4e2d\u7684\u5e94\u7528"},"RunLoop\u5728\u5b9e\u9645\u5f00\u4e2d\u7684\u5e94\u7528"),Object(r.b)("p",null,"\u63a7\u5236\u7ebf\u7a0b\u751f\u547d\u5468\u671f\uff08\u7ebf\u7a0b\u4fdd\u6d3b\uff09"),Object(r.b)("p",null,"\u89e3\u51b3NSTimer\u5728\u6ed1\u52a8\u65f6\u505c\u6b62\u5de5\u4f5c\u7684\u95ee\u9898"),Object(r.b)("p",null,"\u76d1\u63a7\u5e94\u7528\u5361\u987f"),Object(r.b)("p",null,"\u6027\u80fd\u4f18\u5316"),Object(r.b)("h2",{id:"runloop\u6848\u4f8b\u5206\u6790"},"Runloop\u6848\u4f8b\u5206\u6790"),Object(r.b)("h3",{id:"\u6848\u4f8b\u5206\u67901\uff1anstimer"},"\u6848\u4f8b\u5206\u67901\uff1aNSTimer"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211011105425050",src:n(866).default})),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1\n  * frame #0: 0x000000010f9623e0 Interview03-RunLoop`__41-[ViewController touchesBegan:withEvent:]_block_invoke(.block_descriptor=0x000000010f964108, timer=0x0000600000d412c0) at ViewController.m:130:9\n    frame #1: 0x00007fff20844188 Foundation`__NSFireTimer + 67\n    frame #2: 0x00007fff2036a6c6 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ + 20\n    frame #3: 0x00007fff2036a1c2 CoreFoundation`__CFRunLoopDoTimer + 923\n    frame #4: 0x00007fff20369781 CoreFoundation`__CFRunLoopDoTimers + 265\n    frame #5: 0x00007fff20363dc0 CoreFoundation`__CFRunLoopRun + 2010\n    frame #6: 0x00007fff20363103 CoreFoundation`CFRunLoopRunSpecific + 567\n    frame #7: 0x00007fff2c851cd3 GraphicsServices`GSEventRunModal + 139\n    frame #8: 0x00007fff24ffbe63 UIKitCore`-[UIApplication _run] + 928\n    frame #9: 0x00007fff25000a53 UIKitCore`UIApplicationMain + 101\n    frame #10: 0x000000010f962468 Interview03-RunLoop`main(argc=1, argv=0x00007ffee029dc10) at main.m:14:16\n    frame #11: 0x000000010f971e1e dyld_sim`start_sim + 10\n(lldb) \n")),Object(r.b)("h3",{id:"\u6848\u4f8b\u5206\u67902\uff1asocket\u901a\u4fe1"},"\u6848\u4f8b\u5206\u67902\uff1aSocket\u901a\u4fe1"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211011105715533",src:n(867).default})),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 15.1\n  * frame #0: 0x000000010184c100 macdemo2`-[RZLimitSpeedUploadHelper stream:handleEvent:](self=0x000060000254b1e0, _cmd=\"stream:handleEvent:\", stream=0x0000600003356f40, eventCode=NSStreamEventHasSpaceAvailable) at RZLimitSpeedUploadHelper.m:137:35\n    frame #1: 0x00007fff204d1005 CoreFoundation`_signalEventSync + 219\n    frame #2: 0x00007fff204d0f02 CoreFoundation`_cfstream_solo_signalEventSync + 266\n    frame #3: 0x00007fff204d0dba CoreFoundation`_CFStreamSignalEvent + 454\n    frame #4: 0x00007fff2479f46b CFNetwork`___lldb_unnamed_symbol1857$$CFNetwork + 213\n    frame #5: 0x00007fff204d0a4b CoreFoundation`__CFSocketPerformV0 + 1018\n    frame #6: 0x00007fff204a82bc CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17\n    frame #7: 0x00007fff204a8224 CoreFoundation`__CFRunLoopDoSource0 + 180\n    frame #8: 0x00007fff204a7fa4 CoreFoundation`__CFRunLoopDoSources0 + 242\n    frame #9: 0x00007fff204a69cc CoreFoundation`__CFRunLoopRun + 893\n    frame #10: 0x00007fff204a5f8c CoreFoundation`CFRunLoopRunSpecific + 563\n    frame #11: 0x00007fff286ee1f3 HIToolbox`RunCurrentEventLoopInMode + 292\n    frame #12: 0x00007fff286edf55 HIToolbox`ReceiveNextEventCommon + 587\n    frame #13: 0x00007fff286edcf3 HIToolbox`_BlockUntilNextEventMatchingListInModeWithFilter + 70\n    frame #14: 0x00007fff22caf172 AppKit`_DPSNextEvent + 864\n    frame #15: 0x00007fff22cad945 AppKit`-[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:] + 1364\n\n")),Object(r.b)("h3",{id:"\u6848\u4f8b\u5206\u67903\uff1a\u5b50\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1"},"\u6848\u4f8b\u5206\u67903\uff1a\u5b50\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1"),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211011105954041",src:n(868).default})),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'(lldb) bt\n* thread #9, stop reason = breakpoint 1.1\n  * frame #0: 0x000000010e88a174 Interview03-\u7ebf\u7a0b\u4fdd\u6d3b`__41-[ViewController touchesBegan:withEvent:]_block_invoke(.block_descriptor=0x0000600002952e20) at ViewController.m:32:43\n    frame #1: 0x000000010e889f56 Interview03-\u7ebf\u7a0b\u4fdd\u6d3b`-[MJPermenantThread __executeTask:](self=0x0000600002525380, _cmd="__executeTask:", task=0x000000010e88a160) at MJPermenantThread.m:99:5\n    frame #2: 0x00007fff2084258c Foundation`__NSThreadPerformPerform + 207\n    frame #3: 0x00007fff20369e25 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17\n    frame #4: 0x00007fff20369d1d CoreFoundation`__CFRunLoopDoSource0 + 180\n    frame #5: 0x00007fff203691f2 CoreFoundation`__CFRunLoopDoSources0 + 242\n    frame #6: 0x00007fff20363951 CoreFoundation`__CFRunLoopRun + 875\n    frame #7: 0x00007fff20363103 CoreFoundation`CFRunLoopRunSpecific + 567\n    frame #8: 0x000000010e889c69 Interview03-\u7ebf\u7a0b\u4fdd\u6d3b`__25-[MJPermenantThread init]_block_invoke(.block_descriptor=0x000000010e88c0f8) at MJPermenantThread.m:47:13\n    frame #9: 0x00007fff20842142 Foundation`__NSThread__start__ + 999\n    frame #10: 0x00007fff6bfee8fc libsystem_pthread.dylib`_pthread_start + 224\n    frame #11: 0x00007fff6bfea443 libsystem_pthread.dylib`thread_start + 15\n(lldb) \n')),Object(r.b)("h3",{id:"\u6848\u4f8b\u5206\u67904\uff1a\u76d1\u542cobserver"},"\u6848\u4f8b\u5206\u67904\uff1a\u76d1\u542cObserver"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 3.1\n  * frame #0: 0x000000010b4f626c Interview03-RunLoop`__29-[ViewController viewDidLoad]_block_invoke(.block_descriptor=0x000000010b4f80c8, observer=0x00006000002d03c0, activity=kCFRunLoopEntry) at ViewController.m:100:48\n    frame #1: 0x00007fff20368c77 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 23\n    frame #2: 0x00007fff2036349c CoreFoundation`__CFRunLoopDoObservers + 541\n    frame #3: 0x00007fff2036308a CoreFoundation`CFRunLoopRunSpecific + 446\n    frame #4: 0x00007fff2c851cd3 GraphicsServices`GSEventRunModal + 139\n    frame #5: 0x00007fff24ffbe63 UIKitCore`-[UIApplication _run] + 928\n    frame #6: 0x00007fff25000a53 UIKitCore`UIApplicationMain + 101\n    frame #7: 0x000000010b4f6468 Interview03-RunLoop`main(argc=1, argv=0x00007ffee4709c10) at main.m:14:16\n    frame #8: 0x000000010b505e1e dyld_sim`start_sim + 10\n(lldb) \n")),Object(r.b)("h3",{id:"runloop\u8c03\u7528\u6808"},"Runloop\u8c03\u7528\u6808"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"    frame #3: 0x00007fff20369e25 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17\n    frame #4: 0x00007fff20369d1d CoreFoundation`__CFRunLoopDoSource0 + 180\n    frame #5: 0x00007fff203691f2 CoreFoundation`__CFRunLoopDoSources0 + 242\n    frame #6: 0x00007fff20363951 CoreFoundation`__CFRunLoopRun + 875\n    frame #7: 0x00007fff20363103 CoreFoundation`CFRunLoopRunSpecific + 567\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"    frame #2: 0x00007fff2036a6c6 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ + 20\n    frame #3: 0x00007fff2036a1c2 CoreFoundation`__CFRunLoopDoTimer + 923\n    frame #4: 0x00007fff20369781 CoreFoundation`__CFRunLoopDoTimers + 265\n    frame #5: 0x00007fff20363dc0 CoreFoundation`__CFRunLoopRun + 2010\n    frame #6: 0x00007fff20363103 CoreFoundation`CFRunLoopRunSpecific + 567\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"    frame #1: 0x00007fff20368c77 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 23\n    frame #2: 0x00007fff2036349c CoreFoundation`__CFRunLoopDoObservers + 541\n    frame #3: 0x00007fff2036308a CoreFoundation`CFRunLoopRunSpecific + 446\n")),Object(r.b)("h3",{id:"source1"},"Source1"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(lldb) b __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__\nBreakpoint 9: where = CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__, address = 0x00007fff2036a6c8\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 9.1\n  * frame #0: 0x00007fff2036a6c8 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__\n    frame #1: 0x00007fff20369abe CoreFoundation`__CFRunLoopDoSource1 + 607\n    frame #2: 0x00007fff20363ff8 CoreFoundation`__CFRunLoopRun + 2578\n    frame #3: 0x00007fff20363103 CoreFoundation`CFRunLoopRunSpecific + 567\n    frame #4: 0x00007fff2c851cd3 GraphicsServices`GSEventRunModal + 139\n    frame #5: 0x00007fff24ffbe63 UIKitCore`-[UIApplication _run] + 928\n    frame #6: 0x00007fff25000a53 UIKitCore`UIApplicationMain + 101\n    frame #7: 0x0000000104b383f8 Interview03-RunLoop`main(argc=1, argv=0x00007ffeeb0c7c10) at main.m:14:16\n    frame #8: 0x0000000104b47e1e dyld_sim`start_sim + 10\n(lldb) \n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"2021-10-11 14:18:49.837749+0800 Interview03-RunLoop[43991:1876885] kCFRunLoopBeforeTimers - kCFRunLoopDefaultMode\n2021-10-11 14:18:49.838001+0800 Interview03-RunLoop[43991:1876885] kCFRunLoopBeforeSources - kCFRunLoopDefaultMode\n2021-10-11 14:18:49.838190+0800 Interview03-RunLoop[43991:1876885] kCFRunLoopBeforeWaiting - kCFRunLoopDefaultMode\n2021-10-11 14:18:49.859221+0800 Interview03-RunLoop[43991:1876885] kCFRunLoopAfterWaiting - kCFRunLoopDefaultMode\n(lldb) \n")),Object(r.b)("p",null,Object(r.b)("img",{alt:"image-20211011141930666",src:n(869).default})),Object(r.b)("p",null,"Call Out"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"    static void __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__();\n    static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__();\n    static void __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__();\n    static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__();\n    static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__();\n    static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__();\n")),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://www.cnblogs.com/kenshincui/p/6823841.html"},"iOS\u5228\u6839\u95ee\u5e95-\u6df1\u5165\u7406\u89e3RunLoop")),Object(r.b)("h1",{id:"autoreleasepool"},"autoreleasepool"),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://draveness.me/autoreleasepool"},"https://draveness.me/autoreleasepool")),Object(r.b)("p",null,"\u53c2\u8003\u6587\u6863"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://draveness.me/autoreleasepool"},"\u81ea\u52a8\u91ca\u653e\u6c60\u7684\u524d\u4e16\u4eca\u751f ---- \u6df1\u5165\u89e3\u6790 autoreleasepool"))),Object(r.b)("p",null,"autoreleasepool \u4ee5\u4e00\u4e2a\u961f\u5217\u6570\u7ec4\u7684\u5f62\u5f0f\u5b9e\u73b0,\u4e3b\u8981\u901a\u8fc7\u4e0b\u5217\u4e09\u4e2a\u51fd\u6570\u5b8c\u6210."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"1. `objc_autoreleasepoolPush`\n2. `objc_autoreleasepoolPop`\n3. `objc_autorelease`\n")),Object(r.b)("p",null,"\u770b\u51fd\u6570\u540d\u5c31\u53ef\u4ee5\u77e5\u9053\uff0c\u5bf9 autorelease \u5206\u522b\u6267\u884c push\uff0c\u548c pop \u64cd\u4f5c\u3002\u9500\u6bc1\u5bf9\u8c61\u65f6\u6267\u884crelease\u64cd\u4f5c\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-objective-c"},"            @autoreleasepool { // r3 = push()\n                MJPerson *p4 = [[[MJPerson alloc] init] autorelease];\n                \n                _objc_autoreleasePoolPrint();\n            } // pop(r3)\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-objective-c"},"@autoreleasepool {} \u88ab\u8f6c\u6362\u4e3a\uff1a\n{\n    __AtAutoreleasePool __autoreleasepool;\n}\n\n//\u5728\u5927\u62ec\u53f7\u7684\u4f5c\u7528\u57df\u91cc\u9762\u4f1a\u8c03\u7528\u6784\u9020\u548c\u6790\u6784\uff01\n\nstruct __AtAutoreleasePool {\n  __AtAutoreleasePool() {atautoreleasepoolobj = objc_autoreleasePoolPush();}\n  ~__AtAutoreleasePool() {objc_autoreleasePoolPop(atautoreleasepoolobj);}\n  void * atautoreleasepoolobj;\n};\n\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-objective-c"},"@autoreleasepool { // r3 = push()\n    MJPerson *p4 = [[[MJPerson alloc] init] autorelease];\n} // pop(r3)\n")),Object(r.b)("p",null,"\u200b            \u5b9e\u9645\u4e3a\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-objective-c"},"{\n    void * atautoreleasepoolobj = objc_autoreleasePoolPush();\n    MJPerson *p4 = [[[MJPerson alloc] init] autorelease];\n    // do whatever you want\n    objc_autoreleasePoolPop(atautoreleasepoolobj);\n}\n            \n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"void *objc_autoreleasePoolPush(void) {\n    return AutoreleasePoolPage::push();\n}\n\nvoid objc_autoreleasePoolPop(void *ctxt) {\n    AutoreleasePoolPage::pop(ctxt);\n}\n")),Object(r.b)("p",null,"\u4e0a\u9762\u7684\u65b9\u6cd5\u770b\u4e0a\u53bb\u662f\u5bf9 ",Object(r.b)("inlineCode",{parentName:"p"},"AutoreleasePoolPage")," \u5bf9\u5e94",Object(r.b)("strong",{parentName:"p"},"\u9759\u6001\u65b9\u6cd5")," ",Object(r.b)("inlineCode",{parentName:"p"},"push")," \u548c ",Object(r.b)("inlineCode",{parentName:"p"},"pop")," \u7684\u5c01\u88c5\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"class AutoreleasePoolPage {\n    magic_t const magic;\n    id *next;\n    pthread_t const thread;\n    AutoreleasePoolPage * const parent;\n    AutoreleasePoolPage *child;\n    uint32_t const depth;\n    uint32_t hiwat;\n};\n")),Object(r.b)("p",null,"\u5728\u6bcf\u4e2a\u81ea\u52a8\u91ca\u653e\u6c60\u521d\u59cb\u5316\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"objc_autoreleasePoolPush")," \u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u628a\u4e00\u4e2a ",Object(r.b)("inlineCode",{parentName:"p"},"POOL_SENTINEL")," push \u5230\u81ea\u52a8\u91ca\u653e\u6c60\u7684\u6808\u9876\uff0c\u5e76\u4e14\u8fd4\u56de\u8fd9\u4e2a ",Object(r.b)("inlineCode",{parentName:"p"},"POOL_SENTINEL")," \u54e8\u5175\u5bf9\u8c61\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-objectivec"},"int main(int argc, const char * argv[]) {\n    {\n        void * atautoreleasepoolobj = objc_autoreleasePoolPush();\n\n        // do whatever you want\n\n        objc_autoreleasePoolPop(atautoreleasepoolobj);\n    }\n    return 0;\n}\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"\u4e0a\u9762\u7684 ",Object(r.b)("inlineCode",{parentName:"p"},"atautoreleasepoolobj")," \u5c31\u662f\u4e00\u4e2a ",Object(r.b)("inlineCode",{parentName:"p"},"POOL_SENTINEL"),"\u3002")),Object(r.b)("p",null,"\u800c\u5f53\u65b9\u6cd5 ",Object(r.b)("inlineCode",{parentName:"p"},"objc_autoreleasePoolPop")," \u8c03\u7528\u65f6\uff0c\u5c31\u4f1a\u5411\u81ea\u52a8\u91ca\u653e\u6c60\u4e2d\u7684\u5bf9\u8c61\u53d1\u9001 ",Object(r.b)("inlineCode",{parentName:"p"},"release")," \u6d88\u606f\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a ",Object(r.b)("inlineCode",{parentName:"p"},"POOL_SENTINEL"),"\uff1a"),Object(r.b)("p",null,"\u7406\u89e3\uff1a\u6bcf\u6765\u4e00\u4e2a@autoreleasepool {} \u5c31\u4f1a\u6dfb\u52a0\u4e00\u4e2a\u54e8\u5175\u5bf9\u8c61\uff0c\u5927\u62ec\u53f7\u4f5c\u7528\u57df\u7ed3\u5c3e\u9000\u6808\u5230\u54e8\u5175\u5bf9\u8c61\u3002"),Object(r.b)("h3",{id:"objc_autoreleasepoolpush-\u65b9\u6cd5"},"objc_autoreleasePoolPush \u65b9\u6cd5"))}b.isMDXComponent=!0},356:function(e,o,n){"use strict";n.d(o,"a",(function(){return b})),n.d(o,"b",(function(){return d}));var t=n(0),a=n.n(t);function r(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}function l(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,t)}return n}function u(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?l(Object(n),!0).forEach((function(o){r(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}function c(e,o){if(null==e)return{};var n,t,a=function(e,o){if(null==e)return{};var n,t,a={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],o.indexOf(n)>=0||(a[n]=e[n]);return a}(e,o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)n=r[t],o.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),i=function(e){var o=a.a.useContext(p),n=o;return e&&(n="function"==typeof e?e(o):u(u({},o),e)),n},b=function(e){var o=i(e.components);return a.a.createElement(p.Provider,{value:o},e.children)},f={inlineCode:"code",wrapper:function(e){var o=e.children;return a.a.createElement(a.a.Fragment,{},o)}},s=a.a.forwardRef((function(e,o){var n=e.components,t=e.mdxType,r=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),b=i(n),s=t,d=b["".concat(l,".").concat(s)]||b[s]||f[s]||r;return n?a.a.createElement(d,u(u({ref:o},p),{},{components:n})):a.a.createElement(d,u({ref:o},p))}));function d(e,o){var n=arguments,t=o&&o.mdxType;if("string"==typeof e||t){var r=n.length,l=new Array(r);l[0]=s;var u={};for(var c in o)hasOwnProperty.call(o,c)&&(u[c]=o[c]);u.originalType=e,u.mdxType="string"==typeof e?e:t,l[1]=u;for(var p=2;p<r;p++)l[p]=n[p];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,n)}s.displayName="MDXCreateElement"},856:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012215632058-9fb55dca100bcd3ac3ad0fe9b39107be.png"},857:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012215614478-d8f6b041d88f20afedbea49f29da3d1a.png"},858:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012215825840-6be2f01c812bd099dec8c0418a323864.png"},859:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012220131581-31733f83dac8bba7f1f78b71b4308134.png"},860:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012220141130-9d89e698a251e82f289abb7e2c349fd1.png"},861:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012220156017-2336b4f28d30d0f309681fd35ea634bd.png"},862:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012220329834-35b0deb2b89eeb251903f43296b5a362.png"},863:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012220404532-9a6b98c4e8521c183eb371e16549de2a.png"},864:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012220604739-5d0b938111391c53621edd42096c1e00.png"},865:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211012220631434-c13195538dde2f3dfc7ced1324959605.png"},866:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211011105425050-57767b359c0c7aca17e1856c94fcc91a.png"},867:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211011105715533-0f29a8b69702f8e0b735bf1c39cbc565.png"},868:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211011105954041-547a6371ae423b9fba716ae5ebce5de2.png"},869:function(e,o,n){"use strict";n.r(o),o.default=n.p+"assets/images/image-20211011141930666-478ee638f9439f70a850da18055a8c08.png"}}]);