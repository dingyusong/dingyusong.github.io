<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Blog Atom Feed"><title data-react-helmet="true">根据线程栈查找对应代码 | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="根据线程栈查找对应代码 | My Site"><meta data-react-helmet="true" name="description" content="根据线程栈查找对应代码"><meta data-react-helmet="true" property="og:description" content="根据线程栈查找对应代码"><meta data-react-helmet="true" property="og:url" content="http://localhost:9999//docs/Apple/崩溃分析/根据线程栈查找对应代码"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://localhost:9999//docs/Apple/崩溃分析/根据线程栈查找对应代码"><link rel="stylesheet" href="/styles.8cfbcdec.css">
<link rel="preload" href="/styles.9ca0c92b.js" as="script">
<link rel="preload" href="/runtime~main.5bad3ec1.js" as="script">
<link rel="preload" href="/main.22d8e8fb.js" as="script">
<link rel="preload" href="/1.9cf17d37.js" as="script">
<link rel="preload" href="/261.52f5f543.js" as="script">
<link rel="preload" href="/262.169b345b.js" as="script">
<link rel="preload" href="/935f2afb.f2cfb3e3.js" as="script">
<link rel="preload" href="/260.17f75af6.js" as="script">
<link rel="preload" href="/f80dd65b.0105ed99.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a><a class="navbar__item navbar__link" href="/docs/">基础</a><a class="navbar__item navbar__link" href="/docs/编程语言/编程语言">语言</a><a class="navbar__item navbar__link" href="/docs/工具/常用工具">工具</a><a class="navbar__item navbar__link" href="/docs/应用开发/应用开发">应用开发</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Apple/iOS开发/iOS开发">Apple</a><a class="navbar__item navbar__link" href="/docs/音视频/音视频">音视频</a><a class="navbar__item navbar__link" href="/docs/项目/项目">项目</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">基础</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/编程语言/编程语言">语言</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/工具/常用工具">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/应用开发/应用开发">应用开发</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/Apple/iOS开发/iOS开发">Apple</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/音视频/音视频">音视频</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/项目/项目">项目</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">根据线程栈查找对应代码</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="根据线程栈查找对应代码"></a>根据线程栈查找对应代码<a class="hash-link" href="#根据线程栈查找对应代码" title="Direct link to heading">#</a></h1><p><img alt="image-20211011175217639" src="/assets/images/image-20211011175217639-ad29d4a366b713f5f1d1b2c7466f7a28.png"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) bt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* thread #25, stop reason = breakpoint 2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * frame #0: 0x0000000107664dc0 RZPaas_macOS`avpriv_slicethread_create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #1: 0x0000000106e16acd RZPaas_macOS`ff_slice_thread_init + 237</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #2: 0x0000000106f1e322 RZPaas_macOS`avcodec_open2 + 2354</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #3: 0x000000010640fd8a RZPaas_macOS`DuoBei::FFmpegContext::InitFFmpeg(this=0x0000600000620b20, config=0x0000700002b96960) at FFmpegContext.cpp:160:9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #4: 0x0000000106412c47 RZPaas_macOS`DuoBei::H264Codec::Init(this=0x0000600000620b20, config=0x0000700002b96960) at H264Codec.cpp:47:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #5: 0x00000001064e3820 RZPaas_macOS`rz::DefaultVideoDecoder::RealInit(this=0x0000600001a42e60) at DefaultVideoDecoder.cpp:89:25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #6: 0x00000001064e3551 RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:14:19</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #7: 0x00000001064e392d RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:12:45</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #8: 0x00000001064e0274 RZPaas_macOS`rz::DefaultVideoCodecProducer::GetDecoder(this=0x000060000331c5b0, eventHandler=0x00007fc175e9d350) at DefaultVideoCodecProducer.cpp:21:45</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #9: 0x000000010668fb2d RZPaas_macOS`rz::StructureFactory::createVideoDecoder(type=VIDEO_CODEC_SOFT_H264, handler=0x00007fc175e9d350) at StructureFactory.cpp:427:65</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #10: 0x0000000106471d15 RZPaas_macOS`rz::VideoDecodecManage::createDecoder(this=0x00007fc175e9d350) at VideoCodecManage.cpp:296:19</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #11: 0x0000000106471af5 RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:167:11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #12: 0x0000000106471e3b RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:163:37</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #13: 0x0000000106472a62 RZPaas_macOS`rz::VideoCodecManageProducer::GetDecoder(this=0x000060000331c670, streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:325:16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #14: 0x0000000106690981 RZPaas_macOS`rz::StructureFactory::createVideoDecoderManage(streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at StructureFactory.cpp:518:35</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #15: 0x00000001063c2d8f RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:46:17</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #16: 0x00000001063c3a9d RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:13:26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #17: 0x0000000106691920 RZPaas_macOS`rz::StructureFactory::createSubVideoStream(stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830, fun=function&lt;void ()&gt; @ 0x0000700002b97570)&gt;) at StructureFactory.cpp:621:20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #18: 0x0000000106596762 RZPaas_macOS`rz::RtcEngineBase::createSubVideoStreamInfo(streamCtx=std::__1::shared_ptr&lt;rz::RemoteVideoStreamContext&gt;::element_type @ 0x00007fc175c366c8 strong=2 weak=1, channelCtx=std::__1::shared_ptr&lt;rz::IRtcChannelContext&gt;::element_type @ 0x00007fc175c81388 strong=2 weak=1, mediaStreamType=MEDIA_STREAM_SUPPORTED, sync=0x0000600000058b40) at RtcEngineBase.cpp:500:13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #19: 0x00000001066398b1 RZPaas_macOS`rz::RtcEngineBase::onRemoteVideoStreamOnline(this=0x0000600001563788)::$_70::operator()() const at RtcEngineBase.cpp:2035:13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #20: 0x000000010663817d RZPaas_macOS`decltype(__f=0x0000600001563788)::$_70&amp;&gt;(fp)()) std::__1::__invoke&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&amp;&gt;(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&amp;) at type_traits:3747:1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #21: 0x000000010663812d RZPaas_macOS`void std::__1::__invoke_void_return_wrapper&lt;void&gt;::__call&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(__args=0x0000600001563788)::$_70&amp;&gt;(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&amp;) at __functional_base:348:9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #22: 0x00000001066380fd RZPaas_macOS`std::__1::__function::__alloc_func&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70, std::__1::allocator&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&gt;, void ()&gt;::operator(this=0x0000600001563788)() at functional:1553:16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #23: 0x0000000106636d49 RZPaas_macOS`std::__1::__function::__func&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70, std::__1::allocator&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&gt;, void ()&gt;::operator(this=0x0000600001563780)() at functional:1727:12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #24: 0x0000000106081c62 RZPaas_macOS`std::__1::__function::__value_func&lt;void ()&gt;::operator(this=0x0000700002b97eb0)() const at functional:1880:16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #25: 0x000000010607f445 RZPaas_macOS`std::__1::function&lt;void ()&gt;::operator(this=0x0000700002b97eb0)() const at functional:2555:12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #26: 0x000000010637547b RZPaas_macOS`rz::InteractiveManage::workFun() at InteractiveManage.cpp:44:21</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #27: 0x0000000106083367 RZPaas_macOS`decltype(__f=(0x00006000033193e8))()&gt;(fp)()) std::__1::__invoke&lt;void (*)()&gt;(void (*&amp;&amp;)()) at type_traits:3747:1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #28: 0x00000001060832d5 RZPaas_macOS`void std::__1::__thread_execute&lt;std::__1::unique_ptr&lt;std::__1::__thread_struct, std::__1::default_delete&lt;std::__1::__thread_struct&gt; &gt;, void (*)()&gt;(__t=size=2, (null)=__tuple_indices&lt;&gt; @ 0x0000700002b97f58)()&gt;&amp;, std::__1::__tuple_indices&lt;&gt;) at thread:280:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #29: 0x0000000106082b2f RZPaas_macOS`void* std::__1::__thread_proxy&lt;std::__1::tuple&lt;std::__1::unique_ptr&lt;std::__1::__thread_struct, std::__1::default_delete&lt;std::__1::__thread_struct&gt; &gt;, void (*)()&gt; &gt;(__vp=0x00006000033193e0) at thread:291:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #30: 0x000000010b92e1b8 libsystem_pthread.dylib`_pthread_start + 224</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #31: 0x000000010b929af7 libsystem_pthread.dylib`thread_start + 15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="thread_worker是什么？"></a>thread_worker是什么？<a class="hash-link" href="#thread_worker是什么？" title="Direct link to heading">#</a></h2><p>thread_worker</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) bt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* thread #177, stop reason = breakpoint 1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * frame #0: 0x0000000107664ff0 RZPaas_macOS`thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #1: 0x000000010b92e1b8 libsystem_pthread.dylib`_pthread_start + 224</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #2: 0x000000010b929af7 libsystem_pthread.dylib`thread_start + 15</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="image-20211011175346803" src="/assets/images/image-20211011175346803-9d9857b49567649338d2314b53a5ff6a.png"></p><p>源码里面搜不到thread_worker 但是符号表里搜出了_thread_worker。显然是个c方法，而且是依赖的静态库里面的。</p><p><img alt="image-20211011180026200" src="/assets/images/image-20211011180026200-9743b5f9fcfb98166b1fa5571905921d.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="有符号就从二进制查起"></a>有符号就从二进制查起<a class="hash-link" href="#有符号就从二进制查起" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hopper-disassembler"></a>hopper disassembler<a class="hash-link" href="#hopper-disassembler" title="Direct link to heading">#</a></h3><p><img alt="image-20211011175153939" src="/assets/images/image-20211011175153939-8fb9e778879751537d2eaaa1f373a82c.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="代码没有就从依赖的静态库找"></a>代码没有就从依赖的静态库找<a class="hash-link" href="#代码没有就从依赖的静态库找" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop) nm -a RunTimeDemo | grep thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/nm: error: RunTimeDemo: No such file or directory.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop) nm -a libavcodec.a | grep thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop) nm -a libabsl_bad_optional_access.a | grep thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop) nm -a libavdevice.a | grep thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop) nm -a libavfilter.a | grep thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop) nm -a libavformat.a | grep thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop) nm -a libavutil.a | grep thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">---------------- t _thread_worker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Mac git:(develop)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>找到了，在libavutil里面</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="查看libavutil源码"></a>查看libavutil源码<a class="hash-link" href="#查看libavutil源码" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavutil/slicethread.c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">static void *attribute_align_arg thread_worker(void *v)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    WorkerContext *w = v;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    AVSliceThread *ctx = w-&gt;ctx;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pthread_mutex_lock(&amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pthread_cond_signal(&amp;w-&gt;cond);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        w-&gt;done = 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        while (w-&gt;done)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_cond_wait(&amp;w-&gt;cond, &amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (ctx-&gt;finished) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_mutex_unlock(&amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return NULL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (run_jobs(ctx)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_mutex_lock(&amp;ctx-&gt;done_mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ctx-&gt;done = 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_cond_signal(&amp;ctx-&gt;done_cond);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_mutex_unlock(&amp;ctx-&gt;done_mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">int avpriv_slicethread_create(AVSliceThread **pctx, void *priv,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                              void (*worker_func)(void *priv, int jobnr, int threadnr, int nb_jobs, int nb_threads),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                              void (*main_func)(void *priv),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                              int nb_threads)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    AVSliceThread *ctx;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int nb_workers, i;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    av_assert0(nb_threads &gt;= 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!nb_threads) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        int nb_cpus = av_cpu_count();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (nb_cpus &gt; 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            nb_threads = nb_cpus + 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            nb_threads = 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    nb_workers = nb_threads;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!main_func)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        nb_workers--;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    *pctx = ctx = av_mallocz(sizeof(*ctx));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!ctx)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return AVERROR(ENOMEM);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (nb_workers &amp;&amp; !(ctx-&gt;workers = av_calloc(nb_workers, sizeof(*ctx-&gt;workers)))) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        av_freep(pctx);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return AVERROR(ENOMEM);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;priv        = priv;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;worker_func = worker_func;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;main_func   = main_func;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;nb_threads  = nb_threads;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;nb_active_threads = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;nb_jobs     = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;finished    = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    atomic_init(&amp;ctx-&gt;first_job, 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    atomic_init(&amp;ctx-&gt;current_job, 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pthread_mutex_init(&amp;ctx-&gt;done_mutex, NULL);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pthread_cond_init(&amp;ctx-&gt;done_cond, NULL);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx-&gt;done        = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    for (i = 0; i &lt; nb_workers; i++) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        WorkerContext *w = &amp;ctx-&gt;workers[i];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        int ret;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        w-&gt;ctx = ctx;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pthread_mutex_init(&amp;w-&gt;mutex, NULL);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pthread_cond_init(&amp;w-&gt;cond, NULL);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pthread_mutex_lock(&amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        w-&gt;done = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (ret = pthread_create(&amp;w-&gt;thread, NULL, thread_worker, w)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ctx-&gt;nb_threads = main_func ? i : i + 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_mutex_unlock(&amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_cond_destroy(&amp;w-&gt;cond);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_mutex_destroy(&amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            avpriv_slicethread_free(pctx);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return AVERROR(ret);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        while (!w-&gt;done)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pthread_cond_wait(&amp;w-&gt;cond, &amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pthread_mutex_unlock(&amp;w-&gt;mutex);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return nb_threads;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="给上级函数打断点"></a>给上级函数打断点<a class="hash-link" href="#给上级函数打断点" title="Direct link to heading">#</a></h3><p>调用thread_worker的函数时avpriv_slicethread_create</p><p>给thread_worker打断点看不到有用信息，则给其调用函数打断点。avpriv_slicethread_create。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">20210926144239 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) breakpoint list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current breakpoints:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1: file = &#x27;/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas_example_mac/rzpaas_example_mac/RZMLoginViewController.m&#x27;, line = 309, exact_match = 0, locations = 1, resolved = 1, hit count = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  1.1: where = rzpaas_example_mac`__46-[RZMLoginViewController rz_startLastMileTest]_block_invoke.206 + 437 at RZMLoginViewController.m:309:22, address = 0x0000000109331235, resolved, hit count = 0 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2: file = &#x27;/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas-sdk-apple/RZPaas/Classes/rz-paas-sdk/Base/rtcCore/libsol2/src/sol2/impl/libuv/LoopImplLibuv.cpp&#x27;, line = 35, exact_match = 0, locations = 1, resolved = 1, hit count = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  2.1: where = RZPaas_macOS`sol2::LoopImplLibuv::run() + 24 at LoopImplLibuv.cpp:35:5, address = 0x000000010b313738, resolved, hit count = 0 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3: file = &#x27;/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas-sdk-apple/RZPaas/Classes/rz-paas-sdk/Base/rtcCore/libsol2/src/sol2/Sol2WorkThreads.cpp&#x27;, line = 60, exact_match = 0, locations = 1, resolved = 1, hit count = 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  3.1: where = RZPaas_macOS`sol2::Sol2WorkThreads::Sol2WorkThreads() + 147 at Sol2WorkThreads.cpp:60:39, address = 0x000000010b308913, resolved, hit count = 1 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">4: file = &#x27;/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas-sdk-apple/RZPaas/Classes/rz-paas-sdk/Base/ThreadPool.cpp&#x27;, line = 28, exact_match = 0, locations = 1, resolved = 1, hit count = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  4.1: where = RZPaas_macOS`rz::Thread::ThreadFun() + 383 at ThreadPool.cpp:28:7, address = 0x000000010979a96f, resolved, hit count = 5 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5: name = &#x27;_thread_worker&#x27;, locations = 0 (pending)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6: name = &#x27;thread_worker&#x27;, locations = 1, resolved = 1, hit count = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  6.1: where = RZPaas_macOS`thread_worker, address = 0x000000010ad0fff0, resolved, hit count = 0 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7: name = &#x27;createRZRtcEngine&#x27;, locations = 1, resolved = 1, hit count = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  7.1: where = RZPaas_macOS`createRZRtcEngine + 32 at RtcEngine.cpp:27:9, address = 0x0000000109bea3c0, resolved, hit count = 0 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="源码中定位"></a>源码中定位<a class="hash-link" href="#源码中定位" title="Direct link to heading">#</a></h3><p>运行起来，源码中定位</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) bt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* thread #25, stop reason = breakpoint 2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * frame #0: 0x0000000107664dc0 RZPaas_macOS`avpriv_slicethread_create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #1: 0x0000000106e16acd RZPaas_macOS`ff_slice_thread_init + 237</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #2: 0x0000000106f1e322 RZPaas_macOS`avcodec_open2 + 2354</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #3: 0x000000010640fd8a RZPaas_macOS`DuoBei::FFmpegContext::InitFFmpeg(this=0x0000600000620b20, config=0x0000700002b96960) at FFmpegContext.cpp:160:9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #4: 0x0000000106412c47 RZPaas_macOS`DuoBei::H264Codec::Init(this=0x0000600000620b20, config=0x0000700002b96960) at H264Codec.cpp:47:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #5: 0x00000001064e3820 RZPaas_macOS`rz::DefaultVideoDecoder::RealInit(this=0x0000600001a42e60) at DefaultVideoDecoder.cpp:89:25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #6: 0x00000001064e3551 RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:14:19</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #7: 0x00000001064e392d RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:12:45</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #8: 0x00000001064e0274 RZPaas_macOS`rz::DefaultVideoCodecProducer::GetDecoder(this=0x000060000331c5b0, eventHandler=0x00007fc175e9d350) at DefaultVideoCodecProducer.cpp:21:45</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #9: 0x000000010668fb2d RZPaas_macOS`rz::StructureFactory::createVideoDecoder(type=VIDEO_CODEC_SOFT_H264, handler=0x00007fc175e9d350) at StructureFactory.cpp:427:65</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #10: 0x0000000106471d15 RZPaas_macOS`rz::VideoDecodecManage::createDecoder(this=0x00007fc175e9d350) at VideoCodecManage.cpp:296:19</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #11: 0x0000000106471af5 RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:167:11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #12: 0x0000000106471e3b RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:163:37</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #13: 0x0000000106472a62 RZPaas_macOS`rz::VideoCodecManageProducer::GetDecoder(this=0x000060000331c670, streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:325:16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #14: 0x0000000106690981 RZPaas_macOS`rz::StructureFactory::createVideoDecoderManage(streamId=&quot;video-15b2abf5d3ca5be590145998ce1acc49&quot;, codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at StructureFactory.cpp:518:35</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #15: 0x00000001063c2d8f RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:46:17</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #16: 0x00000001063c3a9d RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:13:26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #17: 0x0000000106691920 RZPaas_macOS`rz::StructureFactory::createSubVideoStream(stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830, fun=function&lt;void ()&gt; @ 0x0000700002b97570)&gt;) at StructureFactory.cpp:621:20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #18: 0x0000000106596762 RZPaas_macOS`rz::RtcEngineBase::createSubVideoStreamInfo(streamCtx=std::__1::shared_ptr&lt;rz::RemoteVideoStreamContext&gt;::element_type @ 0x00007fc175c366c8 strong=2 weak=1, channelCtx=std::__1::shared_ptr&lt;rz::IRtcChannelContext&gt;::element_type @ 0x00007fc175c81388 strong=2 weak=1, mediaStreamType=MEDIA_STREAM_SUPPORTED, sync=0x0000600000058b40) at RtcEngineBase.cpp:500:13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #19: 0x00000001066398b1 RZPaas_macOS`rz::RtcEngineBase::onRemoteVideoStreamOnline(this=0x0000600001563788)::$_70::operator()() const at RtcEngineBase.cpp:2035:13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #20: 0x000000010663817d RZPaas_macOS`decltype(__f=0x0000600001563788)::$_70&amp;&gt;(fp)()) std::__1::__invoke&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&amp;&gt;(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&amp;) at type_traits:3747:1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #21: 0x000000010663812d RZPaas_macOS`void std::__1::__invoke_void_return_wrapper&lt;void&gt;::__call&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(__args=0x0000600001563788)::$_70&amp;&gt;(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&amp;) at __functional_base:348:9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #22: 0x00000001066380fd RZPaas_macOS`std::__1::__function::__alloc_func&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70, std::__1::allocator&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&gt;, void ()&gt;::operator(this=0x0000600001563788)() at functional:1553:16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #23: 0x0000000106636d49 RZPaas_macOS`std::__1::__function::__func&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70, std::__1::allocator&lt;rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::shared_ptr&lt;rz::MediaStreamSync&gt;, std::__1::shared_ptr&lt;rz::MediaStreamInfo&gt; const&amp;)::$_70&gt;, void ()&gt;::operator(this=0x0000600001563780)() at functional:1727:12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #24: 0x0000000106081c62 RZPaas_macOS`std::__1::__function::__value_func&lt;void ()&gt;::operator(this=0x0000700002b97eb0)() const at functional:1880:16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #25: 0x000000010607f445 RZPaas_macOS`std::__1::function&lt;void ()&gt;::operator(this=0x0000700002b97eb0)() const at functional:2555:12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #26: 0x000000010637547b RZPaas_macOS`rz::InteractiveManage::workFun() at InteractiveManage.cpp:44:21</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #27: 0x0000000106083367 RZPaas_macOS`decltype(__f=(0x00006000033193e8))()&gt;(fp)()) std::__1::__invoke&lt;void (*)()&gt;(void (*&amp;&amp;)()) at type_traits:3747:1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #28: 0x00000001060832d5 RZPaas_macOS`void std::__1::__thread_execute&lt;std::__1::unique_ptr&lt;std::__1::__thread_struct, std::__1::default_delete&lt;std::__1::__thread_struct&gt; &gt;, void (*)()&gt;(__t=size=2, (null)=__tuple_indices&lt;&gt; @ 0x0000700002b97f58)()&gt;&amp;, std::__1::__tuple_indices&lt;&gt;) at thread:280:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #29: 0x0000000106082b2f RZPaas_macOS`void* std::__1::__thread_proxy&lt;std::__1::tuple&lt;std::__1::unique_ptr&lt;std::__1::__thread_struct, std::__1::default_delete&lt;std::__1::__thread_struct&gt; &gt;, void (*)()&gt; &gt;(__vp=0x00006000033193e0) at thread:291:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #30: 0x000000010b92e1b8 libsystem_pthread.dylib`_pthread_start + 224</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    frame #31: 0x000000010b929af7 libsystem_pthread.dylib`thread_start + 15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">逆向查找某个符号，根据thread_worker </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>最后定位到了这段代码：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ErrorCode DuoBei::FFmpegContext::InitFFmpeg(const DuoBei::FFmpegInitCfg &amp;config) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert(!this-&gt;IsInit());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ErrorCode Ret = ErrorCode_NoError;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    m_pPaket = av_packet_alloc();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!m_pPaket){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ret = ErrorCode_FFmpeg_PaketInitError;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    m_pFrame = av_frame_alloc();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!m_pFrame) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ret = ErrorCode_FFmpeg_FrameInitError;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if(GetCodecType() == FFmpegContextType::Decode){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ret = this-&gt;InitFFmpegDecode(config);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ( Ret != ErrorCode_NoError){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return Ret;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (GetCodecType() == FFmpegContextType::Encode){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ret = this-&gt;InitFFmpegEncode(config);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ( Ret != ErrorCode_NoError){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return Ret;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (GetCodecType() == FFmpegContextType::VideoConvertor){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ret = this-&gt;InitFFmpegVideoConvertor(config);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ( Ret != ErrorCode_NoError){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return Ret;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    m_pContext = avcodec_alloc_context3(m_pCodec);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!m_pContext) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ret = ErrorCode_FFmpeg_ContextInitError;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this-&gt;FillContextInfo(config);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (avcodec_open2(m_pContext, m_pCodec, nullptr) &lt; 0) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ret = ErrorCode_FFmpeg_CodecOpenError;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (Ret != ErrorCode_NoError){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this-&gt;CloseFFmpeg();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } else{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        m_bFFmpegInited = true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return Ret;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="bcsymbolmap"></a>bcsymbolmap<a class="hash-link" href="#bcsymbolmap" title="Direct link to heading">#</a></h2><p>通过bcsymbolmap找到这个符号大概在什么位置：_threadpool_thread </p><p><img alt="image-20211015101549519" src="/assets/images/image-20211015101549519-4fa6c295a52bac807cc2366bf0affd44.png"></p><p><img alt="image-20211015101644003" src="/assets/images/image-20211015101644003-06386eacd86256fa858fbd24c92fa844.png"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="dys-typora-open://mine/survival/docs/Apple/崩溃分析/根据线程栈查找对应代码.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#thread_worker是什么？" class="table-of-contents__link">thread_worker是什么？</a></li><li><a href="#有符号就从二进制查起" class="table-of-contents__link">有符号就从二进制查起</a><ul><li><a href="#hopper-disassembler" class="table-of-contents__link">hopper disassembler</a></li><li><a href="#代码没有就从依赖的静态库找" class="table-of-contents__link">代码没有就从依赖的静态库找</a></li><li><a href="#查看libavutil源码" class="table-of-contents__link">查看libavutil源码</a></li><li><a href="#给上级函数打断点" class="table-of-contents__link">给上级函数打断点</a></li><li><a href="#源码中定位" class="table-of-contents__link">源码中定位</a></li></ul></li><li><a href="#bcsymbolmap" class="table-of-contents__link">bcsymbolmap</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.9ca0c92b.js"></script>
<script src="/runtime~main.5bad3ec1.js"></script>
<script src="/main.22d8e8fb.js"></script>
<script src="/1.9cf17d37.js"></script>
<script src="/261.52f5f543.js"></script>
<script src="/262.169b345b.js"></script>
<script src="/935f2afb.f2cfb3e3.js"></script>
<script src="/260.17f75af6.js"></script>
<script src="/f80dd65b.0105ed99.js"></script>
</body>
</html>