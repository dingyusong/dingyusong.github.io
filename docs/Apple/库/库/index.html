<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Blog Atom Feed"><title data-react-helmet="true">库 | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="库 | My Site"><meta data-react-helmet="true" name="description" content="title: iOS打包静态库和动态库"><meta data-react-helmet="true" property="og:description" content="title: iOS打包静态库和动态库"><meta data-react-helmet="true" property="og:url" content="http://localhost:9999//docs/Apple/库/库"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://localhost:9999//docs/Apple/库/库"><link rel="stylesheet" href="/styles.8cfbcdec.css">
<link rel="preload" href="/styles.aaa24a49.js" as="script">
<link rel="preload" href="/runtime~main.7eeb3d64.js" as="script">
<link rel="preload" href="/main.7a041c89.js" as="script">
<link rel="preload" href="/1.62b3ea65.js" as="script">
<link rel="preload" href="/257.bb7ed37e.js" as="script">
<link rel="preload" href="/258.ed1b30f8.js" as="script">
<link rel="preload" href="/935f2afb.55f5968c.js" as="script">
<link rel="preload" href="/256.a7530d90.js" as="script">
<link rel="preload" href="/a59fc2db.e6ad0599.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a><a class="navbar__item navbar__link" href="/docs/">编程基础</a><a class="navbar__item navbar__link" href="/docs/编程语言/编程语言">编程语言</a><a class="navbar__item navbar__link" href="/docs/工具/常用工具">工具</a><a class="navbar__item navbar__link" href="/docs/应用开发/应用开发">应用开发</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Apple/iOS开发/iOS开发">Apple</a><a class="navbar__item navbar__link" href="/docs/音视频/音视频">音视频</a><a class="navbar__item navbar__link" href="/docs/项目/项目">项目</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">编程基础</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/编程语言/编程语言">编程语言</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/工具/常用工具">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/应用开发/应用开发">应用开发</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/Apple/iOS开发/iOS开发">Apple</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/音视频/音视频">音视频</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/项目/项目">项目</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/iOS开发/iOS开发">iOS开发</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/macOS开发/macOS开发">macOS开发</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/Apple/库/库">库</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/逆向/iOS逆向">iOS逆向</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/并发编程/并发编程">并发编程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/网络编程/网络编程">网络编程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/开发工具/工具">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/跨平台和热更新/跨平台">跨平台</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/编译构建发布/编译构建发布">编译构建发布</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/崩溃分析/崩溃分析">崩溃分析</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">库</h1></header><div class="markdown"><p>title: iOS打包静态库和动态库
toc: true
date: 2020-05-13 11:22:07
tags:
categories: [iOS]</p><p>hide_title: true</p><hr><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="库"></a>库<a class="hash-link" href="#库" title="Direct link to heading">#</a></h1><p>引导语</p><p>[toc]</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="基础概念"></a>基础概念<a class="hash-link" href="#基础概念" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="库-1"></a>库<a class="hash-link" href="#库-1" title="Direct link to heading">#</a></h3><ul><li>什么是库？</li></ul><p>代码的集合是库。</p><ul><li>为什么会存在库？</li></ul><p>出于共享代码的需求，我们需要以库的方式给第三方提供服务。</p><ul><li>库分为几类?</li></ul><p>按照是否开源情况可分为：</p><ol><li>开源库 </li></ol><p>源代码公开，可以看到具体实现，例如：AFNetworking</p><p><img alt="20200513158936380536001.png" src="/assets/images/20200513158936380536001-625393b481ed0d11bdb334ab619001c0.png"></p><ol start="2"><li>闭源库</li></ol><p>源代码不公开，只公开接口文件。常见于商业公司，例如：微信的分享SDK。</p><p><img alt="image-20200513175554339" src="/assets/images/20200513158936375285984-c6851e7d64244669dba36d74f15febca.png"></p><p>闭源库有分为静态库和动态库。</p><p><img alt="20200513158934066035954.png" src="/assets/images/20200513158934066035954-c2197632c179de64e0050ca1e9c5b077.png"></p><p>存在形式：</p><ul><li>静态库
一般以&quot;.a&quot;或者“.framework”为文件后缀名</li><li>动态库
一般以&quot;.dylib&quot;或者“.framework”为文件后缀名</li></ul><p>注意：不管是<code>.a</code>还是<code>.framework</code>都可以作为动态链接库来使用，这和我们在网上看到文章说<code>.a</code>是静态库是不严谨的。</p><p>通过上面我们得出下面的结论</p><ul><li><code>.a</code>只支持静态库(打包出动态库也是支持的 只不过目前 iOS 不支持加载)</li><li><code>.framework</code>静态库会存在于二进制和<code>Frameworks</code>两份。</li><li>热启动会比冷启动快的多</li><li>静态库比动态库加载快得多</li><li>静态库<code>.framework</code>比<code>.a</code>的二进制文件小的多</li><li>静态库和动态库都推荐用<code>.framework</code>不推荐用<code>.a</code></li></ul><p>作者：君赏
链接：<a href="https://juejin.cn/post/6844904031937101838" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844904031937101838</a>
来源：掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p>注意： 目前ios动态库只能在自己的APP和扩展程序中共享，不能夸APP共享。系统动态库，例如UIKit可以夸APP共享。</p><p><img alt="img" src="/assets/images/16f4057cfc2524a7-934fc62b0e02b54aa22556a57e569a43.png"></p><p>使用区别：</p><ul><li>静态库链接时会被完整的复制到可执行文件中，被多次使用就有多份拷贝。</li></ul><p><img alt="img" src="/assets/images/2756501-f497fddd1e1774ee-86b6da0b0ea5747f9dec9feea3ee66c2.jpg"></p><ul><li>动态库链接时不复制，程序运行时由系统动态加载到内存，供程序调用。而且系统只加载一次，多个程序共用，节省内存。</li></ul><p><img alt="img" src="/assets/images/2756501-675b28b3e1a72efe-d42470b290e60ccdaeb50ee038688496.png"></p><p>ios中系统的自带的库，比如UIKit，都是动态库。</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="查看一个库是动态库还是静态库"></a>查看一个库是动态库还是静态库<a class="hash-link" href="#查看一个库是动态库还是静态库" title="Direct link to heading">#</a></h3><p><code>file</code> 命令查看</p><hr><p><img alt="image-20210226164905149" src="/assets/images/image-20210226164905149-810a9269927293819b6b6aa7b994e444.png"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/demo05/demo05/RZPaas_macOS.framework/Versions/A ll</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total 66816</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x@ 20 dingyusong  staff   640B  2  8 17:56 Headers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x@  3 dingyusong  staff    96B  2  8 17:56 Modules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rwxr-xr-x@  1 dingyusong  staff    33M  2  8 17:56 RZPaas_macOS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x@  3 dingyusong  staff    96B  2  8 17:56 Resources</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/demo05/demo05/RZPaas_macOS.framework/Versions/A file RZPaas_macOS                                                  (0s)[16:33:41]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RZPaas_macOS: Mach-O 64-bit dynamically linked shared library x86_64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><hr><p><img alt="image-20210226164427266" src="/assets/images/image-20210226164427266-de90c6f26fe1bac70d5b2f811a491a93.png"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Library/Developer/Xcode/DerivedData/dys_ios_framework-afshzhjansrrdufaqjffijdjlcte/Build/Products/Debug-iphoneos/dys_ios_framework.framework ll                        (0s)[16:45:08]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total 176</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  4 dingyusong  staff   128B  2 26 16:43 Headers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  1 dingyusong  staff   769B  2 26 16:43 Info.plist</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  3 dingyusong  staff    96B  2 26 16:43 Modules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rwxr-xr-x  1 dingyusong  staff    82K  2 26 16:43 dys_ios_framework</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Library/Developer/Xcode/DerivedData/dys_ios_framework-afshzhjansrrdufaqjffijdjlcte/Build/Products/Debug-iphoneos/dys_ios_framework.framework file dys_ios_framework    (0s)[16:45:10]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dys_ios_framework: Mach-O 64-bit dynamically linked shared library arm64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="image-20210226164614498" src="/assets/images/image-20210226164614498-ce365be86a04944c8e0e275b7b81f40d.png"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Library/Developer/Xcode/DerivedData/dys_ios_framework-afshzhjansrrdufaqjffijdjlcte/Build/Products/Debug-iphoneos/dys_ios_framework.framework ll</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total 32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  4 dingyusong  staff   128B  2 26 16:45 Headers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  1 dingyusong  staff   769B  2 26 16:45 Info.plist</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  3 dingyusong  staff    96B  2 26 16:45 Modules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  1 dingyusong  staff   8.9K  2 26 16:45 dys_ios_framework</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Library/Developer/Xcode/DerivedData/dys_ios_framework-afshzhjansrrdufaqjffijdjlcte/Build/Products/Debug-iphoneos/dys_ios_framework.framework file dys_ios_framework    (1s)[16:46:29]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dys_ios_framework: current ar archive random library</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><hr><p><img alt="image-20210226164013205" src="/assets/images/image-20210226164013205-fa2c5fcf4cb35d1551a424cb78eadc0e.png"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/Users/dingyusong/Library/Developer/Xcode/DerivedData/dys_ios_staticlib-caytngqbessoefesaemaadfrlyap/Build/Products/Release-maccatalyst file libdys_ios_staticlib.a                      (0s)[16:37:55]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libdys_ios_staticlib.a: Mach-O universal binary with 2 architectures: [arm64:current ar archive random library] [x86_64:current ar archive random library]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libdys_ios_staticlib.a (for architecture arm64):    current ar archive random library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libdys_ios_staticlib.a (for architecture x86_64):   current ar archive random library</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><hr><p><img alt="image-20210226164144266" src="/assets/images/image-20210226164144266-c16d53ad94d6e1578a106bca2de69041.png"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Library/Developer/Xcode/DerivedData/dys_ios_staticlib-caytngqbessoefesaemaadfrlyap/Build/Products/Release-maccatalyst file libdys_ios_staticlib.a                      (0s)[16:41:58]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libdys_ios_staticlib.a: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit dynamically linked shared library x86_64] [arm64:Mach-O 64-bit dynamically linked shared library arm64]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libdys_ios_staticlib.a (for architecture x86_64):   Mach-O 64-bit dynamically linked shared library x86_64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libdys_ios_staticlib.a (for architecture arm64):    Mach-O 64-bit dynamically linked shared library arm64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><a href="https://stackoverflow.com/questions/32591878/ios-is-it-a-static-or-a-dynamic-framework" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/32591878/ios-is-it-a-static-or-a-dynamic-framework</a></p><p>Where <code>ar archive</code> means &quot;static library&quot;.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="framework"></a>Framework<a class="hash-link" href="#framework" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="区分打真机包和模拟器包（其实是架构的区别）："></a>区分打真机包和模拟器包（其实是架构的区别）：<a class="hash-link" href="#区分打真机包和模拟器包（其实是架构的区别）：" title="Direct link to heading">#</a></h3><p><img alt="20200518158979803785041.png" src="/assets/images/20200518158979803785041-55f2c7d1c810b12029a8fda56e0d6afb.png"></p><p>选择Generic iOS Device是打真机包</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="区分打release包和debug包："></a>区分打Release包和Debug包：<a class="hash-link" href="#区分打release包和debug包：" title="Direct link to heading">#</a></h3><p>判断一个库是debug还是release</p><p><a href="https://stackoverflow.com/questions/847721/how-to-identify-if-a-library-is-debug-or-release-build" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/847721/how-to-identify-if-a-library-is-debug-or-release-build</a></p><p><img src="http://wiso.liwenhui520.com/20200513158934106047780.png" alt="20200513158934106047780.png"></p><p>framework记着要选择Embed，否则会报image not found。</p><p><img src="http://wiso.liwenhui520.com/202005181589797964347.png" alt="202005181589797964347.png"></p><p>Build Active Architecture Only。如果是yes的话Architecture 则是你电脑的CPU架构 x86_64。如果是NO的话，则支持下面Valid Architecture 所列出来的架构。</p><p><img src="http://wiso.liwenhui520.com/2020051815897979516041.png" alt="2020051815897979516041.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="设置是静态库还是动态库"></a>设置是静态库还是动态库<a class="hash-link" href="#设置是静态库还是动态库" title="Direct link to heading">#</a></h3><p>5、设置打包的是静态库。因为动态库也可以是以framework形式存在，所以需要设置，否则默认打出来的是动态库</p><p>target-&gt;BuildSetting -&gt;搜索关键字mach-&gt;Mach-o Type 设为Static Library（这个默认选项是动态的）</p><p><img alt="image-20210226162644582" src="/assets/images/image-20210226162644582-1fb7fb5c00a573f046294e9824057c5a.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="static-library"></a>Static Library<a class="hash-link" href="#static-library" title="Direct link to heading">#</a></h2><p>静态库</p><p>静态库生成的是xxx.a 文件，以.a 为结尾。</p><p>File-&gt;New-&gt;Project 选择Static Library。打的是真机包还是模拟器包，设置方法和framework一样。</p><p>Demo在此：<a href="https://github.com/DingYusong/dys_ios_framework_staticlib" target="_blank" rel="noopener noreferrer">https://github.com/DingYusong/dys_ios_framework_staticlib</a></p><p><img alt="image-20210226162834555" src="/assets/images/image-20210226162834555-0e0f7161237136f556d081fc5039ed13.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lipo"></a>lipo<a class="hash-link" href="#lipo" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="查看库文件包含的cpu架构-lipo--info-xxxa"></a>查看库文件包含的CPU架构 <code>lipo -info xxx.a</code><a class="hash-link" href="#查看库文件包含的cpu架构-lipo--info-xxxa" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Release-iphoneos lipo -info libdys_ios_staticlib.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Non-fat file: libdys_ios_staticlib.a is architecture: arm64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Debug-iphonesimulator lipo -info libdys_ios_staticlib.a </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Non-fat file: libdys_ios_staticlib.a is architecture: x86_64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Debug-iphonesimulator cd dys_ios_framework.framework </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  dys_ios_framework.framework ls</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Headers           Modules           dys_ios_framework</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Info.plist        _CodeSignature</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  dys_ios_framework.framework lipo -info dys_ios_framework     </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Non-fat file: dys_ios_framework is architecture: x86_64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Debug-iphoneos cd dys_ios_framework.framework </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  dys_ios_framework.framework lipo -info dys_ios_framework</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Non-fat file: dys_ios_framework is architecture: arm64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>微信sdk的架构支持：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  WeChatSDK git:(release/6.12.0) ✗ lipo -info libWeChatSDK.a  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libWeChatSDK.a are: i386 armv7 x86_64 arm64 </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>注意：只要支持<code>armv7</code>就不用再支持<code>armv7s</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="合并多个架构静态库-lipo--create-aa-ba--output-ca"></a>合并多个架构静态库 <code>lipo -create A.a B.a -output C.a</code><a class="hash-link" href="#合并多个架构静态库-lipo--create-aa-ba--output-ca" title="Direct link to heading">#</a></h3><p><code>lipo -create A.a B.a -output C.a</code></p><p>静态库A.a 支持模拟器（x86_64），静态库B.a 支持真机(arm64)，合并出的C.a 支持模拟器加真机(x86_64+arm64)</p><p><img src="http://wiso.liwenhui520.com/20200515158953034074080.png" alt="image-20200515161223782"></p><p><img src="http://wiso.liwenhui520.com/20200515158953038556384.png" alt="image-20200515161309933"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Release-iphoneos lipo -create /Users/goldwallet/Library/Developer/Xcode/DerivedData/dys_ios_staticlib-ednrwyotyvpnuadkvomctxkjidmy/Build/Products/Debug-iphoneos/libdys_ios_staticlib.a /Users/goldwallet/Library/Developer/Xcode/DerivedData/dys_ios_staticlib-ednrwyotyvpnuadkvomctxkjidmy/Build/Products/Debug-iphonesimulator/libdys_ios_staticlib.a -output ~/Desktop/libdys_ios_staticlib.a </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Release-iphoneos lipo -info ~/Desktop/libdys_ios_staticlib.a </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: /Users/goldwallet/Desktop/libdys_ios_staticlib.a are: x86_64 arm64 </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>生成的.a静态库支持x86和arm64。</p><p><img src="http://wiso.liwenhui520.com/20200515158953050274956.png" alt="20200515158953050274956.png"></p><p>使用新生成的<code>libdys_ios_staticlib.a </code>模拟器和真机都可以跑起来。</p><p>man lipo :查询lipo 相关命令</p><p>lipo 在线解释：<a href="https://ss64.com/osx/lipo.html" target="_blank" rel="noopener noreferrer">https://ss64.com/osx/lipo.html</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                        LIPO(1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       lipo - create or operate on universal files</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SYNOPSIS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       lipo input_file command [option...]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DESCRIPTION</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       The  lipo  tool creates or operates on ``universal&#x27;&#x27; (multi-architecture) files. Generally, lipo reads a single input file and writes to a single output file, although some commands and options accept</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       multiple input files.  lipo will only ever write to a single output file, and input files are never modified in place.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       lipo supports a number of commands for creating universal files from single-architecture files, extracting single-architecture files from universal  files,  and  displaying  architecture  information.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       lipo can only perform one such command at a time, although some command flags may appear more than once. Some commands support additional options that can be used with that command. In addition, there</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       are global options that are supported by multiple commands.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       The arch_type arguments may be any of the supported architecture names listed in the man page arch(3).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">COMMANDS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -archs Display only the architecture names present in a single input file. Each architecture name is a single word, making this option suitable for shell scripting. Unknown architectures will be  rep-</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              resented by &quot;unknown&quot; along with the numeric CPU type and CPU subtype values as a single word.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Create one universal output file from one or more input files. When input files specified on the command-line, all of the architectures in each file will be copied into the output file, whereas</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              when input files are included using the global -arch option, only the specified architecture will be copied from that input file.  This command requires the -output option.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -detailed_info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Display a detailed list of the architecture types in the input universal file (all the the information in the universal header, for each architecture in the file).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -extract arch_type [-extract arch_type...]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Take one universal input file and copy the arch_type from that universal file into a universal output file containing only that architecture. This command requires the -output option.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -extract_family arch_type [-extract_family arch_type...]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Take one universal input file and copy all of the arch_types for the family that arch_type is in from that universal file into an output file containing only those architectures.  The file will</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              be thin if only one architecture is found or universal otherwise. This command requires the -output option.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -info  Display a brief description of each input file along with the names of each architecture type in that input file.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -remove arch_type [-remove arch_type ...]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Take one universal input file and remove the arch_type from that universal file, placing the result in the output file. This command requires the -output option.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -replace arch_type file_name [-replace arch_type file_name...]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Take one universal input file; in the output file, replace the arch_type contents of the input file with the contents of the specified file_name.  This command requires the -output option.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -thin arch_type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Take one input file and create a thin output file with the specified arch_type.  This command requires the -output option.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -verify_arch arch_type ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Take  one  input file and verify the specified arch_types are present in the file.  If so then exit with a status of 0 else exit with a status of 1. Because more than one arch_type can be veri-</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              fied at once, all of the input files must appear before the -verify_arch flag on the command-line.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OPTIONS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -arch arch_type input_file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Tells lipo that input_file contains the specified architecture type.  The -arch arch_type specification is unnecessary if input_file is an object file, a universal  file,  or  some  other  file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              whose architecture(s) lipo can figure out.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -hideARM64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              When  creating  a  universal  binary  including both 32-bit and 64-bit ARM files, this option will ask lipo to add the 64-bit files at the end and not include them in the count of architectures</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              present in the file. The files must be executable files (Mach-O filetype MH_EXECUTE). This option has no effect if neither 32-bit ARM nor 64-bit ARM files are present, and no other files may be</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              hidden in this way. This option only works with the -create, -remove, and -replace, commands, and is only intended for tools and workflows testing a workaround on older systems.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -output output_file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Commands that create new files write to the output file specified by the -output flag. This option is required for the -create, -extract, -extract_family, -remove, -replace, and -thin commands.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       -segalign arch_type value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              Set the segment alignment of the specified arch_type when creating a universal file containing that architecture.  value is a hexadecimal number that must be an integral power of  2.   This  is</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              only  needed  when lipo can&#x27;t figure out the alignment of an input file (currently not an object file), or when it guesses at the alignment too conservatively.  The default for files unknown to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              lipo is 0 (2^0, or an alignment of one byte), and the default alignment for archives is 4 (2^2, or 4-byte alignment).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SEE ALSO</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       arch(3)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Apple Computer, Inc.                                                                            August 31, 2018                                                                                         LIPO(1)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="生成支持多个cpu架构支持的静态库"></a>生成支持多个CPU架构支持的静态库<a class="hash-link" href="#生成支持多个cpu架构支持的静态库" title="Direct link to heading">#</a></h3><p>像微信sdk那样 <code>i386 armv7 x86_64 arm64 </code></p><p>Build Active Architecture Only -- NO</p><p>iOS Deployment Target 设置为8.0</p><p>运行iphone6的模拟器得到 <code>i386 x86_64</code> 架构的包</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Release-iphonesimulator lipo -info libdys_ios_staticlib.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libdys_ios_staticlib.a are: i386 x86_64 </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>运行Generic iOS Device 得到 <code>armv7 arm64</code>的包</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  Release-iphoneos lipo -info libdys_ios_staticlib.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libdys_ios_staticlib.a are: armv7 arm64 </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>看大小确实包含了两个架构：</p><p><img src="http://wiso.liwenhui520.com/20200518158979787982723.png" alt="20200518158979787982723.png"></p><p><img src="http://wiso.liwenhui520.com/20200515158953569059218.png" alt="20200515158953569059218.png"></p><p><img src="http://wiso.liwenhui520.com/20200515158953559061725.png" alt="20200515158953559061725.png"></p><p><img src="http://wiso.liwenhui520.com/20200515158953560731095.png" alt="20200515158953560731095.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cmake生成xcode工程"></a>cmake生成xcode工程<a class="hash-link" href="#cmake生成xcode工程" title="Direct link to heading">#</a></h2><p>指定工具链： <code>ios.toolchain.cmake</code> 后生成的架构是 armv7 arm64。默认生成的是 x86_64 不符合要求</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cmake -j`sysctl -n hw.logicalcpu` ${source_dir} -DTHIRD_PART_PATH=${install_dir} -DRZ_CMAKE_MODULE_PATH=${SCRIPT_DIR}/cmake -DRZ_PLATFORM=${platform} -DCMAKE_TOOLCHAIN_FILE=${SCRIPT_DIR}/cmake/ios.toolchain.cmake</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/tmp/rzpaas-sdk-apple/third_part/iOS git:(feature/cmake_refactor) ✗ lipo -info libmn.a                                    (1s)[15:57:46]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Non-fat file: libmn.a is architecture: x86_64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/tmp/rzpaas-sdk-apple/third_part/iOS git:(feature/cmake_refactor) ✗ lipo -info libmn.a                                    (0s)[15:58:01]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libmn.a are: armv7 arm64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="包很大的原因可能是包含了无用的架构"></a>包很大的原因可能是包含了无用的架构<a class="hash-link" href="#包很大的原因可能是包含了无用的架构" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/tmp/rzpaas-sdk-apple/third_part/iOS git:(feature/cmake_refactor) ✗ lipo -info libuv_a.a                                  (0s)[15:57:38]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libuv_a.a are: i386 armv7 armv7s x86_64 arm64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ios 的包目前只需要 armv7 和 arm64。上面的 libuv_a.a   可以大小减少3/5。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="去除无用架构"></a>去除无用架构<a class="hash-link" href="#去除无用架构" title="Direct link to heading">#</a></h2><p><code>lipo -remove armv7 libavcodec.a -o libavcodec.a</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/rzpaas_sdk_demo_264_apple/rzpaas_sdk_demo_264_ios/rzpaas_sdk_demo_ios/Vendor/FFmpeg-iOS/lib git:(main) ✗ lipo -info libavcodec.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libavcodec.a are: armv7 armv7s arm64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/rzpaas_sdk_demo_264_apple/rzpaas_sdk_demo_264_ios/rzpaas_sdk_demo_ios/Vendor/FFmpeg-iOS/lib git:(main) ✗ lipo -remove armv7 libavcodec.a -o libavcodec.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/rzpaas_sdk_demo_264_apple/rzpaas_sdk_demo_264_ios/rzpaas_sdk_demo_ios/Vendor/FFmpeg-iOS/lib git:(main) ✗ lipo -info libavcodec.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libavcodec.a are: armv7s arm64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>file libavcodec.a </code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/tmp/rzpaas-sdk-apple/third_part/iOS git:(feature/cmake_refactor) lipo -info libavcodec.a                                 (0s)[17:39:08]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Architectures in the fat file: libavcodec.a are: i386 armv7 x86_64 arm64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/tmp/rzpaas-sdk-apple/third_part/iOS git:(feature/cmake_refactor) file libavcodec.a                                       (0s)[17:39:24]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a: Mach-O universal binary with 4 architectures: [i386:current ar archive random library] [arm_v7] [x86_64] [arm64]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture i386):   current ar archive random library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture armv7):  current ar archive random library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture x86_64): current ar archive random library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture arm64):  current ar archive random library</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="单独取出来某个架构"></a>单独取出来某个架构<a class="hash-link" href="#单独取出来某个架构" title="Direct link to heading">#</a></h2><p>可以看出这个文件包含了4个平台的代码. 接下来的所有操作都是要针对单一平台进行的, 因此先提取出来armv7平台,</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">lipo -thin armv7 MAMapKit -output MAMapKit.armv7</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="包大小解决"></a>包大小解决<a class="hash-link" href="#包大小解决" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="code-size-performance-guidelines"></a>Code Size Performance Guidelines<a class="hash-link" href="#code-size-performance-guidelines" title="Direct link to heading">#</a></h3><p>代码大小性能准则</p><p><a href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CodeFootprint/Articles/ReducingExports.html" target="_blank" rel="noopener noreferrer">https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CodeFootprint/Articles/ReducingExports.html</a></p><p><a href="https://docs.mapbox.com/help/troubleshooting/ios-framework-size/" target="_blank" rel="noopener noreferrer">https://docs.mapbox.com/help/troubleshooting/ios-framework-size/</a></p><p><a href="https://pspdfkit.com/guides/ios/current/faq/framework-size/" target="_blank" rel="noopener noreferrer">https://pspdfkit.com/guides/ios/current/faq/framework-size/</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="c-runtime-environment-programming-guide"></a>C++ Runtime Environment Programming Guide<a class="hash-link" href="#c-runtime-environment-programming-guide" title="Direct link to heading">#</a></h2><p>C++运行环境编程指南</p><p><a href="https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/CppRuntimeEnv/CPPRuntimeEnv.html#//apple_ref/doc/uid/TP40001666" target="_blank" rel="noopener noreferrer">https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/CppRuntimeEnv/CPPRuntimeEnv.html#//apple_ref/doc/uid/TP40001666</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="符号表"></a>符号表<a class="hash-link" href="#符号表" title="Direct link to heading">#</a></h2><p>symbols</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ios系统-arm架构"></a>ios系统 arm架构<a class="hash-link" href="#ios系统-arm架构" title="Direct link to heading">#</a></h2><p>关于CPU架构：</p><p>模拟器：</p><p>i386：iphone4s-iphone5</p><p>x86_64：iphone SE-iphone7Plus</p><p>真机：</p><p>armv6: iPhone、iPhone 2、iPhone 3G、iPod Touch(第一代)、iPod Touch(第二代)</p><p>armv7: iPhone 3Gs、iPhone 4、iPhone 4s、iPad、iPad 2</p><p>armv7s: iPhone 5、iPhone 5c (静态库只要支持了armv7,就可以在armv7s的架构上运行)</p><p>arm64: iPhone 5s、iPhone 6、iPhone 6 Plus、iPhone 6s、iPhone 6s Plus、iPad Air、iPad Air2、iPad mini2、iPad mini3</p><p>与 iOS 14 和 iPadOS 兼容的设备：<a href="https://support.apple.com/zh-cn/HT211348" target="_blank" rel="noopener noreferrer">https://support.apple.com/zh-cn/HT211348</a></p><p>帮助文档搜索兼容的设备： <a href="https://support.apple.com/kb/index?page=search&amp;q=ios%20%E5%85%BC%E5%AE%B9%E7%9A%84%E8%AE%BE%E5%A4%87&amp;product=&amp;doctype=&amp;currentPage=1&amp;includeArchived=false&amp;locale=zh_CN&amp;src=globalnav_support&amp;type=organic" target="_blank" rel="noopener noreferrer">https://support.apple.com/kb/index?page=search&amp;q=ios%20%E5%85%BC%E5%AE%B9%E7%9A%84%E8%AE%BE%E5%A4%87&amp;product=&amp;doctype=¤tPage=1&amp;includeArchived=false&amp;locale=zh_CN&amp;src=globalnav_support&amp;type=organic</a></p><p>与 iOS 10 兼容的设备：<a href="https://support.apple.com/zh-cn/HT209547" target="_blank" rel="noopener noreferrer">https://support.apple.com/zh-cn/HT209547</a></p><p><img alt="image-20210315103358390" src="/assets/images/image-20210315103358390-dc6dd0758db0f6f00609abdb301dbe7c.png"></p><p>与 iOS 11 兼容的设备：<a href="https://support.apple.com/zh-cn/HT209574" target="_blank" rel="noopener noreferrer">https://support.apple.com/zh-cn/HT209574</a></p><p>分水岭：ios11要求最低arm64架构，iPhone 5c不在其支持之列</p><p><img alt="image-20210315103417419" src="/assets/images/image-20210315103417419-7d35784882d2316c2f30d042f776dfda.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="常见问题"></a>常见问题<a class="hash-link" href="#常见问题" title="Direct link to heading">#</a></h2><p>库头文件警告：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">I ran into the same problem and eventually fixed it by adding my project headers into the umbrella header. When you create a new framework it should start with a single .h file titled by the project (in your case DirectProximityFramework.h).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Inside this file is a comment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">In this header, you should import all the public headers of your framework using statements like #import &lt;DirectProximityFramework/PublicHeader.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">So just add your GeofencingHelper.h file in this file:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#import &lt;DirectProximityFramework/GeofencingHelper.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">This should remove all of your warnings!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><a href="https://stackoverflow.com/questions/25800301/xcode-missing-submodule-warning/26412191" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/25800301/xcode-missing-submodule-warning/26412191</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="参考文档"></a>参考文档<a class="hash-link" href="#参考文档" title="Direct link to heading">#</a></h2><p>lipo命令行使用：<a href="https://www.jianshu.com/p/932d795d6c78" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/932d795d6c78</a></p><p>lipo 命令：<a href="https://www.jianshu.com/p/ab695e867ced" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/ab695e867ced</a></p><p>ios打包静态库，看这篇就够了：<a href="https://www.jianshu.com/p/13bf46df9387" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/13bf46df9387</a></p><p>mac lipo：<a href="https://ss64.com/osx/lipo.html" target="_blank" rel="noopener noreferrer">https://ss64.com/osx/lipo.html</a></p><p>iOS中的静态库和动态库：<a href="https://juejin.cn/post/6844904031937101838" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844904031937101838</a></p><ul><li>iOS 静态库开发 <a href="https://www.jianshu.com/p/8f5b9855efb8" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/8f5b9855efb8</a></li></ul><p>官方文档：</p><ul><li><p><a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Frameworks.html#//apple_ref/doc/uid/10000183-SW1" target="_blank" rel="noopener noreferrer">Framework Programming Guide</a></p></li><li><p><a href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CodeFootprint/Articles/ReducingExports.html" target="_blank" rel="noopener noreferrer">Code Size Performance Guidelines</a></p></li></ul><p><a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Tasks/ExportingInterfaces.html" target="_blank" rel="noopener noreferrer">https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Tasks/ExportingInterfaces.html</a></p><hr><p>原创文章，转载请保留原文链接，未经授权拒绝转载，谢谢。</p><p>联系作者：<a href="mailto:dys90@qq.com" target="_blank" rel="noopener noreferrer">dys90@qq.com</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="dys-typora-open://mine/survival/docs/Apple/库/库.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Apple/macOS开发/macOS开发"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« macOS开发</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Apple/逆向/iOS逆向"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">iOS逆向 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基础概念" class="table-of-contents__link">基础概念</a><ul><li><a href="#库-1" class="table-of-contents__link">库</a></li><li><a href="#查看一个库是动态库还是静态库" class="table-of-contents__link">查看一个库是动态库还是静态库</a></li></ul></li><li><a href="#framework" class="table-of-contents__link">Framework</a><ul><li><a href="#区分打真机包和模拟器包（其实是架构的区别）：" class="table-of-contents__link">区分打真机包和模拟器包（其实是架构的区别）：</a></li><li><a href="#区分打release包和debug包：" class="table-of-contents__link">区分打Release包和Debug包：</a></li><li><a href="#设置是静态库还是动态库" class="table-of-contents__link">设置是静态库还是动态库</a></li></ul></li><li><a href="#static-library" class="table-of-contents__link">Static Library</a></li><li><a href="#lipo" class="table-of-contents__link">lipo</a><ul><li><a href="#查看库文件包含的cpu架构-lipo--info-xxxa" class="table-of-contents__link">查看库文件包含的CPU架构 <code>lipo -info xxx.a</code></a></li><li><a href="#合并多个架构静态库-lipo--create-aa-ba--output-ca" class="table-of-contents__link">合并多个架构静态库 <code>lipo -create A.a B.a -output C.a</code></a></li><li><a href="#生成支持多个cpu架构支持的静态库" class="table-of-contents__link">生成支持多个CPU架构支持的静态库</a></li></ul></li><li><a href="#cmake生成xcode工程" class="table-of-contents__link">cmake生成xcode工程</a></li><li><a href="#包很大的原因可能是包含了无用的架构" class="table-of-contents__link">包很大的原因可能是包含了无用的架构</a></li><li><a href="#去除无用架构" class="table-of-contents__link">去除无用架构</a></li><li><a href="#单独取出来某个架构" class="table-of-contents__link">单独取出来某个架构</a></li><li><a href="#包大小解决" class="table-of-contents__link">包大小解决</a><ul><li><a href="#code-size-performance-guidelines" class="table-of-contents__link">Code Size Performance Guidelines</a></li></ul></li><li><a href="#c-runtime-environment-programming-guide" class="table-of-contents__link">C++ Runtime Environment Programming Guide</a></li><li><a href="#符号表" class="table-of-contents__link">符号表</a></li><li><a href="#ios系统-arm架构" class="table-of-contents__link">ios系统 arm架构</a></li><li><a href="#常见问题" class="table-of-contents__link">常见问题</a></li><li><a href="#参考文档" class="table-of-contents__link">参考文档</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.aaa24a49.js"></script>
<script src="/runtime~main.7eeb3d64.js"></script>
<script src="/main.7a041c89.js"></script>
<script src="/1.62b3ea65.js"></script>
<script src="/257.bb7ed37e.js"></script>
<script src="/258.ed1b30f8.js"></script>
<script src="/935f2afb.55f5968c.js"></script>
<script src="/256.a7530d90.js"></script>
<script src="/a59fc2db.e6ad0599.js"></script>
</body>
</html>