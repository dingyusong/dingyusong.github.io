<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Blog Atom Feed"><title data-react-helmet="true">程序员的自我修养 | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="程序员的自我修养 | My Site"><meta data-react-helmet="true" name="description" content="程序员的自我修养"><meta data-react-helmet="true" property="og:description" content="程序员的自我修养"><meta data-react-helmet="true" property="og:url" content="http://localhost:9999//docs/编程基础/计算机系统基础/读书笔记/程序员的自我修养"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://localhost:9999//docs/编程基础/计算机系统基础/读书笔记/程序员的自我修养"><link rel="stylesheet" href="/styles.8cfbcdec.css">
<link rel="preload" href="/styles.9f2bd08d.js" as="script">
<link rel="preload" href="/runtime~main.b9916a1e.js" as="script">
<link rel="preload" href="/main.aad198f0.js" as="script">
<link rel="preload" href="/1.c6142e7c.js" as="script">
<link rel="preload" href="/259.bd219e04.js" as="script">
<link rel="preload" href="/260.8c75c7b8.js" as="script">
<link rel="preload" href="/935f2afb.b83995d3.js" as="script">
<link rel="preload" href="/258.77a3145c.js" as="script">
<link rel="preload" href="/8f46bad1.f6193a07.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">基础</a><a class="navbar__item navbar__link" href="/docs/编程语言/编程语言">语言</a><a class="navbar__item navbar__link" href="/docs/工具/常用工具">工具</a><a class="navbar__item navbar__link" href="/docs/应用开发/应用开发">应用开发</a><a class="navbar__item navbar__link" href="/docs/Apple/iOS开发/iOS开发">Apple</a><a class="navbar__item navbar__link" href="/docs/音视频/音视频">音视频</a><a class="navbar__item navbar__link" href="/docs/项目/项目">项目</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">基础</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/编程语言/编程语言">语言</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/工具/常用工具">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/应用开发/应用开发">应用开发</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/iOS开发/iOS开发">Apple</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/音视频/音视频">音视频</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/项目/项目">项目</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">程序员的自我修养</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="程序员的自我修养"></a>程序员的自我修养<a class="hash-link" href="#程序员的自我修养" title="Direct link to heading">#</a></h1><p>[toc]</p><p>CPU体系结构、汇编、C语言(包括C++)和操作系统，永远都是编程 大师们的护身法宝，就如同少林寺的《易筋经》，是最为上乘的武功; 学会了《易筋经》，你将无所不能，任你创造武功;学会了编程“易筋 经”，大师们可以任意开发操作系统、编译器，甚至是开发一种新的程 序设计语言!</p><p>本书将详细描述现在流行的Windows和Linux操作系统下各自的可执行 文件、目标文件格式;普通C/C++程序代码如何被编译成目标文件及程 序在目标文件中如何存储;目标文件如何被链接器链接到一起，并且形 成可执行文件;目标文件在链接时符号处理、重定位和地址分配如何进 行;可执行文件如何被装载并且执行;可执行文件与进程的虚拟空间之 间如何映射;什么是动态链接，为什么要进行动态链接;Windows和 Linux如何进行动态链接及动态链接时的相关问题;什么是堆，什么是 栈;函数调用惯例;运行库，Glibc和MSVC CRT的实现分析;系统调 用与API;最后我们自己还实现了一个Mini CRT。</p><p>为什么程序是从main开始执行? “malloc分配的空间是连续的吗?” “PE/ELF文件里面存的是什么?” “我想写一个不需要操作系统可以直接在硬件上跑的程序该怎么做?” “目标文件是什么?链接又是什么?” “为什么这段程序链接时报错?”</p><p>“句柄到底是什么东西?”</p><p>我们把这些问题归结起来，发现主要是三个很大的而且连贯 的主题，那就是“链接、装载与库”。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="第1章-温故而知新"></a>第1章 温故而知新<a class="hash-link" href="#第1章-温故而知新" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="11-从hello-world说起"></a>1.1 从Hello World说起<a class="hash-link" href="#11-从hello-world说起" title="Direct link to heading">#</a></h3><p>hello world 很简单，但是后面牵扯的整个软件系统的编译和链接则非常庞大</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="12-万变不离其宗"></a>1.2 万变不离其宗<a class="hash-link" href="#12-万变不离其宗" title="Direct link to heading">#</a></h3><p>平台的软硬件差别很多，但是本质上它们的基本概念和工作原理都是一样的。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="13-站得高看得远"></a>1.3 站得高看得远<a class="hash-link" href="#13-站得高看得远" title="Direct link to heading">#</a></h3><ol><li><strong>从全局的角度去看软件</strong></li></ol><ul><li>系统软件<ul><li>平台性的</li><li>程序开发的</li></ul></li><li>普通应用程序</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">传统意义上一般将用于管理计算机本身的软件称为系统软件，以区别普通的应用程序。系统软件可以分成两 块，一块是平台性的，比如操作系统内核、驱动程序、运行库和数以千计的系统工具;另外一块是用于程序开发的，比如编译器、汇编器、链接器等开发工具和开发库。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="2"><li><strong>抽象和分层的思想</strong></li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">“Any problem in computer science can be solved by another layer of indirection.”</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">“计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决”</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="image-20210303222254146" src="/assets/images/image-20210303222254146-42bf68d25140949a14ffc26f229f8015.png"></p><ol start="3"><li><strong>每个层次之间都须要相互通信，既然须要通信就必须有一个通信的协 议，我们一般将其称为接口(Interface)</strong></li></ol><p>每个层次之间都须要相互通信，既然须要通信就必须有一个通信的协 议，我们一般将其称为接口(Interface)，接口的下面那层是接口的提 供者，由它定义接口;接口的上面那层是接口的使用者，它使用该接口 来实现所需要的功能。在层次体系中，接口是被精心设计过的，尽量保 持稳定不变，那么理论上层次之间只要遵循这个接口，任何一个层都可 以被修改或被替换。</p><blockquote><p>分层，面向接口编程。</p></blockquote><p>我们的软件体系中，位于最上层的是应用程序，比如我们平时用到的网 络浏览器、Email客户端、多媒体播放器、图片浏览器等。从整个层次 结构上来看，开发工具与应用程序是属于同一个层次的，因为它们都使 用一个接口，那就是操作系统应用程序编程接口(Application Programming Interface)。应用程序接口的提供者是运行库，什么样的 运行库提供什么样的API，比如Linux下的Glibc库提供POSIX的API; Windows的运行库提供Windows API，最常见的32位Windows提供的API 又被称为Win32。</p><p>运行库使用操作系统提供的系统调用接口(System call Interface)，系 统调用接口在实现中往往以软件中断(Software Interrupt)的方式提 供，比如Linux使用0x80号中断作为系统调用接口，Windows使用0x2E 号中断作为系统调用接口(从Windows XP Sp2开始，Windows开始采用 一种新的系统调用方式)。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="14-操作系统做什么"></a>1.4 操作系统做什么<a class="hash-link" href="#14-操作系统做什么" title="Direct link to heading">#</a></h3><p>两大功能：</p><ol><li>提供抽象的接口</li><li>管理硬件资源</li></ol><ul><li>不让CPU打盹</li></ul><p>多道程序 -&gt; 分时系统 -&gt; 多任务系统</p><ul><li>设备驱动</li></ul><p>从硬件细节中解放出来，可以更多地关注应用程序本身的开发。这些繁 琐的硬件细节全都交给了操作系统，具体地讲是操作系统中的硬件驱动 (Device Driver)程序来完成。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="15-内存不够怎么办"></a>1.5 内存不够怎么办<a class="hash-link" href="#15-内存不够怎么办" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="16-众人拾柴火焰高"></a>1.6 众人拾柴火焰高<a class="hash-link" href="#16-众人拾柴火焰高" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="17-本章小结"></a>1.7 本章小结<a class="hash-link" href="#17-本章小结" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="第2章-编译和链接"></a>第2章 编译和链接<a class="hash-link" href="#第2章-编译和链接" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="21-被隐藏了的过程"></a>2.1 被隐藏了的过程<a class="hash-link" href="#21-被隐藏了的过程" title="Direct link to heading">#</a></h3><p>于C语言的代码来说，这个预编译 和编译的程序是cc1，对于C++来说，有对应的程序叫做cc1plus; Objective-C是cc1obj;fortran是f771;Java是jc1。所以实际上gcc这个命 令只是这些后台程序的包装，它会根据不同的参数要求去调用预编译编 译程序cc1、汇编器as、链接器ld。</p><p>符号(Symbol)这个概念随着汇编语言的普及迅 速被使用，它用来表示一个地址，这个地址可能是一段子程序(后来发 展成函数)的起始地址，也可以是一个变量的起始地址。</p><p>在一个程序被分割成多个模块以后，这些模块之间最后如何组合形成一 个单一的程序是须解决的问题。模块之间如何组合的问题可以归结为模 块之间如何通信的问题，最常见的属于静态语言的C/C++模块之间通信 有两种方式，一种是模块间的函数调用，另外一种是模块间的变量访 问。函数访问须知道目标函数的地址，变量访问也须知道目标变量的地 址，所以这两种方式都可以归结为一种方式，那就是模块间符号的引 用。</p><p>这种基于符号的模块化的一个直接结果是链接过程在整个程序开发中变 得十分重要和突出。</p><p>链接器所要做的工作其实跟 前面所描述的“程序员人工调整地址”本质上没什么两样，只不过现代的 高级语言的诸多特性和功能，使得编译器、链接器更为复杂，功能更为 强大，但从原理上来讲，它的工作无非就是把一些指令对其他符号地址 的引用加以修正。链接过程主要包括了地址和空间分配(Address and Storage Allocation)、符号决议(Symbol Resolution)和重定位 (Relocation)等这些步骤。</p><p>符号决议有时候也被叫做符号绑定(Symbol Binding)、名称绑定 (Name Binding)、名称决议(Name Resolution)，甚至还有叫做地址 绑定(Address Binding)、指令绑定(Instruction Binding)的，大体上 它们的意思都一样，但从细节角度来区分，它们之间还是存在一定区别 的，比如“决议”更倾向于静态链接，而“绑定”更倾向于动态链接，即它 们所使用的范围不一样。在静态链接，我们将统一称为符号决议。</p><p><img alt="image-20210303231204384" src="/assets/images/image-20210303231204384-ea05da02bf38dfa4549be6de5e37397d.png"></p><p>而最常见的库就是运行时库(Runtime Library)，它是支持程序运行的基本函数的集合。库其实是一组目标文 件的包，就是一些最常用的代码编译成目标文件后打包存放。</p><p>现代的编译和链接过程也并非想象中的那么复杂，它还是一个比较容易 理解的概念。比如我们在程序模块main.c中使用另外一个模块func.c中的 函数foo()。我们在main.c模块中每一处调用foo的时候都必须确切知道 foo这个函数的地址，但是由于每个模块都是单独编译的，在编译器编 译main.c的时候它并不知道foo函数的地址，所以它暂时把这些调用foo 的指令的目标地址搁置，等待最后链接的时候由链接器去将这些指令的 目标地址修正。</p><p><strong>预编译</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gcc –E hello.c –o hello.i</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>编译</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gcc –S hello.i –o hello.s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>汇编</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">as hello.s –o hello.o</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>一步到：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gcc -c hello.c</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>链接</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ld -static /usr/lib/crt1.o /usr/lib/crti.o /usr/lib/gcc/i486-linux-</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> gnu/4.1.3/crtbeginT.o -L/usr/lib/gcc/i486-linux-gnu/4.1.3 -L/usr/lib -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> L/lib hello.o --start-group -lgcc -lgcc_eh -lc --end-group /usr/lib/gcc/i486-</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> linux-gnu/4.1.3/crtend.o /usr/lib/crtn.o</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ file hello.c                                            </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hello.c: c program text, ASCII text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ gcc -E hello.c -o hello.i                                             </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ file hello.i                                          </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hello.i: c program text, ASCII text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ gcc -S hello.i -o hello.s                                             </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ file hello.s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hello.s: assembler source text, ASCII text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ as hello.s -o hello.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ file hello.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hello.o: Mach-O 64-bit object x86_64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ file a.out</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a.out: Mach-O 64-bit executable x86_64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/hello-world git:(master) ✗ ll</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total 176</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rwxr-xr-x  1 dingyusong  staff    48K Mar  4 21:40 a.out</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  1 dingyusong  staff   103B Mar  4 21:40 hello.c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  1 dingyusong  staff    23K Mar  4 21:43 hello.i</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  1 dingyusong  staff   784B Mar  4 21:47 hello.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  1 dingyusong  staff   816B Mar  4 21:46 hello.s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="22-编译器做了什么"></a>2.2 编译器做了什么<a class="hash-link" href="#22-编译器做了什么" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="23-链接器年龄比编译器长"></a>2.3 链接器年龄比编译器长<a class="hash-link" href="#23-链接器年龄比编译器长" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="24-模块拼装-静态链接"></a>2.4 模块拼装-静态链接<a class="hash-link" href="#24-模块拼装-静态链接" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="25-本章小结"></a>2.5 本章小结<a class="hash-link" href="#25-本章小结" title="Direct link to heading">#</a></h3><p>C语言有强符号和弱符号。</p><p>在一个程序中，无论是变量名，还是函数名，在编译器的眼里，就是一个符号而已。符号可以分为强符号和弱符号。</p><ul><li>强符号：函数名、初始化的全局变量名；</li><li>弱符号：未初始化的全局变量名。</li></ul><p>在一个工程项目中，对于相同的全局变量名、函数名，我们一般可以归结为下面三种场景。</p><ul><li>强符号+强符号</li><li>强符号+弱符号</li><li>弱符号+弱符号</li></ul><p>强符号和弱符号在解决程序编译链接过程中，出现的多个同名变量、函数的冲突问题非常有用。一般我们遵循下面三个规则。</p><ul><li>一山不容二虎</li><li>强弱可以共处</li><li>体积大者胜出</li></ul><p>嵌入式C语言自我修养 09：链接过程中的强符号和弱符号 <a href="https://zhuanlan.zhihu.com/p/55768978" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/55768978</a></p><p>链接只对global的符号进行处理。static 不处理。 local不处理。</p><p><strong>声明 和 定义</strong>要搞清楚。</p><p>虚拟地址空间。屏蔽差异。</p><p>两个符号。</p><p>​	<img alt="image-20210309204239765" src="/assets/images/image-20210309204239765-6c07752ffee8dd317c41c0f535ea2df9.png"></p><p>外部符号 undefined。 符号引用。</p><p><img alt="image-20210309204358273" src="/assets/images/image-20210309204358273-0ef222c77cfdf4bdccb3f08b01b829ad.png"></p><p>链接常见错误：</p><ul><li>重定义符号。出现了两个以上的相同符号。</li><li>找不到符号。对于引用，找不到定义的地方。</li></ul><p><img alt="image-20210309204512304" src="/assets/images/image-20210309204512304-abfa3b28cf05e767e0adf8167afdecdb.png"></p><p>编译的时候，不分配内存地址。sum 和 gdata10.</p><p>数据都是0，函数都是偏移量，下一条指令的4字节偏移量。</p><p><img alt="image-20210309204759380" src="/assets/images/image-20210309204759380-bb281228dba421f2d331c93cc1a75192.png"></p><p><img alt="image-20210309205215533" src="/assets/images/image-20210309205215533-3c6311404b8ef02c1e0203bd73400f40.png"></p><p>目标文件是2*2  4字节对齐</p><p>可执行文件是页面对齐。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="第3章-目标文件里有什么"></a>第3章 目标文件里有什么<a class="hash-link" href="#第3章-目标文件里有什么" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="31-目标文件的格式"></a>3.1 目标文件的格式<a class="hash-link" href="#31-目标文件的格式" title="Direct link to heading">#</a></h3><p>不光是可执行文件(Windows的.exe和Linux下的ELF可执行文件)按照 可执行文件格式存储。动态链接库(DLL，Dynamic Linking Library) (Windows的.dll和Linux的.so)及静态链接库(Static Linking Library) (Windows的.lib和Linux的.a)文件都按照可执行文件格式存储。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas-sdk-apple/RZPaas/Classes/rz-paas-sdk/lib/iOS git:(develop) file libavcodec.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a: Mach-O universal binary with 4 architectures: [i386:current ar archive random library] [arm_v7] [x86_64] [arm64]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture i386): current ar archive random library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture armv7):  current ar archive random library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture x86_64): current ar archive random library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">libavcodec.a (for architecture arm64):  current ar archive random library</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>file命令</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong file /bin/bash                                                                                                              </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/bash: Mach-O 64-bit executable x86_64</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>COFF是由Unix System V Release 3首先提出并且使用的格式规范，后来 微软公司基于COFF格式，制定了PE格式标准，并将其用于当时的 Windows NT系统。System V Release 4在COFF的基础上引入了ELF格 式，目前流行的Linux系统也以ELF作为基本可执行文件格式。这也就是 为什么目前PE和ELF如此相似的主要原因，因为它们都是源于同一种可 执行文件格式COFF。</p><p>Unix最早的可执行文件格式为a.out格式，它的设计非常地简单，以至于 后来共享库这个概念出现的时候，a.out格式就变得捉襟见肘了。于是人 们设计了COFF格式来解决这些问题，这个设计非常通用，以至于COFF 的继承者到目前还在被广泛地使用。</p><p>COFF的主要贡献是在目标文件里面引入了“段”的机制，不同的目标文 件可以拥有不同数量及不同类型的“段”。另外，它还定义了调试数据格式。</p><p>程序源代码编译后的机器指令经常被放在代码段(Code Section)里， 代码段常见的名字有“.code”或“.text”;全局变量和局部静态变量数据经 常放在数据段(Data Section)，数据段的一般名字都叫“.data”。</p><p><img alt="image-20210304222439617" src="/assets/images/image-20210304222439617-3612962094f62be60aefb588ec55a8b7.png"></p><p>BSS历史</p><p>BSS(Block Started by Symbol)这个词最初是UA-SAP汇编器(United Aircraft Symbolic Assembly Program)中的一个伪指令，用于为符号预留 一块内存空间。该汇编器由美国联合航空公司于20世纪50年代中期为 IBM 704大型机所开发。</p><p>后来BSS这个词被作为关键字引入到了IBM 709和7090/94机型上的标准 汇编器FAP(Fortran Assembly Program)，用于定义符号并且为该符号 预留给定数量的未初始化空间。</p><p>由于数据区域对于进程来说是可读写的，而指令区域对于进程来说是只</p><p>读的，所以这两个虚存区域的权限可以被分别设置成可读写和只读。这 样可以防止程序的指令被有意或无意地改写。</p><p>其实也是最重要的原因，就是当系统中运行着多个该程 序的副本时，它们的指令都是一样的，所以内存中只须要保存一份该程 序的指令部分。不要小看这个共享指令的概念，它在现代的操作系统里面占据 了极为重要的地位，特别是在有动态链接的系统中，可以节省大量的内 存。</p><p>objdump 和 readelf</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/SimpleSection git:(master) ✗ gcc -c SimpleSection.c                                                                                                       </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/SimpleSection git:(master) ✗ file SimpleSection.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/SimpleSection git:(master) ✗ which objdump                                             </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/usr/bin/objdump</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/SimpleSection git:(master) ✗ objdump -h SimpleSection.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SimpleSection.o:        file format Mach-O 64-bit x86-64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Sections:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Idx Name             Size     VMA              Type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  0 __text           00000068 0000000000000000 TEXT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  1 __data           00000008 0000000000000068 DATA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  2 __cstring        00000004 0000000000000070 DATA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  3 __bss            00000004 0000000000000120 BSS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  4 __compact_unwind 00000040 0000000000000078 DATA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  5 __eh_frame       00000068 00000000000000b8 DATA</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>GCC和binutils可被移植到各种平台上，所以它们支持多种目标文件格 式。比如Windows下的GCC和binutils支持PE文件格式、Linux版本支持 ELF格式。Linux还有一个很不错的工具叫readelf，它是专门针对ELF文 件格式的解析器，很多时候它对ELF文件的分析可以跟objdump相互对 照，所以我们下面会经常用到这个工具。</p><p>但是mac os X下没有这两个命令，可以用brew来安装，brew update &amp;&amp; brew install binutils，然后用greadelf和gobjdump(readelf和objdump)。</p><p>iOS进阶02: Mach-O: <a href="https://www.jianshu.com/p/b1d02f330a2e" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/b1d02f330a2e</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/mine/gitee/clab/SimpleSection git:(master) size -x -l -m a.out </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Segment __PAGEZERO: 0x100000000 (vmaddr 0x0 fileoff 0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Segment __TEXT: 0x4000 (vmaddr 0x100000000 fileoff 0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __text: 0x68 (addr 0x100003f20 offset 16160)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __stubs: 0x6 (addr 0x100003f88 offset 16264)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __stub_helper: 0x1a (addr 0x100003f90 offset 16272)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __cstring: 0x4 (addr 0x100003faa offset 16298)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __unwind_info: 0x48 (addr 0x100003fb0 offset 16304)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        total 0xd4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Segment __DATA_CONST: 0x4000 (vmaddr 0x100004000 fileoff 16384)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __got: 0x8 (addr 0x100004000 offset 16384)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        total 0x8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Segment __DATA: 0x4000 (vmaddr 0x100008000 fileoff 32768)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __la_symbol_ptr: 0x8 (addr 0x100008000 offset 32768)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __data: 0x10 (addr 0x100008008 offset 32776)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __bss: 0x4 (addr 0x100008018 offset 0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Section __common: 0x4 (addr 0x10000801c offset 0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        total 0x20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Segment __LINKEDIT: 0x4000 (vmaddr 0x10000c000 fileoff 49152)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total 0x100010000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>Macho文件浏览器---MachOView: <a href="https://www.jianshu.com/p/175925ab3355" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/175925ab3355</a></li></ul><p>MachOView下载地址：<a href="https://link.jianshu.com?t=http://sourceforge.net/projects/machoview/" target="_blank" rel="noopener noreferrer">http://sourceforge.net/projects/machoview/</a></p><p>MachOView源码地址：<a href="https://link.jianshu.com?t=https://github.com/gdbinit/MachOView" target="_blank" rel="noopener noreferrer">https://github.com/gdbinit/MachOView</a></p><p><strong>观察xcode的build构建过程</strong></p><ul><li>整个工程的build过程</li></ul><p><img alt="image-20210305100025358" src="/assets/images/image-20210305100025358-e073c5e85728b01441da250d0b41898e.png"></p><p> 疑问？上述构建过程中为什么 Masonry-iOS 等 被编译了2次？</p><ul><li>某个target的构建过程</li></ul><p><img alt="image-20210305095814720" src="/assets/images/image-20210305095814720-4f2e7d84563c4aabd8fe49eef3455040.png"></p><p>MasterObjectLink</p><p><img alt="image-20210305095520560" src="/assets/images/image-20210305095520560-d746c699c359ce85a239cbf4439db40b.png"></p><p>ld</p><p><img alt="image-20210305095648695" src="/assets/images/image-20210305095648695-faf554de95dbd4139a56f1b142aa484a.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="32-目标文件是什么样的"></a>3.2 目标文件是什么样的<a class="hash-link" href="#32-目标文件是什么样的" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="33-挖掘simplesectiono"></a>3.3 挖掘SimpleSection.o<a class="hash-link" href="#33-挖掘simplesectiono" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="34-elf文件结构描述"></a>3.4 ELF文件结构描述<a class="hash-link" href="#34-elf文件结构描述" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="35-链接的接口-符号"></a>3.5 链接的接口-符号<a class="hash-link" href="#35-链接的接口-符号" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="36-调试信息"></a>3.6 调试信息<a class="hash-link" href="#36-调试信息" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="37-本章小结"></a>3.7 本章小结<a class="hash-link" href="#37-本章小结" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="第4章-静态链接"></a>第4章 静态链接<a class="hash-link" href="#第4章-静态链接" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="41-空间与地址分配"></a>4.1 空间与地址分配<a class="hash-link" href="#41-空间与地址分配" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="42-符号解析与重定位"></a>4.2 符号解析与重定位<a class="hash-link" href="#42-符号解析与重定位" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="common块"></a>COMMON块<a class="hash-link" href="#common块" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="windows-pecoff"></a>Windows PE/COFF<a class="hash-link" href="#windows-pecoff" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="可执行文件的装载与进程"></a>可执行文件的装载与进程<a class="hash-link" href="#可执行文件的装载与进程" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="动态链接"></a>动态链接<a class="hash-link" href="#动态链接" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="linux共享库的组织"></a>Linux共享库的组织<a class="hash-link" href="#linux共享库的组织" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="windows下的动态链接"></a>Windows下的动态链接<a class="hash-link" href="#windows下的动态链接" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="内存"></a>内存<a class="hash-link" href="#内存" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="运行库"></a>运行库<a class="hash-link" href="#运行库" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="系统调用与api"></a>系统调用与API<a class="hash-link" href="#系统调用与api" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="运行库的实现"></a>运行库的实现<a class="hash-link" href="#运行库的实现" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="附录a"></a>附录A<a class="hash-link" href="#附录a" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="字节序（byte-order）"></a>字节序（Byte Order）<a class="hash-link" href="#字节序（byte-order）" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="elf常见段"></a>ELF常见段<a class="hash-link" href="#elf常见段" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="常用开发工具命令行参考"></a>常用开发工具命令行参考<a class="hash-link" href="#常用开发工具命令行参考" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="符号表"></a>符号表<a class="hash-link" href="#符号表" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  RZPaas_iOS.framework git:(feature/audioSource) ✗ nm RZPaas_iOS | grep Engine   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">00f847cc D _OBJC_CLASS_$_RZRtcEngineConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">00f849d4 D _OBJC_CLASS_$_RZRtcEngineKit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">00f847e0 D _OBJC_METACLASS_$_RZRtcEngineConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">00f849e8 D _OBJC_METACLASS_$_RZRtcEngineKit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">000f46fe T __ZN2rz10IRtcEngine10getVersionEv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">000f46fa T __ZN2rz10IRtcEngine19getErrorDescriptionEi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">000f43e8 T __ZN2rz10IRtcEngine7releaseEb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">000f2ed8 T _createRZRtcEngine</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0000000001239a88 D _OBJC_CLASS_$_RZRtcEngineConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0000000001239e98 D _OBJC_CLASS_$_RZRtcEngineKit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0000000001239ab0 D _OBJC_METACLASS_$_RZRtcEngineConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0000000001239ec0 D _OBJC_METACLASS_$_RZRtcEngineKit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000107638 T __ZN2rz10IRtcEngine10getVersionEv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000107634 T __ZN2rz10IRtcEngine19getErrorDescriptionEi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000107368 T __ZN2rz10IRtcEngine7releaseEb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">00000000001062d8 T _createRZRtcEngine</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="符号冲突"></a>符号冲突<a class="hash-link" href="#符号冲突" title="Direct link to heading">#</a></h3><p>initializeAUGraph 这个function 在 AudioGraphRecorder.m 和 AudioGraphIOPassThrough.m 文件中都定义了，因为没有没有指定static ，函数默认的连接性是外部的，即文件间共享。所以会报 duplicate symbol 错误。指定 static，表明链接性为内部，就如同添加了代码块的大括号，或者类，限定了作用域，就不会重复了。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">duplicate symbol &#x27;_OBJC_CLASS_$_AudioUnitRecorder&#x27; in:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioUnitRecorder-2a1bb4a5407c0b1eaf7c97a15c03ea6f7bd7410025629345221f1b76b5c0aed6.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioUnitRecorder-2a1bb4a5407c0b1eaf7c97a15c03ea6f517f55659c295c4945e0a2071fe87f7e.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">duplicate symbol &#x27;_OBJC_METACLASS_$_AudioUnitRecorder&#x27; in:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioUnitRecorder-2a1bb4a5407c0b1eaf7c97a15c03ea6f7bd7410025629345221f1b76b5c0aed6.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioUnitRecorder-2a1bb4a5407c0b1eaf7c97a15c03ea6f517f55659c295c4945e0a2071fe87f7e.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;_startAUGraph&#x27; in:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioGraphIOPassThrough.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioGraphRecorder.o    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">duplicate symbol &#x27;_initializeAUGraph&#x27; in:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioGraphIOPassThrough.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioGraphRecorder.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">duplicate symbol &#x27;_printASBD&#x27; in:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioGraphIOPassThrough.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /Users/dingyusong/Library/Developer/Xcode/DerivedData/audio_demo-gxfwiugwybecmodviwmqxwjedpdp/Build/Intermediates.noindex/audio_unit_demo.build/Debug-iphoneos/audio_unit_ios.build/Objects-normal/arm64/AudioGraphRecorder.o</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ld: 5 duplicate symbols for architecture arm64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="image-20210204225231852" src="/assets/images/image-20210204225231852-5cecc58b4cedc175516044f89ca69ebd.png"></p><p>类，元类，方法 冲突</p><p><code>duplicate symbol &#x27;_OBJC_CLASS_$_AudioUnitRecorder&#x27; in:</code></p><p><code>duplicate symbol &#x27;_OBJC_METACLASS_$_AudioUnitRecorder&#x27; in:</code></p><p><code>duplicate symbol &#x27;_printASBD&#x27; in:</code></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="dys-typora-open://mine/survival/docs/编程基础/计算机系统基础/读书笔记/程序员的自我修养.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#第1章-温故而知新" class="table-of-contents__link">第1章 温故而知新</a><ul><li><a href="#11-从hello-world说起" class="table-of-contents__link">1.1 从Hello World说起</a></li><li><a href="#12-万变不离其宗" class="table-of-contents__link">1.2 万变不离其宗</a></li><li><a href="#13-站得高看得远" class="table-of-contents__link">1.3 站得高看得远</a></li><li><a href="#14-操作系统做什么" class="table-of-contents__link">1.4 操作系统做什么</a></li><li><a href="#15-内存不够怎么办" class="table-of-contents__link">1.5 内存不够怎么办</a></li><li><a href="#16-众人拾柴火焰高" class="table-of-contents__link">1.6 众人拾柴火焰高</a></li><li><a href="#17-本章小结" class="table-of-contents__link">1.7 本章小结</a></li></ul></li><li><a href="#第2章-编译和链接" class="table-of-contents__link">第2章 编译和链接</a><ul><li><a href="#21-被隐藏了的过程" class="table-of-contents__link">2.1 被隐藏了的过程</a></li><li><a href="#22-编译器做了什么" class="table-of-contents__link">2.2 编译器做了什么</a></li><li><a href="#23-链接器年龄比编译器长" class="table-of-contents__link">2.3 链接器年龄比编译器长</a></li><li><a href="#24-模块拼装-静态链接" class="table-of-contents__link">2.4 模块拼装-静态链接</a></li><li><a href="#25-本章小结" class="table-of-contents__link">2.5 本章小结</a></li></ul></li><li><a href="#第3章-目标文件里有什么" class="table-of-contents__link">第3章 目标文件里有什么</a><ul><li><a href="#31-目标文件的格式" class="table-of-contents__link">3.1 目标文件的格式</a></li><li><a href="#32-目标文件是什么样的" class="table-of-contents__link">3.2 目标文件是什么样的</a></li><li><a href="#33-挖掘simplesectiono" class="table-of-contents__link">3.3 挖掘SimpleSection.o</a></li><li><a href="#34-elf文件结构描述" class="table-of-contents__link">3.4 ELF文件结构描述</a></li><li><a href="#35-链接的接口-符号" class="table-of-contents__link">3.5 链接的接口-符号</a></li><li><a href="#36-调试信息" class="table-of-contents__link">3.6 调试信息</a></li><li><a href="#37-本章小结" class="table-of-contents__link">3.7 本章小结</a></li></ul></li><li><a href="#第4章-静态链接" class="table-of-contents__link">第4章 静态链接</a><ul><li><a href="#41-空间与地址分配" class="table-of-contents__link">4.1 空间与地址分配</a></li><li><a href="#42-符号解析与重定位" class="table-of-contents__link">4.2 符号解析与重定位</a></li><li><a href="#common块" class="table-of-contents__link">COMMON块</a></li></ul></li><li><a href="#windows-pecoff" class="table-of-contents__link">Windows PE/COFF</a></li><li><a href="#可执行文件的装载与进程" class="table-of-contents__link">可执行文件的装载与进程</a></li><li><a href="#动态链接" class="table-of-contents__link">动态链接</a></li><li><a href="#linux共享库的组织" class="table-of-contents__link">Linux共享库的组织</a></li><li><a href="#windows下的动态链接" class="table-of-contents__link">Windows下的动态链接</a></li><li><a href="#内存" class="table-of-contents__link">内存</a></li><li><a href="#运行库" class="table-of-contents__link">运行库</a></li><li><a href="#系统调用与api" class="table-of-contents__link">系统调用与API</a></li><li><a href="#运行库的实现" class="table-of-contents__link">运行库的实现</a></li><li><a href="#附录a" class="table-of-contents__link">附录A</a><ul><li><a href="#字节序（byte-order）" class="table-of-contents__link">字节序（Byte Order）</a></li><li><a href="#elf常见段" class="table-of-contents__link">ELF常见段</a></li><li><a href="#常用开发工具命令行参考" class="table-of-contents__link">常用开发工具命令行参考</a></li></ul></li><li><a href="#符号表" class="table-of-contents__link">符号表</a><ul><li><a href="#符号冲突" class="table-of-contents__link">符号冲突</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.9f2bd08d.js"></script>
<script src="/runtime~main.b9916a1e.js"></script>
<script src="/main.aad198f0.js"></script>
<script src="/1.c6142e7c.js"></script>
<script src="/259.bd219e04.js"></script>
<script src="/260.8c75c7b8.js"></script>
<script src="/935f2afb.b83995d3.js"></script>
<script src="/258.77a3145c.js"></script>
<script src="/8f46bad1.f6193a07.js"></script>
</body>
</html>