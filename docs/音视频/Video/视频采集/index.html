<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Blog Atom Feed"><title data-react-helmet="true">è§†é¢‘é‡‡é›† | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="è§†é¢‘é‡‡é›† | My Site"><meta data-react-helmet="true" name="description" content="iOS/macOS è§†é¢‘é‡‡é›†"><meta data-react-helmet="true" property="og:description" content="iOS/macOS è§†é¢‘é‡‡é›†"><meta data-react-helmet="true" property="og:url" content="http://localhost:9999//docs/éŸ³è§†é¢‘/Video/è§†é¢‘é‡‡é›†"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://localhost:9999//docs/éŸ³è§†é¢‘/Video/è§†é¢‘é‡‡é›†"><link rel="stylesheet" href="/styles.8cfbcdec.css">
<link rel="preload" href="/styles.aaa24a49.js" as="script">
<link rel="preload" href="/runtime~main.7eeb3d64.js" as="script">
<link rel="preload" href="/main.7a041c89.js" as="script">
<link rel="preload" href="/1.62b3ea65.js" as="script">
<link rel="preload" href="/257.bb7ed37e.js" as="script">
<link rel="preload" href="/258.ed1b30f8.js" as="script">
<link rel="preload" href="/935f2afb.55f5968c.js" as="script">
<link rel="preload" href="/256.a7530d90.js" as="script">
<link rel="preload" href="/b961bef2.a1642402.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a><a class="navbar__item navbar__link" href="/docs/">ç¼–ç¨‹åŸºç¡€</a><a class="navbar__item navbar__link" href="/docs/ç¼–ç¨‹è¯­è¨€/ç¼–ç¨‹è¯­è¨€">ç¼–ç¨‹è¯­è¨€</a><a class="navbar__item navbar__link" href="/docs/å·¥å…·/å¸¸ç”¨å·¥å…·">å·¥å…·</a><a class="navbar__item navbar__link" href="/docs/åº”ç”¨å¼€å‘/åº”ç”¨å¼€å‘">åº”ç”¨å¼€å‘</a><a class="navbar__item navbar__link" href="/docs/Apple/iOSå¼€å‘/iOSå¼€å‘">Apple</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/éŸ³è§†é¢‘/éŸ³è§†é¢‘">éŸ³è§†é¢‘</a><a class="navbar__item navbar__link" href="/docs/é¡¹ç›®/é¡¹ç›®">é¡¹ç›®</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">ç¼–ç¨‹åŸºç¡€</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ç¼–ç¨‹è¯­è¨€/ç¼–ç¨‹è¯­è¨€">ç¼–ç¨‹è¯­è¨€</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/å·¥å…·/å¸¸ç”¨å·¥å…·">å·¥å…·</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/åº”ç”¨å¼€å‘/åº”ç”¨å¼€å‘">åº”ç”¨å¼€å‘</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/iOSå¼€å‘/iOSå¼€å‘">Apple</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/éŸ³è§†é¢‘/éŸ³è§†é¢‘">éŸ³è§†é¢‘</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/é¡¹ç›®/é¡¹ç›®">é¡¹ç›®</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/éŸ³è§†é¢‘/éŸ³è§†é¢‘">éŸ³è§†é¢‘</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">éŸ³è§†é¢‘/éŸ³é¢‘</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/Audio/Audio">Audio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/Audio/éŸ³é¢‘é‡‡é›†">éŸ³é¢‘é‡‡é›†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/Audio/éŸ³é¢‘å­˜å‚¨">éŸ³é¢‘å­˜å‚¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/Audio/éŸ³é¢‘å¤„ç†">éŸ³é¢‘å¤„ç†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/Audio/éŸ³é¢‘ç¼–è§£ç ">éŸ³é¢‘ç¼–è§£ç </a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/Audio/éŸ³é¢‘æ’­æ”¾">éŸ³é¢‘æ’­æ”¾</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">éŸ³è§†é¢‘/è§†é¢‘</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/éŸ³è§†é¢‘/Video/Video">Video</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/éŸ³è§†é¢‘/Video/è§†é¢‘é‡‡é›†">è§†é¢‘é‡‡é›†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/éŸ³è§†é¢‘/Video/è§†é¢‘å­˜å‚¨">è§†é¢‘å­˜å‚¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/éŸ³è§†é¢‘/Video/è§†é¢‘å¤„ç†">è§†é¢‘å¤„ç†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/éŸ³è§†é¢‘/Video/è§†é¢‘ç¼–è§£ç ">è§†é¢‘ç¼–è§£ç </a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/éŸ³è§†é¢‘/Video/è§†é¢‘æ¸²æŸ“">è§†é¢‘æ¸²æŸ“</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/éŸ³è§†é¢‘/åŒæ­¥/éŸ³è§†é¢‘åŒæ­¥">éŸ³è§†é¢‘åŒæ­¥</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/éŸ³è§†é¢‘/å°è£…/éŸ³è§†é¢‘å°è£…">éŸ³è§†é¢‘å°è£…</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/éŸ³è§†é¢‘/ä¼ è¾“/éŸ³è§†é¢‘ä¼ è¾“">éŸ³è§†é¢‘ä¼ è¾“</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/éŸ³è§†é¢‘/æœåŠ¡ç«¯/æœåŠ¡å™¨">æœåŠ¡å™¨</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">éŸ³è§†é¢‘/é‡è¦æ¡†æ¶</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/å­¦ä¹ èµ„æ–™/ä¸‰æ–¹æ¡†æ¶/FFMpeg/FFmpeg">FFmpeg</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/éŸ³è§†é¢‘/å­¦ä¹ èµ„æ–™/ä¸‰æ–¹æ¡†æ¶/WebRTC/WebRTC">WebRTC</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">è§†é¢‘é‡‡é›†</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="iosmacos-è§†é¢‘é‡‡é›†"></a>iOS/macOS è§†é¢‘é‡‡é›†<a class="hash-link" href="#iosmacos-è§†é¢‘é‡‡é›†" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†ç®¡ç†"></a>é‡‡é›†ç®¡ç†<a class="hash-link" href="#é‡‡é›†ç®¡ç†" title="Direct link to heading">#</a></h2><p>è°æ¥ç®¡ç†é‡‡é›†ï¼Ÿé‡‡é›†çš„å¼€å§‹å’Œç»“æŸï¼Œé‡‡é›†çš„é…ç½®å·¥ä½œç­‰ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="avcapturesession"></a><code>AVCaptureSession</code><a class="hash-link" href="#avcapturesession" title="Direct link to heading">#</a></h3><p>æˆ‘ä»¬ç”¨AVCaptureSession æ¥ç®¡ç†é‡‡é›†ã€‚</p><p><code>AVCaptureSession</code> ç»´æŒä¸€ä¸ªåŒ…å«è¾“å…¥å’Œè¾“å‡ºçš„æ‹“æ‰‘ç»“æ„ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- (BOOL)canAddOutput:(AVCaptureOutput *)output;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- (void)addOutput:(AVCaptureOutput *)output;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><a href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/setting_up_a_capture_session?language=objc" target="_blank" rel="noopener noreferrer">https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/setting_up_a_capture_session?language=objc</a></p><p><img alt="Block diagram of the basic capture session architecture: an AVCaptureSession acquires data from an AVCaptureDevice through AVCaptureDeviceInput, and provides data to one or more AVCaptureOutput objects." src="/assets/images/47df73b5-5cba-4c41-894d-b0a2fb600d1c-20210321074130477-d54dc290f0d295e81efd14165a60cd0a.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†çš„è¾“å…¥"></a>é‡‡é›†çš„è¾“å…¥<a class="hash-link" href="#é‡‡é›†çš„è¾“å…¥" title="Direct link to heading">#</a></h2><p>æ—¢ç„¶è¦é‡‡é›†æ•°æ®ï¼Œæ•°æ®åœ¨å“ªé‡Œï¼Œä»å“ªé‡Œæ¥ï¼Ÿ</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†è®¾å¤‡--avcapturedevice"></a>é‡‡é›†è®¾å¤‡ <code> AVCaptureDevice</code><a class="hash-link" href="#é‡‡é›†è®¾å¤‡--avcapturedevice" title="Direct link to heading">#</a></h3><p>æ•°æ®ä»è®¾å¤‡é‡‡é›†è€Œæ¥ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†æ–¹å‘"></a>é‡‡é›†æ–¹å‘<a class="hash-link" href="#é‡‡é›†æ–¹å‘" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æƒé™é—®é¢˜"></a>æƒé™é—®é¢˜<a class="hash-link" href="#æƒé™é—®é¢˜" title="Direct link to heading">#</a></h3><p>æ‘„åƒå¤´æ¶‰åŠåˆ°ç”¨æˆ·çš„éšç§ï¼Œç»™ä¸ç»™ä½ æˆæƒï¼Œå†³å®šä¸‹ä¸€æ­¥çš„é‡‡é›†èƒ½ä¸èƒ½æˆåŠŸã€‚</p><p><a href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/requesting_authorization_for_media_capture_on_ios?language=objc" target="_blank" rel="noopener noreferrer">https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/requesting_authorization_for_media_capture_on_ios?language=objc</a></p><p><a href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/requesting_authorization_for_media_capture_on_macos?language=objc" target="_blank" rel="noopener noreferrer">https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/requesting_authorization_for_media_capture_on_macos?language=objc</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†çš„è®¾ç½®"></a>é‡‡é›†çš„è®¾ç½®<a class="hash-link" href="#é‡‡é›†çš„è®¾ç½®" title="Direct link to heading">#</a></h3><p>æ€ä¹ˆé‡‡é›†ï¼Ÿ</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†çš„å¤§å°-åˆ†è¾¨ç‡"></a>é‡‡é›†çš„å¤§å°-åˆ†è¾¨ç‡<a class="hash-link" href="#é‡‡é›†çš„å¤§å°-åˆ†è¾¨ç‡" title="Direct link to heading">#</a></h4><p>ä½ è¦é‡‡é›†çš„æ˜¯å¤šå¤§çš„æ•°æ®ï¼Ÿä¹Ÿå°±æ˜¯å¸¸è¯´çš„åˆ†è¾¨ç‡ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">You use the sessionPreset property to customize the quality level, bitrate, or other settings for the output. Most common capture configurations are available through session presets; however, some specialized options (such as high frame rate) require directly setting a capture format on an AVCaptureDevice instance.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>30å¸§ä»¥ä¸‹çš„é‡‡é›†åˆ†è¾¨ç‡è®¾ç½®å¯ç”¨ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@property(nonatomic, copy) AVCaptureSessionPreset sessionPreset;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>30å¸§ä»¥ä¸Šçš„é‡‡é›†åˆ†è¾¨ç‡è®¾ç½®å¯ç”¨ï¼š</p><p>activeFormat</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">To enable capture settings not supported by any session presets (such as high frame rate), change the value of the activeFormat property on the appropriate capture device. When you change the deviceâ€™s format, the session preset automatically changes to this value, indicating that the AVCaptureSession object has relinquished responsibility for configuring its inputs and outputs. (Instead, the capture deviceâ€™s active format dictates the quality of service level provided at the outputs). To return to automatic configuration, use the sessionâ€™s sessionPreset property to choose another preset.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æ€»ç»“ activeFormat æ”¯æŒé«˜å¸§ç‡ï¼Œè®¾ç½®deviceçš„activeFormatåï¼Œsessionå°±æ”¾å¼ƒäº†inputs and outputs çš„è®¾ç½®ã€‚æ­¤æ—¶sessionçš„sessionPresetå€¼æ˜¯ AVCaptureSessionPresetInputPriorityã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">In iOS, directly configuring a capture deviceâ€™s activeFormat property changes the capture sessionâ€™s preset to AVCaptureSessionPresetInputPriority. Upon making this change, the capture session no longer automatically configures the capture format when you call the startRunning method or call the commitConfiguration method after changing the session topology.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">In macOS, a capture session can still automatically configure the capture format after you make changes. To prevent automatic changes to the capture format in macOS, follow the advice listed under the lockForConfiguration: method.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>è®¾ç½®activeFormatè¿™ä¸ªå€¼ä¹‹åï¼ŒiOSå°±ç›´æ¥ç”Ÿæ•ˆäº†ï¼Œsessionä¸ä¼šåœ¨è‡ªåŠ¨é…ç½®äº†ã€‚ä½†æ˜¯Macä¸è¡Œã€‚Macå¦‚æœä¸æƒ³è®©sessionè‡ªåŠ¨é…ç½®è¯¥å’‹åŠå‘¢ï¼Ÿ</p><p><code>- (BOOL)lockForConfiguration:(NSError * _Nullable *)outError;</code></p><p>å®˜æ–¹æä¾›äº†ä¸¤ä¸ªå»ºè®®å¦‚ä¸‹ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">In iOS, directly configuring a capture deviceâ€™s activeFormat property changes the capture sessionâ€™s preset to AVCaptureSessionPresetInputPriority. Upon making this change, the capture session no longer automatically configures the capture format when you call the startRunning method or call the commitConfiguration method after changing the session topology (that is, adding, removing, or rearranging capture inputs and outputs). In macOS, a capture session can still automatically configure the capture format after you make changes. To prevent automatic changes to the capture format in macOS, follow these steps:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Lock the device with the lockForConfiguration: method.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Change the deviceâ€™s activeFormat property.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Begin capture with the sessionâ€™s startRunning method.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Unlock the device with the unlockForConfiguration method.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Or, to prevent automatic changes after modifying session topology in macOS:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Lock the device with the lockForConfiguration: method.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Call the sessionâ€™s beginConfiguration method, change topology, then call the commitConfiguration method.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Unlock the device with the unlockForConfiguration method.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†çš„é¢‘ç‡-å¸§ç‡"></a>é‡‡é›†çš„é¢‘ç‡-å¸§ç‡<a class="hash-link" href="#é‡‡é›†çš„é¢‘ç‡-å¸§ç‡" title="Direct link to heading">#</a></h4><p>å¤šä¹…é‡‡é›†ä¸€æ¬¡ï¼Ÿä¹Ÿå°±æ˜¯å¸¸è¯´çš„å¸§ç‡ã€‚</p><ul><li>å¯¹macè®¾ç½®å¸§ç‡æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚macåªèƒ½é‡‡é›†å‡ºæ¥30å¸§ã€‚</li></ul><p><strong>æµ®ç‚¹æ•°çš„ä¸å‡†ç¡®æ€§</strong></p><p>è¿™å¯èƒ½æ˜¯æœ€è¯¦ç»†çš„CMTimeæ•™ç¨‹: <a href="https://www.jianshu.com/p/f02aad2e7ff5" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/f02aad2e7ff5</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cmtime"></a>CMTime<a class="hash-link" href="#cmtime" title="Direct link to heading">#</a></h3><p>è™½ç„¶Appleå·²ç»æœ‰å¾ˆå¤šæ•°æ®ç»“æ„æ¥è¡¨ç¤ºMacå’ŒiOSå¹³å°ä¸Šçš„æ—¶é—´ï¼Œä½†æ˜¯åœ¨iOS4å’ŒMac OS X 10.7 æ¨å‡ºçš„æ—¶å€™ï¼ŒåŠ ä¸Šäº†CMTimeå’ŒCMTimeRangeã€‚CMTimeçš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-objectivec codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">typedef</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     CMTimeValue    value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     CMTimeScale    timescale</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     CMTimeFlags    flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     CMTimeEpoch    epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> CMTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public typealias CMTimeValue = Int64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public typealias CMTimeScale = Int32</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æ˜¾ç„¶ï¼Œ<code>CMTime</code>å®šä¹‰æ˜¯ä¸€ä¸ªCè¯­è¨€çš„ç»“æ„ä½“ï¼ŒCMTimeæ˜¯ä»¥åˆ†æ•°çš„å½¢å¼è¡¨ç¤ºæ—¶é—´ï¼Œ<code>value</code>è¡¨ç¤ºåˆ†å­ï¼Œ<code>timescale</code>è¡¨ç¤ºåˆ†æ¯ï¼Œ<code>flags</code>æ˜¯ä½æ©ç ï¼Œè¡¨ç¤ºæ—¶é—´çš„æŒ‡å®šçŠ¶æ€ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†çš„è¾“å‡º"></a>é‡‡é›†çš„è¾“å‡º<a class="hash-link" href="#é‡‡é›†çš„è¾“å‡º" title="Direct link to heading">#</a></h2><p>é‡‡é›†åˆ°çš„æ•°æ®ï¼Œæ€ä¹ˆè¾“å‡ºï¼Œæ”¾åˆ°ä»€ä¹ˆåœ°æ–¹ï¼Ÿ</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="è¾“å‡ºçš„æ ¼å¼"></a>è¾“å‡ºçš„æ ¼å¼<a class="hash-link" href="#è¾“å‡ºçš„æ ¼å¼" title="Direct link to heading">#</a></h3><p>æœºå™¨é‡‡é›†åçš„åŸç”Ÿæ•°æ®ï¼Œä¸€èˆ¬éœ€è¦ç»è¿‡è§£ç æˆ–è€…åœ¨ç¼–ç ï¼ˆdecode or re-encodeï¼‰åè¾“å‡ºã€‚</p><p>ç¼–è§£ç æœ¬è´¨ä¸Šæ˜¯æ”¹å˜æ•°æ®æ ¼å¼ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/*!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @property videoSettings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @abstract</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Specifies the settings used to decode or re-encode video before it is output by the receiver.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @discussion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    See AVVideoSettings.h for more information on how to construct a video settings dictionary. To receive samples in their device native format, set this property to an empty dictionary (i.e. [NSDictionary dictionary]). To receive samples in a default uncompressed format, set this property to nil. Note that after this property is set to nil, subsequent querying of this property will yield a non-nil dictionary reflecting the settings used by the AVCaptureSession&#x27;s current sessionPreset.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    On iOS, the only supported key is kCVPixelBufferPixelFormatTypeKey. Supported pixel formats are kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange, kCVPixelFormatType_420YpCbCr8BiPlanarFullRange and kCVPixelFormatType_32BGRA.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@property(nonatomic, copy, null_resettable) NSDictionary&lt;NSString *, id&gt; *videoSettings;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>é€šè¿‡ videoSettings å¯ä»¥å¾—åˆ°çš„æ ¼å¼ã€‚</p><ul><li>device native format</li><li>default uncompressed format</li><li>æŒ‡å®šçš„æ ¼å¼ï¼ˆiOSåªæœ‰3ç§ï¼‰</li></ul><p>Macæ”¯æŒçš„è®¾ç½®å¤šä¸€äº›ï¼šå‚è§ AVVideoSettings.h</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="macæ”¯æŒçš„è¾“å‡ºæ ¼å¼"></a>macæ”¯æŒçš„è¾“å‡ºæ ¼å¼<a class="hash-link" href="#macæ”¯æŒçš„è¾“å‡ºæ ¼å¼" title="Direct link to heading">#</a></h4><p>å¯¹åº”çš„æ˜¯æœºå™¨ç¡¬ä»¶æ”¯æŒçš„format</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-objective-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    NSLog(@&quot;ff------ff:availableVideoCVPixelFormatTypes:%@&quot;,videoOutput.availableVideoCVPixelFormatTypes);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    for (NSInteger i = 0; i&lt;videoOutput.availableVideoCVPixelFormatTypes.count; i++) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        UInt32 fcode = [(videoOutput.availableVideoCVPixelFormatTypes[i]) unsignedIntValue];        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        NSLog(@&quot;kkk----%s&quot;,FourCC2Str(fcode));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-04-02 16:20:21.576302+0800 pass-sdk-demo-m1-macOS[1980:1207589] ff------ff:availableVideoCVPixelFormatTypes:(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    846624121,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    2037741171,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    875704438,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    875704422,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    32,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1111970369</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-04-02 16:20:21.576409+0800 pass-sdk-demo-m1-macOS[1980:1207589] kkk----2vuy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-04-02 16:20:21.576465+0800 pass-sdk-demo-m1-macOS[1980:1207589] kkk----yuvs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-04-02 16:20:21.576504+0800 pass-sdk-demo-m1-macOS[1980:1207589] kkk----420v</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-04-02 16:20:21.576577+0800 pass-sdk-demo-m1-macOS[1980:1207589] kkk----420f</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-04-02 16:20:21.576676+0800 pass-sdk-demo-m1-macOS[1980:1207589] kkk----</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-04-02 16:20:21.576775+0800 pass-sdk-demo-m1-macOS[1980:1207589] kkk----BGRA</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="macç¡¬ä»¶æ”¯æŒçš„format"></a>macç¡¬ä»¶æ”¯æŒçš„format<a class="hash-link" href="#macç¡¬ä»¶æ”¯æŒçš„format" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-objective-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">+ (void)printSupportDeviceFormatsOfDevice:(AVCaptureDevice *)device {    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    for (AVCaptureDeviceFormat *format in [device formats]) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        NSLog(@&quot;æ”¯æŒçš„ç±»å‹ï¼š%@&quot;,format);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>AVCaptureVideoDataOutput è®¾ç½®videoSettings çš„åˆ†è¾¨ç‡æ˜¯ä¸€ä¸ªæœŸæœ›å€¼ï¼Œmacä¼šè¿”å›ä¸€ä¸ªæœ€åˆé€‚çš„åˆ†è¾¨ç‡ï¼Œè‡³äºæ˜¯å¦‚ä½•æ‰¾çš„ï¼Œè¿™ä¸ªç›®å‰æˆ‘è¿˜ä¸çŸ¥é“ã€‚ç›®å‰æ¥çœ‹ï¼Œä»–çš„å¯»æ‰¾ç®—æ³•å’Œwebrtc æœ‰äº›ç›¸ä¼¼ã€‚å–é•¿å®½çš„ç»å¯¹å€¼çš„æœ€å°å€¼ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ä¿å­˜åˆ°æ–‡ä»¶"></a>ä¿å­˜åˆ°æ–‡ä»¶<a class="hash-link" href="#ä¿å­˜åˆ°æ–‡ä»¶" title="Direct link to heading">#</a></h3><ul><li>Macæ²™ç›’</li></ul><p><img alt="image-20210402113605597" src="/assets/images/image-20210402113605597-36f003a71b7e7fe13cf6905abe2b9e65.png"></p><p>macOS-Cocoaå¼€å‘ä¹‹æ²™ç›’æœºåˆ¶åŠè®¿é—®Sandboxä¹‹å¤–çš„æ–‡ä»¶ï¼š<a href="https://www.jianshu.com/p/c8785cb864e9" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/c8785cb864e9</a></p><p>ä¸ä¸Šæ¶çš„æ—¶å€™ï¼Œå¯ä»¥å…³é—­æ²™ç›’ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯"></a>æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯<a class="hash-link" href="#æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="mediainfo"></a>mediaInfo<a class="hash-link" href="#mediainfo" title="Direct link to heading">#</a></h4><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="yuveye"></a>yuvEye<a class="hash-link" href="#yuveye" title="Direct link to heading">#</a></h4><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="åˆ†æå·¥å…·"></a>åˆ†æå·¥å…·<a class="hash-link" href="#åˆ†æå·¥å…·" title="Direct link to heading">#</a></h4><p>H264/H265/YUVç æµåˆ†æå·¥å…·æ¨è(ä¸€)ï¼š<a href="https://blog.csdn.net/u010164190/article/details/108551087" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/u010164190/article/details/108551087</a></p><hr><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡æ ·å·¥å…·"></a><strong>é‡‡æ ·å·¥å…·</strong><a class="hash-link" href="#é‡‡æ ·å·¥å…·" title="Direct link to heading">#</a></h5><p>iOS/macOSç”¨ä»€ä¹ˆæ¥é‡‡é›†è§†é¢‘æ•°æ®ï¼Ÿ</p><ul><li><code>AVCaptureSession</code></li></ul><p>AVFoundation æ¡†æ¶ä¸‹ä¸“é—¨æœ‰ä¸€éƒ¨åˆ†è®²è§£Captureã€‚</p><p><img alt="image-20210202214731561" src="/assets/images/image-20210202214731561-6a6d5e422ec6e7e6baa8a9f6e57385bf.png"></p><p>é‡ç‚¹ç±»ï¼š<code>AVCaptureSession</code></p><p><strong>AVCaptureDevice</strong>: ä¿¡å·é‡‡é›†ç¡¬ä»¶è®¾å¤‡(æ‘„åƒå¤´ã€éº¦å…‹é£ã€å±å¹•ç­‰)</p><p><strong>AVCaptureInput</strong>: è®¾å¤‡è¾“å…¥ä¿¡å·</p><p><strong>AVCaptureOutput</strong>ï¼šè®¾å¤‡è¾“å‡ºä¿¡å·</p><p><strong>AVCaptureSession</strong>ï¼šAVCaptureSessionæ˜¯æ•´ä¸ªCaptureçš„æ ¸å¿ƒã€‚ç±»ä¼¼äºRunLoopï¼Œå®ƒä¸æ–­çš„ä»è¾“å…¥æºè·å–æ•°æ®ï¼Œç„¶ååˆ†å‘ç»™å„ä¸ªè¾“å‡ºæºã€‚</p><p><strong>AVCaptureConnection</strong>ï¼šAVCaptureConnectionsæ˜¯Sessionå’ŒOutputä¸­é—´çš„æ§åˆ¶èŠ‚ç‚¹ã€‚æ¯ä¸ªOutputä¸Sessionå»ºç«‹è¿æ¥åï¼Œéƒ½ä¼šåˆ†é…ä¸€ä¸ªé»˜è®¤çš„AVCpatureConnection</p><p><strong>AVCapturePreviewLayer</strong>ï¼šé¢„è§ˆå±‚ï¼Œæ˜¯ä¸€ä¸ªCALayerå¯¹è±¡ï¼Œæä¾›æ‘„åƒå¤´çš„é¢„è§ˆåŠŸèƒ½ï¼Œç…§ç‰‡ä»¥åŠè§†é¢‘å°±æ˜¯é€šè¿‡æŠŠAVCapturePreviewLayeræ·»åŠ åˆ°UIView çš„layerä¸Šæ¥æ˜¾ç¤º</p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ•è·æ ¼å¼"></a>æ•è·æ ¼å¼<a class="hash-link" href="#æ•è·æ ¼å¼" title="Direct link to heading">#</a></h6><p><code>AVCaptureDeviceFormat</code> </p><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/155efb36e041" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/155efb36e041</a></p><ol><li>åªèƒ½åœ¨å‡ ä¸ªæ”¯æŒçš„æ•è·æ ¼å¼ä¸­é€‰æ‹©ã€‚å¦åˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ã€‚</li><li>è®¾ç½®æ´»åŠ¨æ•è·æ ¼å¼å‰åéœ€è¦åŠ é”ã€‚</li></ol><p>sessionPreset</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ—¶é—´æˆ³"></a>æ—¶é—´æˆ³<a class="hash-link" href="#æ—¶é—´æˆ³" title="Direct link to heading">#</a></h5><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†è®¾ç½®"></a>é‡‡é›†è®¾ç½®<a class="hash-link" href="#é‡‡é›†è®¾ç½®" title="Direct link to heading">#</a></h5><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="è®¾å¤‡ç±»å‹"></a>è®¾å¤‡ç±»å‹<a class="hash-link" href="#è®¾å¤‡ç±»å‹" title="Direct link to heading">#</a></h6><p>AVCaptureDeviceType</p><p>è®¾å¤‡ç±»å‹<a href="https://developer.apple.com/documentation/avfoundation/avcapturedevicetype?changes=latest_minor&amp;language=objc" target="_blank" rel="noopener noreferrer">AVCaptureDeviceType</a>æ˜¯ä½¿ç”¨<code>typedef</code>ä¿®é¥°çš„æ ‡è¯†ç¬¦ï¼Œæä¾›å„ç§è®¾å¤‡ç±»å‹ï¼Œä¸<code>+ defaultDeviceWithDeviceType:mediaType:position:</code>æ–¹æ³•å’Œ<code>AVCaptureDeviceDiscoverySession</code>ç±»ä¸€èµ·ä½¿ç”¨ã€‚</p><table><thead><tr><th>è®¾å¤‡ç±»å‹<code>AVCaptureDeviceType</code></th><th>æè¿°</th></tr></thead><tbody><tr><td><code>AVCaptureDeviceTypeBuiltInMicrophone</code></td><td>ä¸€ä¸ªå†…ç½®çš„éº¦å…‹é£</td></tr><tr><td><code>AVCaptureDeviceTypeBuiltInWideAngleCamera</code></td><td>å†…ç½®å¹¿è§’ç›¸æœº,è¿™äº›è£…ç½®é€‚ç”¨äºä¸€èˆ¬ç”¨é€”ã€‚</td></tr><tr><td><code>AVCaptureDeviceTypeBuiltInTelephotoCamera</code></td><td>å†…ç½®é•¿ç„¦ç›¸æœºï¼Œæ¯”å¹¿è§’ç›¸æœºçš„ç„¦è·é•¿ã€‚è¿™ç§ç±»å‹åªæ˜¯å°†çª„è§’è®¾å¤‡ä¸é…å¤‡ä¸¤ç§ç±»å‹çš„æ‘„åƒæœºçš„ç¡¬ä»¶ä¸Šçš„å®½è§’è®¾å¤‡åŒºåˆ†å¼€æ¥ã€‚è¦ç¡®å®šæ‘„åƒæœºè®¾å¤‡çš„å®é™…ç„¦è·ï¼Œå¯ä»¥æ£€æŸ¥<code>AVCaptureDevice</code>çš„<code>format</code>æ•°ç»„ä¸­çš„<code>AVCaptureDeviceFormat</code>å¯¹è±¡ã€‚</td></tr><tr><td><code>AVCaptureDeviceTypeBuiltInDualCamera</code></td><td>å¹¿è§’ç›¸æœºå’Œé•¿ç„¦ç›¸æœºçš„ç»„åˆï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ‹ç…§ï¼Œå½•åƒçš„<code>AVCaptureDevice</code>ã€‚å…·æœ‰å’Œæ·±åº¦æ•æ‰ï¼Œå¢å¼ºå˜ç„¦å’ŒåŒå›¾åƒæ•æ‰åŠŸèƒ½ã€‚</td></tr><tr><td><code>AVCaptureDeviceTypeBuiltInTrueDepthCamera</code></td><td>ç›¸æœºå’Œå…¶ä»–ä¼ æ„Ÿå™¨çš„ç»„åˆï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ•æ‰è®¾å¤‡ï¼Œèƒ½å¤Ÿæ‹ç…§ã€è§†é¢‘å’Œæ·±åº¦æ•æ‰ã€‚</td></tr><tr><td><code>AVCaptureDeviceTypeBuiltInDuoCamera</code></td><td><code>iOS 10.2</code> ä¹‹åæ·»åŠ è‡ªåŠ¨å˜ç„¦åŠŸèƒ½ï¼Œè¯¥å€¼åŠŸèƒ½è¢«<code>AVCaptureDeviceTypeBuiltInDualCamera</code>æ›¿ä»£</td></tr></tbody></table><p>ä½œè€…ï¼šè‹æ²«ç¦»
é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/155efb36e041" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/155efb36e041</a>
æ¥æºï¼šç®€ä¹¦
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="è®¾å¤‡ä½ç½®"></a>è®¾å¤‡ä½ç½®<a class="hash-link" href="#è®¾å¤‡ä½ç½®" title="Direct link to heading">#</a></h6><p>å‰ç½®è¿˜æ˜¯åç½®</p><p>AVCaptureDevicePosition</p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="è®¾å¤‡é€‰æ‹©"></a>è®¾å¤‡é€‰æ‹©<a class="hash-link" href="#è®¾å¤‡é€‰æ‹©" title="Direct link to heading">#</a></h6><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†æ ¼å¼-avtiveformat"></a>é‡‡é›†æ ¼å¼-avtiveformat<a class="hash-link" href="#é‡‡é›†æ ¼å¼-avtiveformat" title="Direct link to heading">#</a></h6><p>AVCaptureDeviceFormat</p><p>ä¸€ä¸ªperset ä¸€ä¸ªactiveformatã€‚</p><p>When using a session preset, the session automatically controls the capture deviceâ€™s active format. However, some specialized capture options (such as high frame rate) are not available in session presets. For these options, you can set the capture deviceâ€™s active format instead. Doing so changes the associated capture sessionâ€™s preset to <a href="doc://com.apple.documentation/documentation/avfoundation/avcapturesessionpresetinputpriority?language=objc" target="_blank" rel="noopener noreferrer"><code>AVCaptureSessionPresetInputPriority</code></a>.</p><p>é«˜å¸§ç‡ å¿…é¡»å¾—ä½¿ç”¨ activeformatã€‚</p><p> é˜»æ­¢activeformat è‡ªåŠ¨æ”¹å˜çš„æ–¹æ³•ã€‚</p><p> <a href="https://developer.apple.com/documentation/avfoundation/avcapturedevice/1387810-lockforconfiguration?language=objc" target="_blank" rel="noopener noreferrer">https://developer.apple.com/documentation/avfoundation/avcapturedevice/1387810-lockforconfiguration?language=objc</a></p><p>å‚è€ƒï¼š</p><p><a href="https://stackoverflow.com/questions/36689578/avfoundation-capturing-video-with-custom-resolution/40097057" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/36689578/avfoundation-capturing-video-with-custom-resolution/40097057</a></p><p><a href="https://stackoverflow.com/questions/15608931/mac-osx-avfoundation-video-capture" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/15608931/mac-osx-avfoundation-video-capture</a></p><p> <a href="https://stackoverflow.com/questions/36689578/avfoundation-capturing-video-with-custom-resolution/40097057" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/36689578/avfoundation-capturing-video-with-custom-resolution/40097057</a></p><ul><li>é€‰æ‹©æœ€ä½³format</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kCVPixelFormatType_420YpCbCr8BiPlanarFullRange  = &#x27;420f&#x27;, /* Bi-Planar Component Y&#x27;CbCr 8-bit 4:2:0, full-range (luma=[0,255] chroma=[1,255]).  baseAddr points to a big-endian CVPlanarPixelBufferInfo_YCbCrBiPlanar struct */ </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> æ³¨æ„ä¸€ä¸ªFourCharCode</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> pixelFormat</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ios:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange = &#x27;420v&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> kCVPixelFormatType_420YpCbCr8BiPlanarFullRange  = &#x27;420f&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> mac:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange = &#x27;420v&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> kCVPixelFormatType_422YpCbCr8_yuvs = &#x27;yuvs&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> å¦‚æœè¦æ±‚é‡‡æ ·420çš„è¯ï¼Œé‚£ä¹ˆmacå°±åªèƒ½ç”¨ 420vã€‚ioså¦‚æœè¦å’Œmacç»Ÿä¸€çš„è¯ï¼Œæœ€å¥½ä¹Ÿç”¨420vã€‚</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†å¸§å¤§å°"></a>é‡‡é›†å¸§å¤§å°<a class="hash-link" href="#é‡‡é›†å¸§å¤§å°" title="Direct link to heading">#</a></h6><p>ç¬¬ä¸€ç§æ–¹å¼ï¼š</p><p><code>@property(nonatomic, copy) AVCaptureSessionPreset sessionPreset;</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _session = [AVCaptureSession new];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [_session setSessionPreset:AVCaptureSessionPreset352x288];</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ç¬¬äºŒç§æ–¹å¼ï¼š</p><p>AVCaptureDevice.formats</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">An AVCaptureDeviceFormat object describes in detail the video, image, or audio parameters of a specific mode of capture. If you need access to capture settings not covered by an AVCaptureSession preset, you can set the activeFormat property to any of the formats in this array.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">You can observe changes to the value of this property using Key-value observing.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="yuv420é‡‡æ ·ä¹‹åçš„æ•°æ®å¤§å°"></a>YUV420é‡‡æ ·ä¹‹åçš„æ•°æ®å¤§å°<a class="hash-link" href="#yuv420é‡‡æ ·ä¹‹åçš„æ•°æ®å¤§å°" title="Direct link to heading">#</a></h5><p>æ¯ä¸ªY/U/Vçš„é‡‡æ ·ç‚¹ç”¨<strong>8bit</strong>æ¥è¡¨ç¤ºï¼Œå³1Bytes.</p><ul><li>720p</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1280 * 720 * 8 *(1 + 1/4 + 1/4) / 8 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">= 1382400 Bytes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">= 1350 KB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">çº¦= 1.318359375 M</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¤§çº¦æ˜¯<strong>1.3M</strong>ã€‚</p><ul><li>1080p</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1920 * 1080 * 8 *(1 + 1/4 + 1/4) / 8 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">= 3110400 Bytes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=  3037.5 KB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">çº¦= 2.966308594 M</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¤§çº¦<strong>3M</strong>ã€‚</p><ul><li>640*360</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">640*360*8*(1+1/4+1/4)/8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=345600 Bytes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=337.5KB</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ä½œè€…ï¼šFlyingPenguin
é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/b14391ca8fdf" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/b14391ca8fdf</a>
æ¥æºï¼šç®€ä¹¦
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><p>xcode Macå·¥ç¨‹é…ç½® é‡‡é›†æ³¨æ„ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> å½“mac appå¼€å¯äº†hardened runtimeæ—¶ï¼Œå¦‚æœentitlementæ–‡ä»¶æ²¡æœ‰æ­£ç¡®è®¾ç½®ï¼Œä¼šå¯¼è‡´ç¨‹åºåœ¨è·å–æƒé™æ—¶å´©æºƒã€‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> entitlementsæ–‡ä»¶ä¸­æ·»åŠ com.apple.security.device.cameraè®¾ç½®ä¸ºYESå³å¯</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> hardruntime æœ‰å…³çš„entitlementè¯´æ˜è§é“¾æ¥</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€ŒCaicaiNo.1ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/shengpeng3344/article/details/103558765</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="image-20210318183505041" src="/assets/images/image-20210318183505041-ea8ba3cc4c76ffcc4c4a5b22ecdc4d42.png"></p><p><img alt="image-20210318183448988" src="/assets/images/image-20210318183448988-00bf3830be40c8fc6f961307895ff980.png"></p><p>å‚è€ƒï¼šiOSè‡ªå®šä¹‰ç›¸æœº/å‚æ•°è°ƒèŠ‚/è§†é¢‘é€Ÿç‡è°ƒèŠ‚/è§†é¢‘åˆå¹¶ï¼š<a href="https://www.jianshu.com/p/06ed571fb3b5" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/06ed571fb3b5</a></p><p>å‚è€ƒï¼šOCä¹‹AVCaptureDevice <a href="https://www.jianshu.com/p/155efb36e041" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/155efb36e041</a></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é¢œè‰²ç¼–ç è‰²å½©ç©ºé—´"></a>é¢œè‰²ç¼–ç /è‰²å½©ç©ºé—´<a class="hash-link" href="#é¢œè‰²ç¼–ç è‰²å½©ç©ºé—´" title="Direct link to heading">#</a></h5><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rgb"></a>RGB<a class="hash-link" href="#rgb" title="Direct link to heading">#</a></h6><p>RGBï¼ˆçº¢ã€ç»¿ã€è“ï¼‰åªæ˜¯ä¼—å¤šé¢œè‰²ç©ºé—´çš„ä¸€ç§ã€‚é‡‡ç”¨è¿™ç§ç¼–ç æ–¹æ³•ï¼Œæ¯ç§é¢œè‰²éƒ½å¯ç”¨ä¸‰ä¸ªå˜é‡æ¥è¡¨ç¤º-çº¢è‰²ç»¿è‰²ä»¥åŠè“è‰²çš„å¼ºåº¦ã€‚è®°å½•åŠæ˜¾ç¤ºå½©è‰²å›¾åƒæ—¶ï¼ŒRGBæ˜¯æœ€å¸¸è§çš„ä¸€ç§æ–¹æ¡ˆã€‚</p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="yuv"></a>YUV<a class="hash-link" href="#yuv" title="Direct link to heading">#</a></h6><p>YUVæ¨¡å‹é¦–å…ˆå°†äº®åº¦è¿™ä¸€äººçœ¼æœ€ä¸ºæ•æ„Ÿçš„è¦ç´ æŠ½ç¦»äº†å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªåªæœ‰äº®åº¦ä¿¡æ¯çš„å¹³é¢ï¼Œç„¶åæ‰æ˜¯æè¿°å…·ä½“è‰²å½©çš„Uå’ŒVå¹³é¢ï¼Œåˆ†åˆ«å…·æœ‰è‰²åº¦ï¼ˆChrominanceï¼‰å’Œæµ“åº¦ï¼ˆChromaï¼‰ä¿¡æ¯ã€‚</p><p><img alt="img" src="/assets/images/Barn-yuv-4e144e0ac5c81add849283d805e623a0.png"></p><p>YUVä¸‰ä¸ªé€šé“çš„ä¸åŒä¿¡æ¯
ä»ä¸Šåˆ°ä¸‹åˆ†åˆ«ä¸ºYã€Uã€V
å›¾ç‰‡æ¥è‡ªäº<a href="https://upload.wikimedia.org/wikipedia/commons/2/29/Barn-yuv.png" target="_blank" rel="noopener noreferrer">Wikipedia</a></p><ul><li>ä¸ºä»€ä¹ˆä½¿ç”¨YUVï¼Ÿ</li></ul><p>é‚£ä¹ˆä¸ºä»€ä¹ˆæœ‰äº†RGBæˆ‘ä»¬ä»ç„¶éœ€è¦YUVå‘¢ï¼Ÿæˆ‘ä»¬è¦å›åˆ°äººç±»åˆšæ‹¥æœ‰å½©è‰²ç”µè§†çš„æ—¶å€™ï¼Œåœ¨é‚£æ®µä»é»‘ç™½ç”µè§†å‘å½©è‰²ç”µè§†çš„è¿‡æ¸¡æœŸï¼Œç”µè§†ç³»ç»Ÿéœ€è¦æä¾›å¯¹é»‘ç™½ç”µè§†çš„å…¼å®¹æ€§ï¼Œå¦å¤–è¿˜è¦è€ƒè™‘åˆ°ç”µè§†å¹¿æ’­ç³»ç»Ÿé‚£æœ‰é™çš„å¸¦å®½ï¼Œå¦‚æœä½¿ç”¨RGBé¢œè‰²æ¨¡å‹ï¼Œé‚£ä¹ˆä¼ è¾“å¸¦å®½å°±æ˜¯åŸæ¥çš„ä¸‰å€ã€‚ä¸»è¦æ˜¯ä»¥ä¸Šä¸¤ä¸ªåŸå› ï¼Œèƒ½å¤Ÿå…¼å®¹é»‘ç™½ç”µè§†ç³»ç»Ÿå’Œæ›´ä¸ºèŠ‚çœå¸¦å®½çš„YUVè‰²å½©æ¨¡å‹å°±è¢«å‘æ˜äº†å‡ºæ¥ï¼Œå®ƒä¸RGBä¹‹é—´æ˜¯æ— æŸè½¬æ¢çš„ã€‚</p><p>æœ‰é—®æœ‰ç­”ï¼šä»€ä¹ˆæ˜¯YUVã€YPbPrã€YCbCrï¼Ÿï¼š<a href="https://www.expreview.com/72374.html" target="_blank" rel="noopener noreferrer">https://www.expreview.com/72374.html</a></p><p>è€ŒYPbPrã€YCbCråªæ˜¯YUVåœ¨ä¸åŒé¢†åŸŸä¸­çš„å…·ç°åŒ–ç½¢äº†ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p><blockquote><p>å¯ä»¥çœ‹ä¸€ä¸‹è‡ªå·±çš„æˆ´å°”æ˜¾ç¤ºå™¨ é¢œè‰²é€‰é¡¹ æœ‰è¾“å…¥é¢œè‰²æ ¼å¼é€‰é¡¹å¯ä»¥é€‰æ‹©RGB å’Œ YPbPrã€‚</p></blockquote><ul><li><a href="https://welkinchen.pixnet.net/blog/post/5446075-yuv%2c-ypbpr-%26-ycbcr-%E5%B7%AE%E7%95%B0" target="_blank" rel="noopener noreferrer">YUV, YPbPr &amp; YCbCr å·®ç•°</a></li></ul><p>YUV (YPbPr/YCbCr) æŒ‡çš„éƒ½æ˜¯è‰²å·®è¨Šè™Ÿ, ä¸åŒçš„æ˜¯YPbPr æ˜¯é¡æ¯”è‰²å·®è¨Šè™Ÿ, YCbCr æ˜¯æ•¸ä½è‰²å·®è¨Šè™Ÿ.
( èµ·å…ˆ YUV æ‡‰è©²æ˜¯æŒ‡ YPbPr , ä½†æ‡‰è©²çœ‹æˆYUV YPbPr/YCbCr  )</p><p>äº‹å¯¦ä¸Šå¦‚å‰é¢æ‰€èªªï¼ŒYCbCræ˜¯æ•¸ä½è™•ç†å‚³è¼¸è¨Šè™Ÿï¼ŒYPbPræ˜¯é¡æ¯”å‚³è¼¸è¨Šè™Ÿ</p><ul><li>RGBå’ŒYUV</li></ul><p><a href="https://www.jianshu.com/p/cd7e73005ac4" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/cd7e73005ac4</a></p><ul><li>YUVæ ¼å¼é€šå¸¸æœ‰ä¸¤å¤§ç±»ï¼šæ‰“åŒ…ï¼ˆpackedï¼‰æ ¼å¼å’Œå¹³é¢ï¼ˆplanarï¼‰æ ¼å¼ã€‚</li></ul><p>å‰è€…å°†YUVåˆ†é‡å­˜æ”¾åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé€šå¸¸æ˜¯å‡ ä¸ªç›¸é‚»çš„åƒç´ ç»„æˆä¸€ä¸ªå®åƒç´ ï¼ˆmacro-pixelï¼‰ï¼›è€Œåè€…ä½¿ç”¨ä¸‰ä¸ªæ•°ç»„åˆ†å¼€å­˜æ”¾YUVä¸‰ä¸ªåˆ†é‡ï¼Œå°±åƒæ˜¯ä¸€ä¸ªä¸‰ç»´å¹³é¢ä¸€æ ·ã€‚</p><ul><li>YUV420 </li></ul><p>4:2:0å¹¶ä¸æ„å‘³ç€åªæœ‰Yï¼ŒCbè€Œæ²¡æœ‰Cråˆ†é‡ã€‚å®ƒæŒ‡å¾—æ˜¯å¯¹æ¯è¡Œæ‰«æçº¿æ¥è¯´ï¼Œåªæœ‰ä¸€ç§è‰²åº¦åˆ†é‡ä»¥2:1çš„æŠ½æ ·ç‡å­˜å‚¨ã€‚ç›¸é‚»çš„æ‰«æè¡Œå­˜å‚¨ä¸åŒçš„è‰²åº¦åˆ†é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€è¡Œæ˜¯4:2:0çš„è¯ï¼Œä¸‹ä¸€è¡Œå°±æ˜¯4:0:2ï¼Œå†ä¸‹ä¸€è¡Œæ˜¯4:2:0...ä»¥æ­¤ç±»æ¨ã€‚</p><p><img alt="image-20211005125901383" src="/assets/images/image-20211005125901383-102e2cfaeccd77d78d53f835169c569c.png"></p><hr><p>æ•°æ®é‡è®¡ç®—</p><p>YUV = Y*1.5</p><p>YUV = RGB/2</p><p>ä½¿ç”¨YUVé‡‡é›†ï¼Œæ•°æ®é‡ç›´æ¥å°‘ä¸€åŠã€‚</p><ul><li>æ—¢ç„¶YUVæ›´æœ‰ä¼˜åŠ¿ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¿ç•™RGBå‘¢ï¼Ÿ</li></ul><p>å› ä¸ºç›®å‰äººç±»å‘æ˜çš„æ‰€æœ‰å½©è‰²çš„è¾“å…¥è¾“å‡ºè®¾å¤‡ï¼Œæœ¬è´¨ä¸Šéƒ½åªæ”¯æŒRGBæ•°æ®ã€‚å“ªæ€•è®¾å¤‡å…è®¸YUVçš„è¾“å…¥è¾“å‡ºï¼Œé‚£ä¹Ÿæ˜¯ç»è¿‡å†…éƒ¨çš„æ•°æ®è½¬æ¢è€Œé—´æ¥æ”¯æŒã€‚</p><p>yuvå’Œrgbå„æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿï¼š<a href="https://www.zhihu.com/question/24994945" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/24994945</a></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ ¼å¼è½¬æ¢pixelformat-è½¬æ¢"></a>æ ¼å¼è½¬æ¢(PixelFormat è½¬æ¢)<a class="hash-link" href="#æ ¼å¼è½¬æ¢pixelformat-è½¬æ¢" title="Direct link to heading">#</a></h5><p>iosè°ƒç”¨ç³»ç»Ÿæ¡†æ¶é‡‡é›†å‡ºçš„è§†é¢‘YUVæ ¼å¼é»˜è®¤ä¸ºNV12.</p><p><img alt="img" src="data:image/gif;base64,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"></p><p>å‚è€ƒï¼šè§†é¢‘å­˜å‚¨æ ¼å¼YUV420 NV12 NV21 i420 YV12ï¼š<a href="https://www.jianshu.com/p/e67f79f10c65" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/e67f79f10c65</a></p><p>I420:åˆå«YU12ï¼Œå®‰å“çš„æ¨¡å¼ã€‚å­˜å‚¨é¡ºåºæ˜¯å…ˆå­˜Yï¼Œå†å­˜Uï¼Œæœ€åå­˜Vã€‚YYYYUUUVVV</p><p>NV12:IOSåªæœ‰è¿™ä¸€ç§æ¨¡å¼ã€‚å­˜å‚¨é¡ºåºæ˜¯å…ˆå­˜Yï¼Œå†UVäº¤æ›¿å­˜å‚¨ã€‚YYYYUVUVUV</p><p>NV21:å®‰å“çš„æ¨¡å¼ã€‚å­˜å‚¨é¡ºåºæ˜¯å…ˆå­˜Yï¼Œå†å­˜Uï¼Œå†VUäº¤æ›¿å­˜å‚¨ã€‚YYYYVUVUVU</p><p>NV12 NV21 i420 YV12 è¿™äº›æ˜¯yuv420çš„å­˜å‚¨æ ¼å¼ã€‚ä¹Ÿå°±æ˜¯é‡‡é›†å‡ºæ¥çš„æ•°æ®å¦‚ä½•ç»„ç»‡ï¼Ÿç»„ç»‡æ•°æ®çš„ä¸åŒï¼Œå°±æ˜¯ä¸åŒçš„æ¨¡å¼ã€‚</p><p>YUV420åŒ…å«YUV420pä¸YUV420sp, åŒºåˆ«åœ¨äºplaneæ•°é‡åˆ†åˆ«ä¸º3å’Œ2. </p><p>YUV420påˆ†ä¸ºYV12å’ŒYU12(i420), æ ¹æ®uvåˆ†é‡çš„é¡ºåºä¸åŒYUV420påˆ†ä¸ºYV12å’ŒYU12(i420), </p><p>YUV420spåˆ†ä¸ºNV12å’ŒNV21. YUV420spä¸­uvåˆ†é‡æ˜¯æ‚ç³…åœ¨ä¸€ä¸ªplaneä¸­ä»¥uvuvæˆ–è€…vuvuçš„é¡ºåºå­˜å‚¨ä¸ç¬¬äºŒä¸ªplane.</p><p>éœ€æ±‚ï¼š ç›®å‰éœ€è¦å°† nv12 è½¬æˆ i420 ç»Ÿä¸€å¤„ç†ã€‚</p><p>ä¸ºæ»¡è¶³ä¸åŒä¸šåŠ¡éœ€æ±‚,æˆ‘ä»¬éœ€è¦æŠŠnv12è½¬æ¢ä¸ºi420æˆ–è€…rgbaç­‰æ ¼å¼.
libYUVåº“å’Œffmpegéƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬è½»æ¾æå®š.(æ¨èlibyuvåº“,æ€§èƒ½æ¯”ffmpegé«˜å‡ºå¾ˆå¤š).</p><p>libyuvæä¾› è¿™ç§è½¬æ¢èƒ½åŠ›ã€‚</p><p><a href="https://chromium.googlesource.com/libyuv/libyuv/" target="_blank" rel="noopener noreferrer">https://chromium.googlesource.com/libyuv/libyuv/</a></p><p>é‡‡é›†çš„æ—¶å€™æŒ‡å®šæ ¼å¼</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-objective-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">        NSDictionary *settings = @{(NSString *)kCVPixelBufferPixelFormatTypeKey : @(kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                   (NSString *)kCVPixelBufferWidthKey : @(self.videoConfig.dimension.width),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                   (NSString *)kCVPixelBufferHeightKey : @(self.videoConfig.dimension.height)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ä¸»è¦æ˜¯ï¼š<code>PixelFormatType</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">å‘ç°æœ‰å››ä¸ªï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kCVPixelFormatType_420YpCbCr8Planar</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kCVPixelFormatType_420YpCbCr8PlanarFullRange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kCVPixelFormatType_420YpCbCr8BiPlanarFullRange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ä½œè€…ï¼šç‰‡ç‰‡ç¢</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">é“¾æ¥ï¼šhttps://www.jianshu.com/p/e67f79f10c65</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">æ¥æºï¼šç®€ä¹¦</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>â€‹    //è·å¾—å¹³é¢æ•°</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CVPixelBufferRef pixelBuffer = CMSampleBufferGetImageBuffer(sampleBuffer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CVPixelBufferLockBaseAddress(pixelBuffer, 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    //è·å¾—å¹³é¢æ•°</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int numberOfPlanes = (int)CVPixelBufferGetPlaneCount(pixelBuffer);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ç»“è®ºï¼šPlanaræ˜¯3  è€ŒBiPlanaræ˜¯2</p><p>è€ŒVideoRangeå’ŒFullRangeæ˜¯å–å€¼èŒƒå›´</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange = &#x27;420v&#x27;, /* Bi-Planar Component Y&#x27;CbCr 8-bit 4:2:0, video-range (luma=[16,235] chroma=[16,240]).Â  baseAddr points to a big-endian CVPlanarPixelBufferInfo_YCbCrBiPlanar struct */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kCVPixelFormatType_420YpCbCr8BiPlanarFullRangeÂ  = &#x27;420f&#x27;, /* Bi-Planar Component Y&#x27;CbCr 8-bit 4:2:0, full-range (luma=[0,255] chroma=[1,255]).Â  baseAddr points to a big-endian CVPlanarPixelBufferInfo_YCbCrBiPlanar struct */</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Nv12 to i420</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-objective-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CVPixelBufferRef pixelBuffer = CMSampleBufferGetImageBuffer(sampleBuffer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CVPixelBufferLockBaseAddress(pixelBuffer, 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    //è·å¾—å¹³é¢æ•°</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int numberOfPlanes = (int)CVPixelBufferGetPlaneCount(pixelBuffer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert(numberOfPlanes == 2);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (numberOfPlanes != 2) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        CVPixelBufferUnlockBaseAddress(pixelBuffer, 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int width = (int)CVPixelBufferGetWidth(pixelBuffer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int height = (int)CVPixelBufferGetHeight(pixelBuffer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    void *src_y = CVPixelBufferGetBaseAddressOfPlane(pixelBuffer, 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    void *src_uv = CVPixelBufferGetBaseAddressOfPlane(pixelBuffer, 1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        //å†…å­˜å¯¹é½</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int src_stride_y = (int)CVPixelBufferGetBytesPerRowOfPlane(pixelBuffer, 0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int src_stride_uv = (int)CVPixelBufferGetBytesPerRowOfPlane(pixelBuffer, 1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    void *i420 = malloc(width * height * 2);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    void *dst_y = i420;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    void *dst_u = dst_y + width * height;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    void *dst_v = dst_u + width * height / 4;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int dst_stride_y = width;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int dst_stride_u = width / 2;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int dst_stride_v = width / 2;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    NV12ToI420(src_y, src_stride_y,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               src_uv, src_stride_uv,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               dst_y, dst_stride_y,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               dst_u, dst_stride_u,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               dst_v, dst_stride_v,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               width, height);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>æ·±å…¥ç†è§£ CVPixelBufferRef</strong>ï¼š<a href="https://zhuanlan.zhihu.com/p/24762605" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/24762605</a></p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="è·¨è·-stride"></a>è·¨è·-stride<a class="hash-link" href="#è·¨è·-stride" title="Direct link to heading">#</a></h6><p>è½¬ä¸€ä¸ªyuvçš„strideçŸ¥è¯†ï¼š<a href="https://www.jianshu.com/p/907896648310" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/907896648310</a></p><p>æˆ‘ä»¬éƒ½çŸ¥é“ç°åœ¨è®¡ç®—æœºçš„cpuéƒ½æ˜¯32ä½æˆ–è€…64ä½çš„cpuï¼Œä»–ä»¬ä¸€æ¬¡æœ€å°‘è¯»å–4ã€8ä¸ªå­—èŠ‚ï¼Œå¦‚æœå°‘äºè¿™äº›ï¼Œåè€Œè¦åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼Œä¼šèŠ±æ›´é•¿çš„æ—¶é—´ã€‚æ‰€æœ‰ä¼šæœ‰ä¸€ä¸ªæ¦‚å¿µå«åšå†…å­˜å¯¹é½ï¼Œå°†ç»“æ„ä½“çš„é•¿åº¦è®¾ä¸º4ã€8çš„å€æ•°ã€‚</p><p>è·¨è·å°±æ˜¯æŒ‡å›¾åƒä¸­çš„ä¸€è¡Œå›¾åƒæ•°æ®æ‰€å çš„å­˜å‚¨ç©ºé—´çš„é•¿åº¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤§äºç­‰äºå›¾åƒå®½åº¦çš„å†…å­˜å¯¹é½çš„é•¿åº¦ã€‚</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é‡‡é›†å‚è€ƒæ–‡æ¡£"></a>é‡‡é›†å‚è€ƒæ–‡æ¡£<a class="hash-link" href="#é‡‡é›†å‚è€ƒæ–‡æ¡£" title="Direct link to heading">#</a></h5><p><a href="https://objccn.io/issue-21-3/" target="_blank" rel="noopener noreferrer"><strong>iOS ä¸Šçš„ç›¸æœºæ•æ‰</strong></a></p><p>OCä¹‹AVCaptureDevice: <a href="https://www.jianshu.com/p/155efb36e041" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/155efb36e041</a></p><p>Activeformat: <a href="https://developer.apple.com/documentation/avfoundation/avcapturedevice/1387810-lockforconfiguration?language=objc" target="_blank" rel="noopener noreferrer">https://developer.apple.com/documentation/avfoundation/avcapturedevice/1387810-lockforconfiguration?language=objc</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é—®é¢˜"></a>é—®é¢˜<a class="hash-link" href="#é—®é¢˜" title="Direct link to heading">#</a></h2><p>æ›´æ–°capturesetting ä¼šå¯¼è‡´macç•Œé¢å¡é¡¿ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma mark - setter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- (void)setVideoConfig:(DbyCapturerConfig)videoConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _videoConfig = videoConfig;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dispatch_async(self.sessionQueue, ^{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        //è®¾ç½®åˆ†è¾¨ç‡å’Œå¸§ç‡</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [self.session beginConfiguration];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#if TARGET_OS_OSX</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        NSDictionary *settings = @{(NSString *)kCVPixelBufferPixelFormatTypeKey : @(kCVPixelFormatType_420YpCbCr8BiPlanarFullRange),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                   (NSString *)kCVPixelBufferWidthKey : @(self.videoConfig.dimension.width),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                   (NSString *)kCVPixelBufferHeightKey : @(self.videoConfig.dimension.height)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        self.videoOutput.videoSettings = settings;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#endif</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        NSInteger dstRate;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [RZVideoUtil setCaptureFrameRate:videoConfig.frameRate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                  dstSize:videoConfig.dimension</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                forDevice:self.currentDevice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          resultFrameRate:&amp;dstRate];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [self.session commitConfiguration];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æŠ¥é”™ä¿¡æ¯</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">2021-09-30 14:25:06.224700+0800 rzpaas_example_mac[32928:7429203] [] CMIOHardware.cpp:379:CMIOObjectGetPropertyData Error: 2003332927, failed</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="dys-typora-open://mine/survival/docs/éŸ³è§†é¢‘/Video/è§†é¢‘é‡‡é›†.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/éŸ³è§†é¢‘/Video/Video"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Video</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/éŸ³è§†é¢‘/Video/è§†é¢‘å­˜å‚¨"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">è§†é¢‘å­˜å‚¨ Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#é‡‡é›†ç®¡ç†" class="table-of-contents__link">é‡‡é›†ç®¡ç†</a><ul><li><a href="#avcapturesession" class="table-of-contents__link"><code>AVCaptureSession</code></a></li></ul></li><li><a href="#é‡‡é›†çš„è¾“å…¥" class="table-of-contents__link">é‡‡é›†çš„è¾“å…¥</a><ul><li><a href="#é‡‡é›†è®¾å¤‡--avcapturedevice" class="table-of-contents__link">é‡‡é›†è®¾å¤‡ <code> AVCaptureDevice</code></a></li><li><a href="#é‡‡é›†æ–¹å‘" class="table-of-contents__link">é‡‡é›†æ–¹å‘</a></li><li><a href="#æƒé™é—®é¢˜" class="table-of-contents__link">æƒé™é—®é¢˜</a></li><li><a href="#é‡‡é›†çš„è®¾ç½®" class="table-of-contents__link">é‡‡é›†çš„è®¾ç½®</a></li><li><a href="#cmtime" class="table-of-contents__link">CMTime</a></li></ul></li><li><a href="#é‡‡é›†çš„è¾“å‡º" class="table-of-contents__link">é‡‡é›†çš„è¾“å‡º</a><ul><li><a href="#è¾“å‡ºçš„æ ¼å¼" class="table-of-contents__link">è¾“å‡ºçš„æ ¼å¼</a></li><li><a href="#ä¿å­˜åˆ°æ–‡ä»¶" class="table-of-contents__link">ä¿å­˜åˆ°æ–‡ä»¶</a></li><li><a href="#æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯" class="table-of-contents__link">æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯</a></li></ul></li><li><a href="#é—®é¢˜" class="table-of-contents__link">é—®é¢˜</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.aaa24a49.js"></script>
<script src="/runtime~main.7eeb3d64.js"></script>
<script src="/main.7a041c89.js"></script>
<script src="/1.62b3ea65.js"></script>
<script src="/257.bb7ed37e.js"></script>
<script src="/258.ed1b30f8.js"></script>
<script src="/935f2afb.55f5968c.js"></script>
<script src="/256.a7530d90.js"></script>
<script src="/b961bef2.a1642402.js"></script>
</body>
</html>