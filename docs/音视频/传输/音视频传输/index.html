<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Blog Atom Feed"><title data-react-helmet="true">音视频传输 | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="音视频传输 | My Site"><meta data-react-helmet="true" name="description" content="音视频传输"><meta data-react-helmet="true" property="og:description" content="音视频传输"><meta data-react-helmet="true" property="og:url" content="http://localhost:9999//docs/音视频/传输/音视频传输"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://localhost:9999//docs/音视频/传输/音视频传输"><link rel="stylesheet" href="/styles.8cfbcdec.css">
<link rel="preload" href="/styles.1004da7c.js" as="script">
<link rel="preload" href="/runtime~main.74d3fe56.js" as="script">
<link rel="preload" href="/main.b81ad7fb.js" as="script">
<link rel="preload" href="/1.2fe752e0.js" as="script">
<link rel="preload" href="/259.96e24fb8.js" as="script">
<link rel="preload" href="/260.8c75c7b8.js" as="script">
<link rel="preload" href="/935f2afb.8492b0e9.js" as="script">
<link rel="preload" href="/258.d78093f4.js" as="script">
<link rel="preload" href="/88c2dc0a.17c7a58f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a><a class="navbar__item navbar__link" href="/docs/">基础</a><a class="navbar__item navbar__link" href="/docs/编程语言/编程语言">语言</a><a class="navbar__item navbar__link" href="/docs/工具/常用工具">工具</a><a class="navbar__item navbar__link" href="/docs/应用开发/应用开发">应用开发</a><a class="navbar__item navbar__link" href="/docs/Apple/iOS开发/iOS开发">Apple</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/音视频/音视频">音视频</a><a class="navbar__item navbar__link" href="/docs/项目/项目">项目</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">基础</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/编程语言/编程语言">语言</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/工具/常用工具">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/应用开发/应用开发">应用开发</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Apple/iOS开发/iOS开发">Apple</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/音视频/音视频">音视频</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/项目/项目">项目</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/音视频/音视频">音视频</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">音视频/音频</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Audio/Audio">Audio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Audio/音频采集">音频采集</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Audio/音频存储">音频存储</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Audio/音频处理">音频处理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Audio/音频编解码">音频编解码</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Audio/音频播放">音频播放</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">音视频/视频</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Video/Video">Video</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Video/视频采集">视频采集</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Video/视频存储">视频存储</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Video/视频处理">视频处理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Video/视频编解码">视频编解码</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/Video/视频渲染">视频渲染</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/音视频/同步/音视频同步">音视频同步</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/音视频/封装/音视频封装">音视频封装</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/音视频/传输/音视频传输">音视频传输</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/音视频/服务端/服务器">服务器</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">音视频/重要框架</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/学习资料/三方框架/FFMpeg/FFmpeg">FFmpeg</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/音视频/学习资料/三方框架/WebRTC/WebRTC">WebRTC</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">音视频传输</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="音视频传输"></a>音视频传输<a class="hash-link" href="#音视频传输" title="Direct link to heading">#</a></h1><p>[toc]</p><p>音视频数据通常以RTMP协议进行传输，这是一种专门针对音视频的协议，因为各种各样的视频数据无法统一，所以需要有一个标准作为传输规则，协议就起到这样的左右。</p><p>视频直播带宽的最强计算过程：<a href="https://zhuanlan.zhihu.com/p/136612952" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/136612952</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="srt协议"></a>SRT协议<a class="hash-link" href="#srt协议" title="Direct link to heading">#</a></h2><p><a href="https://zhuanlan.zhihu.com/p/114436399" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/114436399</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp-协议"></a>RTMP 协议<a class="hash-link" href="#rtmp-协议" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp连接建立"></a>RTMP连接建立<a class="hash-link" href="#rtmp连接建立" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="基本概念"></a>基本概念<a class="hash-link" href="#基本概念" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-22-1" src="/assets/images/2021-4-5-11-22-1-e783d6066a8656eecaf0ce1c1b44b58f.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="创建流的基本过程"></a>创建流的基本过程<a class="hash-link" href="#创建流的基本过程" title="Direct link to heading">#</a></h4><ol><li>socket建立TCP链接</li><li>RTMP握手</li><li>建立RTMP连接</li><li>创建RTMP流</li></ol><p><img alt="2021-4-5-11-22-22" src="/assets/images/2021-4-5-11-22-22-299e3ecdcc26fe60169b5bc21690729d.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="协议中的握手"></a>协议中的握手<a class="hash-link" href="#协议中的握手" title="Direct link to heading">#</a></h4><p> <img alt="2021-4-5-11-22-26" src="/assets/images/2021-4-5-11-22-26-5b189c4162b6e304e337e6739b3a2982.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="真实中的握手"></a>真实中的握手<a class="hash-link" href="#真实中的握手" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-22-57" src="/assets/images/2021-4-5-11-22-57-619b98f712657356b495fa7cdc72d741.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="协议中的建立连接"></a>协议中的建立连接<a class="hash-link" href="#协议中的建立连接" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-23-55" src="/assets/images/2021-4-5-11-23-55-75613b1d9cfd1a0327091151089c257f.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="真实中的建立连接"></a>真实中的建立连接<a class="hash-link" href="#真实中的建立连接" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-24-52" src="/assets/images/2021-4-5-11-24-52-fbdf51c9a3309d18a19523d69b7dfdad.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="创建rtmp流"></a>创建RTMP流<a class="hash-link" href="#创建rtmp流" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="协议中的创建rtmp流"></a>协议中的创建RTMP流<a class="hash-link" href="#协议中的创建rtmp流" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-29-52" src="/assets/images/2021-4-5-11-29-52-30129a38ce425957eb4f01e4bc0fd9a0.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="真实中的创建rtmp流"></a>真实中的创建RTMP流<a class="hash-link" href="#真实中的创建rtmp流" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-29-58" src="/assets/images/2021-4-5-11-29-58-b62cdd7be91f6d9e267c848eef71e9b2.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="推rtmp流"></a>推RTMP流<a class="hash-link" href="#推rtmp流" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-32-16" src="/assets/images/2021-4-5-11-32-16-81fe65d2b91cf0f55aa9989a555a6e6b.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="播rtmp流"></a>播RTMP流<a class="hash-link" href="#播rtmp流" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-33-20" src="/assets/images/2021-4-5-11-33-20-a44d8874f9d655722d8d5752f861388f.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="抓包展示"></a>抓包展示<a class="hash-link" href="#抓包展示" title="Direct link to heading">#</a></h4><p><img alt="image-20210405122742051" src="/assets/images/image-20210405122742051-641066c63e1ab67e425396694257b468.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp消息"></a>RTMP消息<a class="hash-link" href="#rtmp消息" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp消息格式"></a>RTMP消息格式<a class="hash-link" href="#rtmp消息格式" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-10-23-0" src="/assets/images/2021-4-5-10-23-0-a52f8de18e9f1fb05eb9505720707378.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp消息类型"></a>RTMP消息类型<a class="hash-link" href="#rtmp消息类型" title="Direct link to heading">#</a></h4><p><img alt="2021-4-5-11-0-18" src="/assets/images/2021-4-5-11-0-18-ca8e6a18eac3495729cb3b89b44d3ec1.png"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp命令消息"></a>RTMP命令消息<a class="hash-link" href="#rtmp命令消息" title="Direct link to heading">#</a></h5><p>抓包分析</p><p><code>20| Command Message| RTMP命令消息</code></p><p><img alt="image-20210405123514250" src="/assets/images/image-20210405123514250-939de1983e8e9923e5349fe40180ef78.png"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp控制消息"></a>RTMP控制消息<a class="hash-link" href="#rtmp控制消息" title="Direct link to heading">#</a></h5><p><img alt="image-20210405123707961" src="/assets/images/image-20210405123707961-5295a9add9d2fd0f58894e7d76e613dc.png"></p><p><img alt="image-20210405123919747" src="/assets/images/image-20210405123919747-241e9e9dcc8c2773501c1ec9c24d42d1.png"></p><p><img alt="image-20210405124139932" src="/assets/images/image-20210405124139932-e19afd4e70ea5c38ecabd64ccde6c034.png"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="音频数据0x08"></a>音频数据0x08<a class="hash-link" href="#音频数据0x08" title="Direct link to heading">#</a></h5><p><img alt="image-20210405124237869" src="/assets/images/image-20210405124237869-29af68ae2137da21e91290c9918b640c.png"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="视频消息0x09"></a>视频消息0x09<a class="hash-link" href="#视频消息0x09" title="Direct link to heading">#</a></h5><p><img alt="image-20210405124338651" src="/assets/images/image-20210405124338651-12f6df30f094be6db5bb7897b9d472dc.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="协议文档"></a>协议文档<a class="hash-link" href="#协议文档" title="Direct link to heading">#</a></h3><ul><li><a href="https://www.adobe.com/devnet/rtmp.html" target="_blank" rel="noopener noreferrer">https://www.adobe.com/devnet/rtmp.html</a></li></ul><p>协议文档： rtmp_specification_1.0.pdf</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="wireshark抓包"></a>Wireshark抓包<a class="hash-link" href="#wireshark抓包" title="Direct link to heading">#</a></h3><p>注意协议选择rtmpt。</p><p><img alt="image-20210405121106827" src="/assets/images/image-20210405121106827-db3f4e7502163f915c25015287c2aed7.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp-url"></a>RTMP URL<a class="hash-link" href="#rtmp-url" title="Direct link to heading">#</a></h3><p><img alt="2021-4-27-22-43-5" src="/assets/images/2021-4-27-22-43-5-091a2dea218ba784021da702f0d826fc.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp传输实现"></a>rtmp传输实现<a class="hash-link" href="#rtmp传输实现" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="客户端"></a>客户端<a class="hash-link" href="#客户端" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp-mac库"></a>rtmp-mac库<a class="hash-link" href="#rtmp-mac库" title="Direct link to heading">#</a></h4><p>对于学习来说，我们编一个最简单的rtmp 库就行，不需要带 openssl和zlib 。</p><ul><li>手动编译</li></ul><ol><li>下载库</li></ol><p>同步的是：<a href="http://git.ffmpeg.org/rtmpdump" target="_blank" rel="noopener noreferrer">http://git.ffmpeg.org/rtmpdump</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone git://git.ffmpeg.org/rtmpdump</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>备份的库在这里：<a href="https://gitee.com/dingyusong/rtmpdump" target="_blank" rel="noopener noreferrer">https://gitee.com/dingyusong/rtmpdump</a> </p><ol start="2"><li>修改源码</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rtmp.c:4459:26: error: use of undeclared identifier &#x27;INT_MAX&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (hlen &lt; 1 || hlen &gt; INT_MAX)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INT_MAX 需要引入：  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;limits.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">总共有3个文件都需要添加如下：</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">librtmp/dh.h:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  356  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  357:   if (!dh || !secret || nPubkeyLen &gt;= INT_MAX)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  358      return -1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">librtmp/hashswf.c:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  248     flen = strtol(sb.sb_start + sizeof(&quot;Content-Length: &quot;) - 1, NULL, 10);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  249:    if (flen &lt; 1 || flen &gt; INT_MAX)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  250     {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">librtmp/rtmp.c:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  4460    hlen = strtol(ptr+16, NULL, 10);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  4461:   if (hlen &lt; 1 || hlen &gt; INT_MAX)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  4462      return -1;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1.首先修改rtmp_sys.h文件。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">在文件中找到#ifdef _WIN32在其前面增加一句#define NO_CRYPTO，同时找到/* USE_OPENSSL */这个注释，修改为#elif defined(USE_OPENSSL) 或者直接注释掉#else的内容。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. 修改Makefile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Makefile 去掉 $(CRYPTO_LIB)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># LIBS=$(LIB_RTMP) $(CRYPTO_LIB) $(LIBS_$(SYS)) $(XLIBS)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LIBS=$(LIB_RTMP)  $(LIBS_$(SYS)) $(XLIBS)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="3"><li><p>编译</p><p>此处参考rtmpdump仓库里的readme。</p></li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Documents/Github/rtmpdump git:(master) ✗ make SYS=darwin XDEF=-DNO_SSL CRYPTO=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Documents/Github/rtmpdump git:(master) ✗ sudo make install SYS=darwin XDEF=-DNO_SSL CRYPTO= </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>使用CMake编译的RTMP：<a href="https://gitee.com/dingyusong/rtmpdump" target="_blank" rel="noopener noreferrer">https://gitee.com/dingyusong/rtmpdump</a></p><ul><li>注意：</li></ul><p>下面通过brew安装的rtmpdump 链接 查找 libssl 的时候会出错。至于能不能用还得在验证。</p><ul><li>mac可以直接用brew安装</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong brew search rtmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==&gt; Formulae</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rtmpdump ✔</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong brew install rtmpdump</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Updating Homebrew...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==&gt; Auto-updated Homebrew!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Updated 2 taps (homebrew/core and homebrew/cask).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==&gt; New Formulae</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gnupg@2.2                              lychee                                 revive                                 webhook</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==&gt; Updated Formulae</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Updated 89 formulae.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==&gt; New Casks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">menuwhere</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==&gt; Updated Casks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Updated 44 casks.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Warning: rtmpdump 2.4+20151223_1 is already installed and up-to-date.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">To reinstall 2.4+20151223_1, run:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  brew reinstall rtmpdump</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>pkg-config 可以找到librtmp的头文件克库文件的位置</li></ul><p>pc文件的位置： <code>/usr/local/lib/pkgconfig</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /usr/local/lib/pkgconfig pkg-config --libs --cflags librtmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Package libssl was not found in the pkg-config search path.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Perhaps you should add the directory containing `libssl.pc&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">to the PKG_CONFIG_PATH environment variable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Package &#x27;libssl&#x27;, required by &#x27;librtmp&#x27;, not found</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><p>rtmp依赖openssl所以需要安装openssl</p><p> libssl就是openssl 用brew安装。</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rtmp-ios库"></a>rtmp-ios库<a class="hash-link" href="#rtmp-ios库" title="Direct link to heading">#</a></h4><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="服务器"></a>服务器<a class="hash-link" href="#服务器" title="Direct link to heading">#</a></h3><p>nginx + rtmp module 组合</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="下载软件"></a>下载软件<a class="hash-link" href="#下载软件" title="Direct link to heading">#</a></h4><ul><li>家目录下新建一个安装文件夹</li></ul><p>下载nignx： wget <a href="http://nginx.org/download/nginx-1.19.9.tar.gz" target="_blank" rel="noopener noreferrer">http://nginx.org/download/nginx-1.19.9.tar.gz</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  ~ mkdir rtmp-install-dir</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  ~ cd rtmp-install-dir</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  rtmp-install-dir wget http://nginx.org/download/nginx-1.19.9.tar.gz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>下载rtmp-nginx</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone git@github.com:arut/nginx-rtmp-module.git</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><a href="https://github.com/arut/nginx-rtmp-module" target="_blank" rel="noopener noreferrer">https://github.com/arut/nginx-rtmp-module</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="安装软件"></a>安装软件<a class="hash-link" href="#安装软件" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 ./configure --add-module=../nginx-rtmp-module</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>需要安装gcc</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 ./configure --add-module=../nginx-rtmp-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for OS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> + Linux 5.8.0-50-generic x86_64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for C compiler ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./configure: error: C compiler cc is not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 sudo apt install gcc</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>缺少 pcre 需要安装</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">adding module in ../nginx-rtmp-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> + ngx_rtmp_module was configured</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for PCRE library ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for PCRE library in /usr/local/ ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for PCRE library in /usr/include/pcre/ ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for PCRE library in /usr/pkg/ ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for PCRE library in /opt/local/ ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./configure: error: the HTTP rewrite module requires the PCRE library.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">You can either disable the module by using --without-http_rewrite_module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">option, or install the PCRE library into the system, or build the PCRE library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><a href="https://ftp.pcre.org/pub/pcre/" target="_blank" rel="noopener noreferrer">https://ftp.pcre.org/pub/pcre/</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">wget https://ftp.pcre.org/pub/pcre/pcre2-10.36.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tar -zxvf pcre2-10.36.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./configure --add-module=../nginx-rtmp-module --with-pcre=../pcre2-10.36</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>缺少openssl 需要安装</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">configuring additional modules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">adding module in ../nginx-rtmp-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> + ngx_rtmp_module was configured</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for OpenSSL library ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for OpenSSL library in /usr/local/ ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for OpenSSL library in /usr/pkg/ ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for OpenSSL library in /opt/local/ ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./configure: error: SSL modules require the OpenSSL library.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">You can either do not enable the modules, or install the OpenSSL library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">into the system, or build the OpenSSL library statically from the source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with nginx by using --with-openssl=&lt;path&gt; option.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 sudo apt install libssl-dev</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>缺少zlib需要安装</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">adding module in ../nginx-rtmp-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> + ngx_rtmp_module was configured</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for OpenSSL library ... found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for zlib library ... not found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./configure: error: the HTTP gzip module requires the zlib library.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">You can either disable the module by using --without-http_gzip_module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">option, or install the zlib library into the system, or build the zlib library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">statically from the source with nginx by using --with-zlib=&lt;path&gt; option.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt install zlib1g-dev</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt install zlib1g （不行） 源码安装需要-dev为结尾的库。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>Makefile 生成成功</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./configure --add-module=../nginx-rtmp-module --with-pcre=../pcre2-10.36</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">configuring additional modules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">adding module in ../nginx-rtmp-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> + ngx_rtmp_module was configured</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for OpenSSL library ... found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checking for zlib library ... found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">creating objs/Makefile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Configuration summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + using PCRE library: ../pcre2-10.36</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + using system OpenSSL library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + using system zlib library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx path prefix: &quot;/usr/local/nginx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx modules path: &quot;/usr/local/nginx/modules&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx configuration prefix: &quot;/usr/local/nginx/conf&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx configuration file: &quot;/usr/local/nginx/conf/nginx.conf&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx pid file: &quot;/usr/local/nginx/logs/nginx.pid&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx error log file: &quot;/usr/local/nginx/logs/error.log&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx http access log file: &quot;/usr/local/nginx/logs/access.log&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx http client request body temporary files: &quot;client_body_temp&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx http proxy temporary files: &quot;proxy_temp&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx http scgi temporary files: &quot;scgi_temp&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 cat Makefile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">default:        build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">clean:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rm -rf Makefile objs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">.PHONY: default clean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">build:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $(MAKE) -f objs/Makefile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">install:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $(MAKE) -f objs/Makefile install</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">modules:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $(MAKE) -f objs/Makefile modules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">upgrade:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        /usr/local/nginx/sbin/nginx -t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        kill -USR2 `cat /usr/local/nginx/logs/nginx.pid`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sleep 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        test -f /usr/local/nginx/logs/nginx.pid.oldbin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">.PHONY: build install modules upgrade</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>安装</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 sudo make install</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo: make: command not found</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>缺少make</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt install make</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 sudo make</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make -f objs/Makefile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make[1]: Entering directory &#x27;/home/dys/rtmp-install-dir/nginx-1.19.9&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cc -c -pipe  -O -W -Wall -Wpointer-arith -Wno-unused-parameter -Werror -g  -I src/core -I src/event -I src/event/modules -I src/os/unix -I ../nginx-rtmp-module -I ../pcre2-10.36 -I objs \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -o objs/src/core/nginx.o \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        src/core/nginx.c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">In file included from src/core/ngx_core.h:73,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 from src/core/nginx.c:9:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">src/core/ngx_regex.h:15:10: fatal error: pcre.h: No such file or directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   15 | #include &lt;pcre.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      |          ^~~~~~~~</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">compilation terminated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make[1]: *** [objs/Makefile:447: objs/src/core/nginx.o] Error 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make[1]: Leaving directory &#x27;/home/dys/rtmp-install-dir/nginx-1.19.9&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make: *** [Makefile:10: build] Error 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 make clean</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>可以先把 pcre 的依赖去掉</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  nginx-1.19.9 ./configure --add-module=../nginx-rtmp-module --without-http_rewrite_module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Configuration summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + PCRE library is not used</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + using system OpenSSL library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + using system zlib library</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx path prefix: &quot;/usr/local/nginx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> sudo make install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="配置服务"></a>配置服务<a class="hash-link" href="#配置服务" title="Direct link to heading">#</a></h4><p>/usr/local/nginx/conf/nginx.conf</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># rtmp服务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rtmp {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    server {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        #指定服务端口号</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        listen 1935;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        chunk_size 4000;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        #指定流应用</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        application live</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                live on;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                allow play all;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="启动服务"></a>启动服务<a class="hash-link" href="#启动服务" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">~ sudo /usr/local/nginx/sbin/nginx -c ./conf/nginx.conf</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ffplay拉流播放"></a>ffplay拉流播放<a class="hash-link" href="#ffplay拉流播放" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong ffplay rtmp://192.168.1.107/live/room</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong ffplay rtmp://192.168.253.154/live/room</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ffmpeg推流"></a>ffmpeg推流<a class="hash-link" href="#ffmpeg推流" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  ffmpeg -i ~/Downloads/killler.mp4 -f flv rtmp://192.168.1.107/live/room</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  ffmpeg -i ~/Downloads/Welcome_to_Cpp.mp4 -f flv rtmp://192.168.253.154/live/room</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="flv"></a>FLV<a class="hash-link" href="#flv" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="flv协议"></a>FLV协议<a class="hash-link" href="#flv协议" title="Direct link to heading">#</a></h3><p>RTMP数据，在FLV 中添加一个头-Tag-header。RTMP数据就是Tag DATA。 然后在加一个9字节的FLV文件头。 这就是FLV协议。就类似于Http和tcp的关系。HTTP协议是基于tcp基础之上封装的。（协议就是约定，就是格式，就是特定的位置上的数据，有特定的含义，大家提前约定好，你发给我的数据我按照约定的格式解析，我发给你的数据也按照约定的数据发送，这样就能互相通信了）</p><p><img alt="2021-4-5-0-12-59" src="/assets/images/2021-4-5-0-12-59-8299c09fa6ddf1c16358036c88bc1cec.png"></p><p>直播协议 HTTP-FLV 详解：<a href="https://zhuanlan.zhihu.com/p/28722048" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/28722048</a></p><p>TT: Tag Type 类型</p><p>官方文档参考：<a href="http://download.macromedia.com/f4v/video_file_format_spec_v10_1.pdf" target="_blank" rel="noopener noreferrer">http://download.macromedia.com/f4v/video_file_format_spec_v10_1.pdf</a></p><p><img alt="preview" src="/assets/images/v2-bf301ba2d87829798cbf0ecde7c4063c_r-38e6aee77fad073b297bfd783a6250e4.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="flv协议分析器"></a>FLV协议分析器<a class="hash-link" href="#flv协议分析器" title="Direct link to heading">#</a></h3><ol><li>雷神的SpecialFFLV(windows)</li><li>Diffindo</li></ol><ul><li><a href="https://github.com/yinwenjie/Diffindo" target="_blank" rel="noopener noreferrer">https://github.com/yinwenjie/Diffindo</a></li><li><a href="https://gitee.com/dingyusong/Diffindo%EF%BC%88%E5%A4%87%E4%BB%BD%EF%BC%89" target="_blank" rel="noopener noreferrer">https://gitee.com/dingyusong/Diffindo（备份）</a></li></ul><p>Diffindo FLV Parser: 史上最强大的开源FLV视频分析工具</p><p>向这哥们学习：<a href="https://github.com/yinwenjie" target="_blank" rel="noopener noreferrer">https://github.com/yinwenjie</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/tools/Diffindo git:(master) ✗ tree -L 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── FLVParserLib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── LICENSE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── MP4ParserLib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── README.md</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└── gcc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── 1.flv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── FLVAccelerator.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── FLVExtractor.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── FLVParser.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── MP4Parser.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── ReadMe.md</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── flv_compile.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── gcc_flv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    └── mp4_compile.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6 directories, 10 files</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/tools/Diffindo/gcc/gcc_flv git:(master) ✗ ./FLVParser ../1.flv </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">***********************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">File Name: ../1.flv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">File Size: 7836546</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">***********************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">----------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FLV Version: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Video Flag: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Audio Flag: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Data offset: 9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">----------------------------------</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="大端模式小端模式"></a>大端模式/小端模式<a class="hash-link" href="#大端模式小端模式" title="Direct link to heading">#</a></h3><p>测试C程序：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdio.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> main </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;val = %d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 内存中的 0000 0001 0000 0000（1地址低，0地址高）</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 如果输出的是1代表本机是小端模式， 如果输出的是256代表的是大端模式。</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 小端模式，前端为小值，short（两字节） 存储低位在前面（左边）（char数组的第一个）所以是1 。  1000 0000 0000 0000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 大端模式，前端为大值，低位存储在右边，应该是 256.                                                                        0000 0001 0000 0000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 我的Mac输出的是1， 所以我的Mac存 char 1 是 1000 0000 是这样存的，小端模式，和我的数学思维是反过来的。切记，切记！</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="推流和拉流"></a>推流和拉流<a class="hash-link" href="#推流和拉流" title="Direct link to heading">#</a></h2><p>推流：将手机采集到的数据传给后台播放端。</p><p><img alt="20201117160562775986691.png" src="/assets/images/20201117160562775986691-0de75ccfe08d179219ac551333f48b5e.png"></p><p>拉流：将播放端传来的视频，放到手机上播放。</p><p><img alt="20201117160562778084102.png" src="/assets/images/20201117160562778084102-631cbe1dec5d193a995becdb834210ef.png"></p><p>推流和拉流为互逆过程。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="推流工具"></a>推流工具<a class="hash-link" href="#推流工具" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="obs"></a>OBS<a class="hash-link" href="#obs" title="Direct link to heading">#</a></h3><p><img alt="image-20210404175422514" src="/assets/images/image-20210404175422514-ce13c118b45d98f419e7f3512c5dfcf7.png"></p><p>服务器：rtmp://192.168.1.107/live</p><p>串流秘钥：room</p><p><a href="https://obsproject.com/download" target="_blank" rel="noopener noreferrer">https://obsproject.com/download</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="manycam推流"></a>ManyCam推流<a class="hash-link" href="#manycam推流" title="Direct link to heading">#</a></h3><p><img alt="image-20210425162040696" src="/assets/images/image-20210425162040696-23b0102c87b5b5ec92dc366b63db20ee.png"></p><p><img alt="image-20210425162102818" src="/assets/images/image-20210425162102818-dc971bdde55c5001d0eddac3269235bb.png"></p><p><img alt="image-20210425162120143" src="/assets/images/image-20210425162120143-60a658a48fd15880da0f6282e1f4c1f8.png"></p><p>服务器：rtmp://192.168.1.107/live</p><p>流密钥/串流秘钥：room</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ffmpeg推流-1"></a>ffmpeg推流<a class="hash-link" href="#ffmpeg推流-1" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  ffmpeg -i ~/Downloads/killler.mp4 -f flv rtmp://192.168.1.107/live/room</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="代码实现推流"></a>代码实现推流<a class="hash-link" href="#代码实现推流" title="Direct link to heading">#</a></h3><ol><li>解析flv文件</li><li>获取音视频数据</li><li>利用librtmp进行推流</li></ol><p>推流库：librtmp/ffmpeg 还有其他的推流库</p><p>librtmp的基本用法</p><ol><li>初始化RTMP对象</li><li>设置RTMP URL</li><li>连接流媒体服务器</li><li>发送数据包</li></ol><p>通过pkgconfig  查找到库所在的位置。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Documents/Github/ijkplayer git:(master) pkg-config --libs --cflags libavcodec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-I/usr/local/Cellar/ffmpeg/4.3.1_7/include -L/usr/local/Cellar/ffmpeg/4.3.1_7/lib -lavcodec</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>监控仅限于局域网的RTSP，转成公网传输的RTMP。</p><p><a href="http://rtmpdump.mplayerhq.hu/" target="_blank" rel="noopener noreferrer">http://rtmpdump.mplayerhq.hu/</a></p><p><a href="http://rtmpdump.mplayerhq.hu/download/" target="_blank" rel="noopener noreferrer">http://rtmpdump.mplayerhq.hu/download/</a></p><p><a href="https://github.com/ossrs/srs-librtmp" target="_blank" rel="noopener noreferrer">https://github.com/ossrs/srs-librtmp</a> （优化版）</p><p><a href="https://github.com/ossrs/librtmp" target="_blank" rel="noopener noreferrer">https://github.com/ossrs/librtmp</a> （镜像版）</p><p><a href="https://github.com/ossrs/srs/wiki/v2_CN_SrsLibrtmp" target="_blank" rel="noopener noreferrer">https://github.com/ossrs/srs/wiki/v2_CN_SrsLibrtmp</a></p><p>srs-librtmp Examples：提供的有demo可以参考。</p><p>参考demo：<a href="https://gitee.com/leixiaohua1020/simplest_librtmp_example" target="_blank" rel="noopener noreferrer">https://gitee.com/leixiaohua1020/simplest_librtmp_example</a></p><p> srs-librtmp 是对 ffmpeg 出的 rtmpdump 的进一步优化。</p><p>Librtmp的编译：</p><p>参考：librtmp免openssl和zlib单独编译：<a href="https://blog.csdn.net/fteworld/article/details/51171731" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/fteworld/article/details/51171731</a></p><p>入门使用可以编译不带openssl和zlib 库的版本。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> 1、首先修改rtmp_sys.h文件。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     在文件中找到#ifdef _WIN32在其前面增加一句#define NO_CRYPTO，同时找到/* USE_OPENSSL */这个注释，修改为#elif defined(USE_OPENSSL) 或者直接注释掉#else的内容。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">————————————————</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">版权声明：本文为CSDN博主「我的小鱼你醒了」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">原文链接：https://blog.csdn.net/fteworld/article/details/51171731</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Documents/Github/rtmpdump git:(master) ✗ make SYS=darwin XDEF=-DNO_SSL CRYPTO=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Documents/Github/rtmpdump git:(master) ✗ sudo make install SYS=darwin XDEF=-DNO_SSL CRYPTO= </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Password:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make[1]: Nothing to be done for `all&#x27;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir -p /usr/local/bin /usr/local/sbin /usr/local/man/man1 /usr/local/man/man8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp rtmpdump /usr/local/bin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp rtmpgw rtmpsrv rtmpsuck /usr/local/sbin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp rtmpdump.1 /usr/local/man/man1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp rtmpgw.8 /usr/local/man/man8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sed -e &quot;s;@prefix@;/usr/local;&quot; -e &quot;s;@libdir@;/usr/local/lib;&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                -e &quot;s;@VERSION@;v2.4;&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                -e &quot;s;@CRYPTO_REQ@;;&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                -e &quot;s;@PUBLIC_LIBS@;;&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                -e &quot;s;@PRIVATE_LIBS@;;&quot; librtmp.pc.in &gt; librtmp.pc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir -p /usr/local/include/librtmp /usr/local/lib/pkgconfig /usr/local/man/man3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp amf.h http.h log.h rtmp.h /usr/local/include/librtmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp librtmp.a /usr/local/lib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp librtmp.pc /usr/local/lib/pkgconfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp librtmp.3 /usr/local/man/man3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir -p /usr/local/lib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp librtmp.1.dylib /usr/local/lib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd /usr/local/lib; ln -sf librtmp.1.dylib librtmp.dylib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Documents/Github/rtmpdump git:(master) ✗ pkg-config --libs --cflags librtmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-I/usr/local/include -L/usr/local/lib -lrtmp -lz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="brew-安装rtmp"></a>brew 安装rtmp<a class="hash-link" href="#brew-安装rtmp" title="Direct link to heading">#</a></h3><p>用brew search rtmp也能找到。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong/Documents/Github/rtmpdump git:(master) ✗ brew search rtmp   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==&gt; Formulae</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rtmpdump ✔</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>在这之前brew install openssl</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">brew install openssl</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">brew install rtmpdump</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="image-20210404215853798" src="/assets/images/image-20210404215853798-390b878d64490f030928a4f381a648f1.png"></p><p>头文件是System Header Search Path</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="拉流工具"></a>拉流工具<a class="hash-link" href="#拉流工具" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ijkplayer"></a>ijkplayer<a class="hash-link" href="#ijkplayer" title="Direct link to heading">#</a></h3><p>B栈的ijkplayer</p><p><a href="https://github.com/Bilibili/ijkplayer" target="_blank" rel="noopener noreferrer">https://github.com/Bilibili/ijkplayer</a></p><ul><li><a href="https://www.cnblogs.com/renhui/p/6420140.html" target="_blank" rel="noopener noreferrer">开源播放器 ijkplayer (一) ：使用Ijkplayer播放直播视频</a>） </li></ul><p>ijkplayer接入使用：<a href="https://www.jianshu.com/p/a57bbdd78798" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/a57bbdd78798</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="vlc"></a>VLC<a class="hash-link" href="#vlc" title="Direct link to heading">#</a></h3><p><a href="https://www.videolan.org/" target="_blank" rel="noopener noreferrer">https://www.videolan.org/</a></p><p><img alt="image-20210404173332427" src="/assets/images/image-20210404173332427-75d041a526332bd4df9d7db6cfa152df.png"></p><p><img alt="image-20210404173311457" src="/assets/images/image-20210404173311457-ff154c72bcc53e8103767bf368a09bbb.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ffplayer"></a>ffplayer<a class="hash-link" href="#ffplayer" title="Direct link to heading">#</a></h3><p>ffplay拉流播放</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">➜  /Users/dingyusong ffplay rtmp://192.168.1.107/live/room</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hls-协议"></a>HLS 协议<a class="hash-link" href="#hls-协议" title="Direct link to heading">#</a></h4><p><a href="https://baike.baidu.com/item/HLS/8328931" target="_blank" rel="noopener noreferrer">https://baike.baidu.com/item/HLS/8328931</a></p><p>未来趋势：依赖于UDP的其他协议</p><p><strong>实时消息协议</strong>（英语：Real-Time Messaging Protocol，缩写<strong>RTMP</strong>）也称<strong>实时消息传输协议</strong>，是最初由<a href="https://zh.wikipedia.org/wiki/Macromedia" target="_blank" rel="noopener noreferrer">Macromedia</a>为通过<a href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91" target="_blank" rel="noopener noreferrer">互联网</a>在<a href="https://zh.wikipedia.org/wiki/Adobe_Flash" target="_blank" rel="noopener noreferrer">Flash播放器</a>与一个<a href="https://zh.wikipedia.org/wiki/%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener noreferrer">服务器</a>之间传输<a href="https://zh.wikipedia.org/wiki/%E6%B5%81%E5%AA%92%E4%BD%93" target="_blank" rel="noopener noreferrer">流媒体</a><a href="https://zh.wikipedia.org/wiki/%E9%9F%B3%E9%A2%91" target="_blank" rel="noopener noreferrer">音频</a>、<a href="https://zh.wikipedia.org/wiki/%E8%A7%86%E9%A2%91" target="_blank" rel="noopener noreferrer">视频</a>和数据而开发的一个<a href="https://zh.wikipedia.org/w/index.php?title=%E4%B8%93%E6%9C%89%E5%8D%8F%E8%AE%AE&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">专有协议</a>。Macromedia后被<a href="https://zh.wikipedia.org/wiki/Adobe_Systems" target="_blank" rel="noopener noreferrer">Adobe Systems</a>收购，该协议也已发布了不完整的规范供公众使用。</p><p>RTMP协议有许多变种：</p><ol><li>默认使用TCP端口1935的纯粹（plain）协议。</li><li><strong>RTMPS</strong>，通过一个<a href="https://zh.wikipedia.org/wiki/%E5%82%B3%E8%BC%B8%E5%B1%A4%E5%AE%89%E5%85%A8%E6%80%A7%E5%8D%94%E5%AE%9A" target="_blank" rel="noopener noreferrer">TLS/SSL</a>连接传输RTMP。</li><li><strong>RTMPE</strong>，使用Adobe自有安全机制加密的RTMP。虽然实现的细节为专有，但该机制使用行业标准的<a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A0%81%E5%AD%A6" target="_blank" rel="noopener noreferrer">密码学</a>原函数。[<a href="https://zh.wikipedia.org/wiki/%E5%AE%9E%E6%97%B6%E6%B6%88%E6%81%AF%E5%8D%8F%E8%AE%AE#cite_note-RTMPE_overview-1" target="_blank" rel="noopener noreferrer">1]</a></li><li><strong>RTMPT</strong>，用<a href="https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener noreferrer">HTTP</a><a href="https://zh.wikipedia.org/wiki/%E5%B0%81%E8%A3%9D_(%E7%B6%B2%E8%B7%AF)" target="_blank" rel="noopener noreferrer">封装</a>以穿透防火墙。RTMPT通常在<a href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener noreferrer">TCP</a><a href="https://zh.wikipedia.org/wiki/%E9%80%9A%E8%A8%8A%E5%9F%A0" target="_blank" rel="noopener noreferrer">端口</a>80和443上使用明文请求来绕过大多数的公司流量过滤。封装的会话中可能携带纯粹的RTMP、RTMPS或RTMPE数据包。</li><li><strong>RTMFP</strong>, 使用<a href="https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener noreferrer">UDP</a>而非TCP的RTMP，取代RTMP Chunk Stream。Adobe Systems开发了安全的<a href="https://zh.wikipedia.org/w/index.php?title=%E5%AE%9E%E6%97%B6%E5%AA%92%E4%BD%93%E6%B5%81%E5%8D%8F%E8%AE%AE&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">实时媒体流协议</a>包，可以让最终用户直接地相互连接（P2P）。</li></ol><p>虽然RTMP的主要动机是成为一个播放Flash视频的协议，但它也用于其他一些应用程序，如<a href="https://zh.wikipedia.org/w/index.php?title=Adobe_LiveCycle_Data_Services_ES&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">Adobe LiveCycle Data Services ES</a>。</p><p><a href="https://cn.ubuntu.com/download" target="_blank" rel="noopener noreferrer">https://cn.ubuntu.com/download</a></p><p>抓包：</p><p><a href="https://www.wireshark.org/#download" target="_blank" rel="noopener noreferrer">https://www.wireshark.org/#download</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="解决方案"></a>解决方案<a class="hash-link" href="#解决方案" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="srs"></a>SRS<a class="hash-link" href="#srs" title="Direct link to heading">#</a></h3><p>SRS/3.0，OuXuli，是一个简单高效的实时视频服务器，支持RTMP/WebRTC/HLS/HTTP-FLV/SRT/GB28181。</p><p><a href="https://github.com/ossrs/srs" target="_blank" rel="noopener noreferrer">https://github.com/ossrs/srs</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hls--协议"></a>HLS  协议<a class="hash-link" href="#hls--协议" title="Direct link to heading">#</a></h2><p><strong>HTTP Live Streaming</strong>，缩写为<strong>HLS</strong>，是由<a href="https://zh.wikipedia.org/wiki/%E8%8B%B9%E6%9E%9C%E5%85%AC%E5%8F%B8" target="_blank" rel="noopener noreferrer">苹果公司</a>提出基于<a href="https://zh.wikipedia.org/wiki/HTTP" target="_blank" rel="noopener noreferrer">HTTP</a>的<a href="https://zh.wikipedia.org/wiki/%E6%B5%81%E5%AA%92%E4%BD%93" target="_blank" rel="noopener noreferrer">流媒体</a><a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener noreferrer">网络传输协议</a>。是苹果公司<a href="https://zh.wikipedia.org/w/index.php?title=QuickTime_X&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">QuickTime X</a>和<a href="https://zh.wikipedia.org/wiki/IPhone" target="_blank" rel="noopener noreferrer">iPhone</a>软件系统的一部分。它的工作原理是把整个流分成一个个小的基于HTTP的文件来下载，每次只下载一些。当媒体流正在播放时，客户端可以选择从许多不同的备用源中以不同的速率下载同样的资源，允许流媒体会话适应不同的数据速率。在开始一个流媒体会话时，客户端会下载一个包含元数据的<a href="https://zh.wikipedia.org/wiki/M3U" target="_blank" rel="noopener noreferrer">扩展 M3U (m3u8)</a> 播放列表文件，用于寻找可用的媒体流。</p><p>HLS只请求基本的HTTP报文，与<a href="https://zh.wikipedia.org/wiki/%E5%AE%9E%E6%97%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener noreferrer">实时传输协议（RTP）</a>不同，HLS可以穿过任何允许HTTP数据通过的<a href="https://zh.wikipedia.org/wiki/%E9%98%B2%E7%81%AB%E5%A2%99" target="_blank" rel="noopener noreferrer">防火墙</a>或者<a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener noreferrer">代理服务器</a>。它也很容易使用<a href="https://zh.wikipedia.org/wiki/%E5%85%A7%E5%AE%B9%E5%88%86%E7%99%BC%E7%B6%B2%E7%B5%A1" target="_blank" rel="noopener noreferrer">内容分发网络</a>来传输媒体流。</p><p>苹果公司把HLS协议作为一个<a href="https://zh.wikipedia.org/w/index.php?title=Internet-Draft&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">互联网草案</a>（逐步提交），在第一阶段中已作为一个非正式的标准提交到<a href="https://zh.wikipedia.org/wiki/IETF" target="_blank" rel="noopener noreferrer">IETF</a>。2017年8月，RFC 8216发布，描述了HLS协议第7版的定义。</p><p><a href="https://zh.wikipedia.org/wiki/HTTP_Live_Streaming" target="_blank" rel="noopener noreferrer">https://zh.wikipedia.org/wiki/HTTP_Live_Streaming</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="dys-typora-open://mine/survival/docs/音视频/传输/音视频传输.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/音视频/封装/音视频封装"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 音视频封装</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/音视频/服务端/服务器"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">服务器 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#srt协议" class="table-of-contents__link">SRT协议</a></li><li><a href="#rtmp-协议" class="table-of-contents__link">RTMP 协议</a><ul><li><a href="#rtmp连接建立" class="table-of-contents__link">RTMP连接建立</a></li><li><a href="#创建rtmp流" class="table-of-contents__link">创建RTMP流</a></li><li><a href="#rtmp消息" class="table-of-contents__link">RTMP消息</a></li><li><a href="#协议文档" class="table-of-contents__link">协议文档</a></li><li><a href="#wireshark抓包" class="table-of-contents__link">Wireshark抓包</a></li><li><a href="#rtmp-url" class="table-of-contents__link">RTMP URL</a></li></ul></li><li><a href="#rtmp传输实现" class="table-of-contents__link">rtmp传输实现</a><ul><li><a href="#客户端" class="table-of-contents__link">客户端</a></li><li><a href="#服务器" class="table-of-contents__link">服务器</a></li></ul></li><li><a href="#flv" class="table-of-contents__link">FLV</a><ul><li><a href="#flv协议" class="table-of-contents__link">FLV协议</a></li><li><a href="#flv协议分析器" class="table-of-contents__link">FLV协议分析器</a></li><li><a href="#大端模式小端模式" class="table-of-contents__link">大端模式/小端模式</a></li></ul></li><li><a href="#推流和拉流" class="table-of-contents__link">推流和拉流</a></li><li><a href="#推流工具" class="table-of-contents__link">推流工具</a><ul><li><a href="#obs" class="table-of-contents__link">OBS</a></li><li><a href="#manycam推流" class="table-of-contents__link">ManyCam推流</a></li><li><a href="#ffmpeg推流-1" class="table-of-contents__link">ffmpeg推流</a></li><li><a href="#代码实现推流" class="table-of-contents__link">代码实现推流</a></li><li><a href="#brew-安装rtmp" class="table-of-contents__link">brew 安装rtmp</a></li></ul></li><li><a href="#拉流工具" class="table-of-contents__link">拉流工具</a><ul><li><a href="#ijkplayer" class="table-of-contents__link">ijkplayer</a></li><li><a href="#vlc" class="table-of-contents__link">VLC</a></li><li><a href="#ffplayer" class="table-of-contents__link">ffplayer</a></li></ul></li><li><a href="#解决方案" class="table-of-contents__link">解决方案</a><ul><li><a href="#srs" class="table-of-contents__link">SRS</a></li></ul></li><li><a href="#hls--协议" class="table-of-contents__link">HLS  协议</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.1004da7c.js"></script>
<script src="/runtime~main.74d3fe56.js"></script>
<script src="/main.b81ad7fb.js"></script>
<script src="/1.2fe752e0.js"></script>
<script src="/259.96e24fb8.js"></script>
<script src="/260.8c75c7b8.js"></script>
<script src="/935f2afb.8492b0e9.js"></script>
<script src="/258.d78093f4.js"></script>
<script src="/88c2dc0a.17c7a58f.js"></script>
</body>
</html>