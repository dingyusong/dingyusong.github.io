(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{1021:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/image-20211011175217639-ad29d4a366b713f5f1d1b2c7466f7a28.png"},1022:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/image-20211011175346803-9d9857b49567649338d2314b53a5ff6a.png"},1023:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/image-20211011180026200-9743b5f9fcfb98166b1fa5571905921d.png"},1024:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/image-20211011175153939-8fb9e778879751537d2eaaa1f373a82c.png"},1025:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/image-20211015101549519-4fa6c295a52bac807cc2366bf0affd44.png"},1026:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/image-20211015101644003-06386eacd86256fa858fbd24c92fa844.png"},314:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return _})),a.d(t,"metadata",(function(){return d})),a.d(t,"toc",(function(){return s})),a.d(t,"default",(function(){return l}));var r=a(3),n=a(7),c=(a(0),a(329)),o=["components"],_={},d={unversionedId:"Apple/\u5d29\u6e83\u5206\u6790/\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801",id:"Apple/\u5d29\u6e83\u5206\u6790/\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801",isDocsHomePage:!1,title:"\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801",description:"\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801",source:"@site/docs/Apple/\u5d29\u6e83\u5206\u6790/\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801.md",slug:"/Apple/\u5d29\u6e83\u5206\u6790/\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801",permalink:"/docs/Apple/\u5d29\u6e83\u5206\u6790/\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801",editUrl:"dys-typora-open://mine/survival/docs/Apple/\u5d29\u6e83\u5206\u6790/\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801.md",version:"current"},s=[{value:"thread_worker\u662f\u4ec0\u4e48\uff1f",id:"thread_worker\u662f\u4ec0\u4e48\uff1f",children:[]},{value:"\u6709\u7b26\u53f7\u5c31\u4ece\u4e8c\u8fdb\u5236\u67e5\u8d77",id:"\u6709\u7b26\u53f7\u5c31\u4ece\u4e8c\u8fdb\u5236\u67e5\u8d77",children:[{value:"hopper disassembler",id:"hopper-disassembler",children:[]},{value:"\u4ee3\u7801\u6ca1\u6709\u5c31\u4ece\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u627e",id:"\u4ee3\u7801\u6ca1\u6709\u5c31\u4ece\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u627e",children:[]},{value:"\u67e5\u770blibavutil\u6e90\u7801",id:"\u67e5\u770blibavutil\u6e90\u7801",children:[]},{value:"\u7ed9\u4e0a\u7ea7\u51fd\u6570\u6253\u65ad\u70b9",id:"\u7ed9\u4e0a\u7ea7\u51fd\u6570\u6253\u65ad\u70b9",children:[]},{value:"\u6e90\u7801\u4e2d\u5b9a\u4f4d",id:"\u6e90\u7801\u4e2d\u5b9a\u4f4d",children:[]}]},{value:"bcsymbolmap",id:"bcsymbolmap",children:[]}],i={toc:s};function l(e){var t=e.components,_=Object(n.a)(e,o);return Object(c.b)("wrapper",Object(r.a)({},i,_,{components:t,mdxType:"MDXLayout"}),Object(c.b)("h1",{id:"\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801"},"\u6839\u636e\u7ebf\u7a0b\u6808\u67e5\u627e\u5bf9\u5e94\u4ee3\u7801"),Object(c.b)("p",null,Object(c.b)("img",{alt:"image-20211011175217639",src:a(1021).default})),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},'(lldb) bt\n* thread #25, stop reason = breakpoint 2.1\n  * frame #0: 0x0000000107664dc0 RZPaas_macOS`avpriv_slicethread_create\n    frame #1: 0x0000000106e16acd RZPaas_macOS`ff_slice_thread_init + 237\n    frame #2: 0x0000000106f1e322 RZPaas_macOS`avcodec_open2 + 2354\n    frame #3: 0x000000010640fd8a RZPaas_macOS`DuoBei::FFmpegContext::InitFFmpeg(this=0x0000600000620b20, config=0x0000700002b96960) at FFmpegContext.cpp:160:9\n    frame #4: 0x0000000106412c47 RZPaas_macOS`DuoBei::H264Codec::Init(this=0x0000600000620b20, config=0x0000700002b96960) at H264Codec.cpp:47:5\n    frame #5: 0x00000001064e3820 RZPaas_macOS`rz::DefaultVideoDecoder::RealInit(this=0x0000600001a42e60) at DefaultVideoDecoder.cpp:89:25\n    frame #6: 0x00000001064e3551 RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:14:19\n    frame #7: 0x00000001064e392d RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:12:45\n    frame #8: 0x00000001064e0274 RZPaas_macOS`rz::DefaultVideoCodecProducer::GetDecoder(this=0x000060000331c5b0, eventHandler=0x00007fc175e9d350) at DefaultVideoCodecProducer.cpp:21:45\n    frame #9: 0x000000010668fb2d RZPaas_macOS`rz::StructureFactory::createVideoDecoder(type=VIDEO_CODEC_SOFT_H264, handler=0x00007fc175e9d350) at StructureFactory.cpp:427:65\n    frame #10: 0x0000000106471d15 RZPaas_macOS`rz::VideoDecodecManage::createDecoder(this=0x00007fc175e9d350) at VideoCodecManage.cpp:296:19\n    frame #11: 0x0000000106471af5 RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:167:11\n    frame #12: 0x0000000106471e3b RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:163:37\n    frame #13: 0x0000000106472a62 RZPaas_macOS`rz::VideoCodecManageProducer::GetDecoder(this=0x000060000331c670, streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:325:16\n    frame #14: 0x0000000106690981 RZPaas_macOS`rz::StructureFactory::createVideoDecoderManage(streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at StructureFactory.cpp:518:35\n    frame #15: 0x00000001063c2d8f RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:46:17\n    frame #16: 0x00000001063c3a9d RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:13:26\n    frame #17: 0x0000000106691920 RZPaas_macOS`rz::StructureFactory::createSubVideoStream(stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830, fun=function<void ()> @ 0x0000700002b97570)>) at StructureFactory.cpp:621:20\n    frame #18: 0x0000000106596762 RZPaas_macOS`rz::RtcEngineBase::createSubVideoStreamInfo(streamCtx=std::__1::shared_ptr<rz::RemoteVideoStreamContext>::element_type @ 0x00007fc175c366c8 strong=2 weak=1, channelCtx=std::__1::shared_ptr<rz::IRtcChannelContext>::element_type @ 0x00007fc175c81388 strong=2 weak=1, mediaStreamType=MEDIA_STREAM_SUPPORTED, sync=0x0000600000058b40) at RtcEngineBase.cpp:500:13\n    frame #19: 0x00000001066398b1 RZPaas_macOS`rz::RtcEngineBase::onRemoteVideoStreamOnline(this=0x0000600001563788)::$_70::operator()() const at RtcEngineBase.cpp:2035:13\n    frame #20: 0x000000010663817d RZPaas_macOS`decltype(__f=0x0000600001563788)::$_70&>(fp)()) std::__1::__invoke<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70&>(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70&) at type_traits:3747:1\n    frame #21: 0x000000010663812d RZPaas_macOS`void std::__1::__invoke_void_return_wrapper<void>::__call<rz::RtcEngineBase::onRemoteVideoStreamOnline(__args=0x0000600001563788)::$_70&>(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70&) at __functional_base:348:9\n    frame #22: 0x00000001066380fd RZPaas_macOS`std::__1::__function::__alloc_func<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70, std::__1::allocator<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70>, void ()>::operator(this=0x0000600001563788)() at functional:1553:16\n    frame #23: 0x0000000106636d49 RZPaas_macOS`std::__1::__function::__func<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70, std::__1::allocator<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70>, void ()>::operator(this=0x0000600001563780)() at functional:1727:12\n    frame #24: 0x0000000106081c62 RZPaas_macOS`std::__1::__function::__value_func<void ()>::operator(this=0x0000700002b97eb0)() const at functional:1880:16\n    frame #25: 0x000000010607f445 RZPaas_macOS`std::__1::function<void ()>::operator(this=0x0000700002b97eb0)() const at functional:2555:12\n    frame #26: 0x000000010637547b RZPaas_macOS`rz::InteractiveManage::workFun() at InteractiveManage.cpp:44:21\n    frame #27: 0x0000000106083367 RZPaas_macOS`decltype(__f=(0x00006000033193e8))()>(fp)()) std::__1::__invoke<void (*)()>(void (*&&)()) at type_traits:3747:1\n    frame #28: 0x00000001060832d5 RZPaas_macOS`void std::__1::__thread_execute<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void (*)()>(__t=size=2, (null)=__tuple_indices<> @ 0x0000700002b97f58)()>&, std::__1::__tuple_indices<>) at thread:280:5\n    frame #29: 0x0000000106082b2f RZPaas_macOS`void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void (*)()> >(__vp=0x00006000033193e0) at thread:291:5\n    frame #30: 0x000000010b92e1b8 libsystem_pthread.dylib`_pthread_start + 224\n    frame #31: 0x000000010b929af7 libsystem_pthread.dylib`thread_start + 15\n(lldb) \n')),Object(c.b)("h2",{id:"thread_worker\u662f\u4ec0\u4e48\uff1f"},"thread_worker\u662f\u4ec0\u4e48\uff1f"),Object(c.b)("p",null,"thread_worker"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"(lldb) bt\n* thread #177, stop reason = breakpoint 1.1\n  * frame #0: 0x0000000107664ff0 RZPaas_macOS`thread_worker\n    frame #1: 0x000000010b92e1b8 libsystem_pthread.dylib`_pthread_start + 224\n    frame #2: 0x000000010b929af7 libsystem_pthread.dylib`thread_start + 15\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"image-20211011175346803",src:a(1022).default})),Object(c.b)("p",null,"\u6e90\u7801\u91cc\u9762\u641c\u4e0d\u5230thread_worker \u4f46\u662f\u7b26\u53f7\u8868\u91cc\u641c\u51fa\u4e86_thread_worker\u3002\u663e\u7136\u662f\u4e2ac\u65b9\u6cd5\uff0c\u800c\u4e14\u662f\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u91cc\u9762\u7684\u3002"),Object(c.b)("p",null,Object(c.b)("img",{alt:"image-20211011180026200",src:a(1023).default})),Object(c.b)("h2",{id:"\u6709\u7b26\u53f7\u5c31\u4ece\u4e8c\u8fdb\u5236\u67e5\u8d77"},"\u6709\u7b26\u53f7\u5c31\u4ece\u4e8c\u8fdb\u5236\u67e5\u8d77"),Object(c.b)("h3",{id:"hopper-disassembler"},"hopper disassembler"),Object(c.b)("p",null,Object(c.b)("img",{alt:"image-20211011175153939",src:a(1024).default})),Object(c.b)("h3",{id:"\u4ee3\u7801\u6ca1\u6709\u5c31\u4ece\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u627e"},"\u4ee3\u7801\u6ca1\u6709\u5c31\u4ece\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u627e"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"\n\u279c  Mac git:(develop) nm -a RunTimeDemo | grep thread_worker\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/nm: error: RunTimeDemo: No such file or directory.\n\u279c  Mac git:(develop) nm -a libavcodec.a | grep thread_worker\n\u279c  Mac git:(develop) nm -a libabsl_bad_optional_access.a | grep thread_worker\n\u279c  Mac git:(develop) nm -a libavdevice.a | grep thread_worker\n\u279c  Mac git:(develop) nm -a libavfilter.a | grep thread_worker\n\u279c  Mac git:(develop) nm -a libavformat.a | grep thread_worker\n\u279c  Mac git:(develop) nm -a libavutil.a | grep thread_worker\n---------------- t _thread_worker\n\u279c  Mac git:(develop)\n\n\n")),Object(c.b)("p",null,"\u627e\u5230\u4e86\uff0c\u5728libavutil\u91cc\u9762"),Object(c.b)("h3",{id:"\u67e5\u770blibavutil\u6e90\u7801"},"\u67e5\u770blibavutil\u6e90\u7801"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"libavutil/slicethread.c\n\nstatic void *attribute_align_arg thread_worker(void *v)\n{\n    WorkerContext *w = v;\n    AVSliceThread *ctx = w->ctx;\n\n    pthread_mutex_lock(&w->mutex);\n    pthread_cond_signal(&w->cond);\n\n    while (1) {\n        w->done = 1;\n        while (w->done)\n            pthread_cond_wait(&w->cond, &w->mutex);\n\n        if (ctx->finished) {\n            pthread_mutex_unlock(&w->mutex);\n            return NULL;\n        }\n\n        if (run_jobs(ctx)) {\n            pthread_mutex_lock(&ctx->done_mutex);\n            ctx->done = 1;\n            pthread_cond_signal(&ctx->done_cond);\n            pthread_mutex_unlock(&ctx->done_mutex);\n        }\n    }\n}\n\n\n\nint avpriv_slicethread_create(AVSliceThread **pctx, void *priv,\n                              void (*worker_func)(void *priv, int jobnr, int threadnr, int nb_jobs, int nb_threads),\n                              void (*main_func)(void *priv),\n                              int nb_threads)\n{\n    AVSliceThread *ctx;\n    int nb_workers, i;\n\n    av_assert0(nb_threads >= 0);\n    if (!nb_threads) {\n        int nb_cpus = av_cpu_count();\n        if (nb_cpus > 1)\n            nb_threads = nb_cpus + 1;\n        else\n            nb_threads = 1;\n    }\n\n    nb_workers = nb_threads;\n    if (!main_func)\n        nb_workers--;\n\n    *pctx = ctx = av_mallocz(sizeof(*ctx));\n    if (!ctx)\n        return AVERROR(ENOMEM);\n\n    if (nb_workers && !(ctx->workers = av_calloc(nb_workers, sizeof(*ctx->workers)))) {\n        av_freep(pctx);\n        return AVERROR(ENOMEM);\n    }\n\n    ctx->priv        = priv;\n    ctx->worker_func = worker_func;\n    ctx->main_func   = main_func;\n    ctx->nb_threads  = nb_threads;\n    ctx->nb_active_threads = 0;\n    ctx->nb_jobs     = 0;\n    ctx->finished    = 0;\n\n    atomic_init(&ctx->first_job, 0);\n    atomic_init(&ctx->current_job, 0);\n    pthread_mutex_init(&ctx->done_mutex, NULL);\n    pthread_cond_init(&ctx->done_cond, NULL);\n    ctx->done        = 0;\n\n    for (i = 0; i < nb_workers; i++) {\n        WorkerContext *w = &ctx->workers[i];\n        int ret;\n        w->ctx = ctx;\n        pthread_mutex_init(&w->mutex, NULL);\n        pthread_cond_init(&w->cond, NULL);\n        pthread_mutex_lock(&w->mutex);\n        w->done = 0;\n\n        if (ret = pthread_create(&w->thread, NULL, thread_worker, w)) {\n            ctx->nb_threads = main_func ? i : i + 1;\n            pthread_mutex_unlock(&w->mutex);\n            pthread_cond_destroy(&w->cond);\n            pthread_mutex_destroy(&w->mutex);\n            avpriv_slicethread_free(pctx);\n            return AVERROR(ret);\n        }\n\n        while (!w->done)\n            pthread_cond_wait(&w->cond, &w->mutex);\n        pthread_mutex_unlock(&w->mutex);\n    }\n\n    return nb_threads;\n}\n\n")),Object(c.b)("h3",{id:"\u7ed9\u4e0a\u7ea7\u51fd\u6570\u6253\u65ad\u70b9"},"\u7ed9\u4e0a\u7ea7\u51fd\u6570\u6253\u65ad\u70b9"),Object(c.b)("p",null,"\u8c03\u7528thread_worker\u7684\u51fd\u6570\u65f6avpriv_slicethread_create"),Object(c.b)("p",null,"\u7ed9thread_worker\u6253\u65ad\u70b9\u770b\u4e0d\u5230\u6709\u7528\u4fe1\u606f\uff0c\u5219\u7ed9\u5176\u8c03\u7528\u51fd\u6570\u6253\u65ad\u70b9\u3002avpriv_slicethread_create\u3002"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"20210926144239 \n\n\n(lldb) breakpoint list\nCurrent breakpoints:\n1: file = '/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas_example_mac/rzpaas_example_mac/RZMLoginViewController.m', line = 309, exact_match = 0, locations = 1, resolved = 1, hit count = 0\n\n  1.1: where = rzpaas_example_mac`__46-[RZMLoginViewController rz_startLastMileTest]_block_invoke.206 + 437 at RZMLoginViewController.m:309:22, address = 0x0000000109331235, resolved, hit count = 0 \n\n2: file = '/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas-sdk-apple/RZPaas/Classes/rz-paas-sdk/Base/rtcCore/libsol2/src/sol2/impl/libuv/LoopImplLibuv.cpp', line = 35, exact_match = 0, locations = 1, resolved = 1, hit count = 0\n\n  2.1: where = RZPaas_macOS`sol2::LoopImplLibuv::run() + 24 at LoopImplLibuv.cpp:35:5, address = 0x000000010b313738, resolved, hit count = 0 \n\n3: file = '/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas-sdk-apple/RZPaas/Classes/rz-paas-sdk/Base/rtcCore/libsol2/src/sol2/Sol2WorkThreads.cpp', line = 60, exact_match = 0, locations = 1, resolved = 1, hit count = 1\n\n  3.1: where = RZPaas_macOS`sol2::Sol2WorkThreads::Sol2WorkThreads() + 147 at Sol2WorkThreads.cpp:60:39, address = 0x000000010b308913, resolved, hit count = 1 \n\n4: file = '/Users/dingyusong/Desktop/duobei/rzpaas-test-apple/rzpaas-sdk-apple/RZPaas/Classes/rz-paas-sdk/Base/ThreadPool.cpp', line = 28, exact_match = 0, locations = 1, resolved = 1, hit count = 5\n\n  4.1: where = RZPaas_macOS`rz::Thread::ThreadFun() + 383 at ThreadPool.cpp:28:7, address = 0x000000010979a96f, resolved, hit count = 5 \n\n5: name = '_thread_worker', locations = 0 (pending)\n\n6: name = 'thread_worker', locations = 1, resolved = 1, hit count = 0\n  6.1: where = RZPaas_macOS`thread_worker, address = 0x000000010ad0fff0, resolved, hit count = 0 \n\n7: name = 'createRZRtcEngine', locations = 1, resolved = 1, hit count = 0\n  7.1: where = RZPaas_macOS`createRZRtcEngine + 32 at RtcEngine.cpp:27:9, address = 0x0000000109bea3c0, resolved, hit count = 0 \n\n(lldb) \n\n\n")),Object(c.b)("h3",{id:"\u6e90\u7801\u4e2d\u5b9a\u4f4d"},"\u6e90\u7801\u4e2d\u5b9a\u4f4d"),Object(c.b)("p",null,"\u8fd0\u884c\u8d77\u6765\uff0c\u6e90\u7801\u4e2d\u5b9a\u4f4d"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},'\n(lldb) bt\n* thread #25, stop reason = breakpoint 2.1\n  * frame #0: 0x0000000107664dc0 RZPaas_macOS`avpriv_slicethread_create\n    frame #1: 0x0000000106e16acd RZPaas_macOS`ff_slice_thread_init + 237\n    frame #2: 0x0000000106f1e322 RZPaas_macOS`avcodec_open2 + 2354\n    frame #3: 0x000000010640fd8a RZPaas_macOS`DuoBei::FFmpegContext::InitFFmpeg(this=0x0000600000620b20, config=0x0000700002b96960) at FFmpegContext.cpp:160:9\n    frame #4: 0x0000000106412c47 RZPaas_macOS`DuoBei::H264Codec::Init(this=0x0000600000620b20, config=0x0000700002b96960) at H264Codec.cpp:47:5\n    frame #5: 0x00000001064e3820 RZPaas_macOS`rz::DefaultVideoDecoder::RealInit(this=0x0000600001a42e60) at DefaultVideoDecoder.cpp:89:25\n    frame #6: 0x00000001064e3551 RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:14:19\n    frame #7: 0x00000001064e392d RZPaas_macOS`rz::DefaultVideoDecoder::DefaultVideoDecoder(this=0x0000600001a42e60, eventHandler=0x00007fc175e9d350) at DefaultVideoDecoder.cpp:12:45\n    frame #8: 0x00000001064e0274 RZPaas_macOS`rz::DefaultVideoCodecProducer::GetDecoder(this=0x000060000331c5b0, eventHandler=0x00007fc175e9d350) at DefaultVideoCodecProducer.cpp:21:45\n    frame #9: 0x000000010668fb2d RZPaas_macOS`rz::StructureFactory::createVideoDecoder(type=VIDEO_CODEC_SOFT_H264, handler=0x00007fc175e9d350) at StructureFactory.cpp:427:65\n    frame #10: 0x0000000106471d15 RZPaas_macOS`rz::VideoDecodecManage::createDecoder(this=0x00007fc175e9d350) at VideoCodecManage.cpp:296:19\n    frame #11: 0x0000000106471af5 RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:167:11\n    frame #12: 0x0000000106471e3b RZPaas_macOS`rz::VideoDecodecManage::VideoDecodecManage(this=0x00007fc175e9d350, streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:163:37\n    frame #13: 0x0000000106472a62 RZPaas_macOS`rz::VideoCodecManageProducer::GetDecoder(this=0x000060000331c670, streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at VideoCodecManage.cpp:325:16\n    frame #14: 0x0000000106690981 RZPaas_macOS`rz::StructureFactory::createVideoDecoderManage(streamId="video-15b2abf5d3ca5be590145998ce1acc49", codecPriority=PRIORITY_SW, event=0x00007fc175f0f270) at StructureFactory.cpp:518:35\n    frame #15: 0x00000001063c2d8f RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:46:17\n    frame #16: 0x00000001063c3a9d RZPaas_macOS`rz::SubVideoStream::SubVideoStream(this=0x00007fc175f0f270, stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830) at SubVideoStream.cpp:13:26\n    frame #17: 0x0000000106691920 RZPaas_macOS`rz::StructureFactory::createSubVideoStream(stream=0x0000700002b97490, sync=0x0000600000058b40, event=0x00007fc175e0d830, fun=function<void ()> @ 0x0000700002b97570)>) at StructureFactory.cpp:621:20\n    frame #18: 0x0000000106596762 RZPaas_macOS`rz::RtcEngineBase::createSubVideoStreamInfo(streamCtx=std::__1::shared_ptr<rz::RemoteVideoStreamContext>::element_type @ 0x00007fc175c366c8 strong=2 weak=1, channelCtx=std::__1::shared_ptr<rz::IRtcChannelContext>::element_type @ 0x00007fc175c81388 strong=2 weak=1, mediaStreamType=MEDIA_STREAM_SUPPORTED, sync=0x0000600000058b40) at RtcEngineBase.cpp:500:13\n    frame #19: 0x00000001066398b1 RZPaas_macOS`rz::RtcEngineBase::onRemoteVideoStreamOnline(this=0x0000600001563788)::$_70::operator()() const at RtcEngineBase.cpp:2035:13\n    frame #20: 0x000000010663817d RZPaas_macOS`decltype(__f=0x0000600001563788)::$_70&>(fp)()) std::__1::__invoke<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70&>(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70&) at type_traits:3747:1\n    frame #21: 0x000000010663812d RZPaas_macOS`void std::__1::__invoke_void_return_wrapper<void>::__call<rz::RtcEngineBase::onRemoteVideoStreamOnline(__args=0x0000600001563788)::$_70&>(rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70&) at __functional_base:348:9\n    frame #22: 0x00000001066380fd RZPaas_macOS`std::__1::__function::__alloc_func<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70, std::__1::allocator<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70>, void ()>::operator(this=0x0000600001563788)() at functional:1553:16\n    frame #23: 0x0000000106636d49 RZPaas_macOS`std::__1::__function::__func<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70, std::__1::allocator<rz::RtcEngineBase::onRemoteVideoStreamOnline(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<rz::MediaStreamSync>, std::__1::shared_ptr<rz::MediaStreamInfo> const&)::$_70>, void ()>::operator(this=0x0000600001563780)() at functional:1727:12\n    frame #24: 0x0000000106081c62 RZPaas_macOS`std::__1::__function::__value_func<void ()>::operator(this=0x0000700002b97eb0)() const at functional:1880:16\n    frame #25: 0x000000010607f445 RZPaas_macOS`std::__1::function<void ()>::operator(this=0x0000700002b97eb0)() const at functional:2555:12\n    frame #26: 0x000000010637547b RZPaas_macOS`rz::InteractiveManage::workFun() at InteractiveManage.cpp:44:21\n    frame #27: 0x0000000106083367 RZPaas_macOS`decltype(__f=(0x00006000033193e8))()>(fp)()) std::__1::__invoke<void (*)()>(void (*&&)()) at type_traits:3747:1\n    frame #28: 0x00000001060832d5 RZPaas_macOS`void std::__1::__thread_execute<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void (*)()>(__t=size=2, (null)=__tuple_indices<> @ 0x0000700002b97f58)()>&, std::__1::__tuple_indices<>) at thread:280:5\n    frame #29: 0x0000000106082b2f RZPaas_macOS`void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void (*)()> >(__vp=0x00006000033193e0) at thread:291:5\n    frame #30: 0x000000010b92e1b8 libsystem_pthread.dylib`_pthread_start + 224\n    frame #31: 0x000000010b929af7 libsystem_pthread.dylib`thread_start + 15\n(lldb) \n\n\n\n\u9006\u5411\u67e5\u627e\u67d0\u4e2a\u7b26\u53f7\uff0c\u6839\u636ethread_worker \n\n')),Object(c.b)("p",null,"\u6700\u540e\u5b9a\u4f4d\u5230\u4e86\u8fd9\u6bb5\u4ee3\u7801\uff1a"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"ErrorCode DuoBei::FFmpegContext::InitFFmpeg(const DuoBei::FFmpegInitCfg &config) {\n    assert(!this->IsInit());\n\n    ErrorCode Ret = ErrorCode_NoError;\n    m_pPaket = av_packet_alloc();\n    if (!m_pPaket){\n        Ret = ErrorCode_FFmpeg_PaketInitError;\n    }\n    m_pFrame = av_frame_alloc();\n    if (!m_pFrame) {\n        Ret = ErrorCode_FFmpeg_FrameInitError;\n    }\n    if(GetCodecType() == FFmpegContextType::Decode){\n        Ret = this->InitFFmpegDecode(config);\n        if ( Ret != ErrorCode_NoError){\n            return Ret;\n        }\n    }\n    if (GetCodecType() == FFmpegContextType::Encode){\n        Ret = this->InitFFmpegEncode(config);\n        if ( Ret != ErrorCode_NoError){\n            return Ret;\n        }\n    }\n    if (GetCodecType() == FFmpegContextType::VideoConvertor){\n        Ret = this->InitFFmpegVideoConvertor(config);\n        if ( Ret != ErrorCode_NoError){\n            return Ret;\n        }\n    }\n    m_pContext = avcodec_alloc_context3(m_pCodec);\n    if (!m_pContext) {\n        Ret = ErrorCode_FFmpeg_ContextInitError;\n    }\n    this->FillContextInfo(config);\n    if (avcodec_open2(m_pContext, m_pCodec, nullptr) < 0) {\n        Ret = ErrorCode_FFmpeg_CodecOpenError;\n    }\n    if (Ret != ErrorCode_NoError){\n        this->CloseFFmpeg();\n    } else{\n        m_bFFmpegInited = true;\n    }\n    return Ret;\n}\n\n")),Object(c.b)("h2",{id:"bcsymbolmap"},"bcsymbolmap"),Object(c.b)("p",null,"\u901a\u8fc7bcsymbolmap\u627e\u5230\u8fd9\u4e2a\u7b26\u53f7\u5927\u6982\u5728\u4ec0\u4e48\u4f4d\u7f6e\uff1a_threadpool_thread "),Object(c.b)("p",null,Object(c.b)("img",{alt:"image-20211015101549519",src:a(1025).default})),Object(c.b)("p",null,Object(c.b)("img",{alt:"image-20211015101644003",src:a(1026).default})))}l.isMDXComponent=!0},329:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return f}));var r=a(0),n=a.n(r);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function d(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},c=Object.keys(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=n.a.createContext({}),i=function(e){var t=n.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):_(_({},t),e)),a},l=function(e){var t=i(e.components);return n.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},m=n.a.forwardRef((function(e,t){var a=e.components,r=e.mdxType,c=e.originalType,o=e.parentName,s=d(e,["components","mdxType","originalType","parentName"]),l=i(a),m=r,f=l["".concat(o,".").concat(m)]||l[m]||p[m]||c;return a?n.a.createElement(f,_(_({ref:t},s),{},{components:a})):n.a.createElement(f,_({ref:t},s))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var c=a.length,o=new Array(c);o[0]=m;var _={};for(var d in t)hasOwnProperty.call(t,d)&&(_[d]=t[d]);_.originalType=e,_.mdxType="string"==typeof e?e:r,o[1]=_;for(var s=2;s<c;s++)o[s]=a[s];return n.a.createElement.apply(null,o)}return n.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);